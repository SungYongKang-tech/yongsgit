<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Excel Style Ledger</title>

<style>
body{
  margin:0; background:#f5f7fb;
  font-family:"Pretendard","Noto Sans KR",sans-serif;
  overflow-x:hidden;
}
header{
  background:white; padding:16px; font-size:22px;
  font-weight:700; text-align:center;
  border-bottom:1px solid #ddd;
  position:sticky; top:0; z-index:10;
}

/* ✅ 엑셀 스타일 테이블 */
.wrap{ padding:10px; }
table{
  width:100%; border-collapse:collapse;
  background:white;
  border:1px solid #d0d0d0;
}
th, td{
  border:1px solid #d0d0d0;
  padding:8px;
  font-size:14px;
  background:white;
}
th{
  background:#f1f3f8;
  font-weight:700;
  text-align:center;
  white-space:nowrap;
}

/* ✅ contenteditable 엑셀 셀 */
.cell{
  min-height:22px;
  outline:none;
}
.cell:focus{
  background:#e8f0ff;
  border:1px solid #2563eb;
}

/* ✅ 숫자 셀 오른쪽 정렬 */
.numCell{
  text-align:right;
  white-space:nowrap;
}

/* ✅ 입력줄 (엑셀과 동일한 스타일) */
.addRow td{
  background:#f9fbff;
}
.addInput{
  width:100%;
  border:none;
  padding:6px;
  font-size:14px;
}
.addInput:focus{
  outline:2px solid #2563eb;
  background:#eef4ff;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
}
.blue{ background:#2563eb; color:white; }
.red{ background:#dc2626; color:white; }

@media(max-width:600px){
  th:nth-child(1){ width:18%; }
  th:nth-child(2){ width:40%; }
  th:nth-child(3),th:nth-child(4),th:nth-child(5){ width:14%; }
}
</style>
</head>

<body>

<header>Excel Style Ledger</header>

<div class="wrap">
<table id="ledgerTable">
  <thead>
    <tr>
      <th>일자</th>
      <th>내역</th>
      <th>입금</th>
      <th>출금</th>
      <th>잔액</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="ledger-body"></tbody>

  <!-- ✅ 입력줄 -->
  <tfoot>
    <tr class="addRow">
      <td><input id="in-date" class="addInput" placeholder="오늘 자동"></td>
      <td><input id="in-desc" class="addInput" placeholder="내역"></td>
      <td><input id="in-income" class="addInput" placeholder="0"></td>
      <td><input id="in-expense" class="addInput" placeholder="0"></td>
      <td colspan="2">
        <button class="blue" onclick="addRow()">추가</button>
      </td>
    </tr>
  </tfoot>
</table>
</div>

<script>
let ledger = JSON.parse(localStorage.getItem("excelLedger") || "[]");

const el=id=>document.getElementById(id);
const toNum=v=>Number(String(v||0).replace(/,/g,""));
const comma=n=>toNum(n).toLocaleString();

/* ✅ 날짜 변환 */
function normalizeDate(v){
  if(!v) return "";
  v = v.replace(/[^\d]/g,"");
  if(v.length===6) return `20${v.slice(0,2)}-${v.slice(2,4)}-${v.slice(4,6)}`;
  if(v.length===8) return `${v.slice(0,4)}-${v.slice(4,6)}-${v.slice(6,8)}`;
  return "";
}
function displayDate(date){
  if(!date) return "";
  const [y,m,d] = date.split("-");
  return `${y.slice(2)}.${m}.${d}`;
}

/* ✅ 잔액 계산 */
function computeBalance(){
  let bal=0;
  ledger.forEach(r=>{
    bal += toNum(r.income) - toNum(r.expense);
    r.balance = bal;
  });
}

/* ✅ 추가 */
function addRow(){
  let date = el("in-date").value;
  if(!date){
    const t=new Date();
    date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;
  } else date = normalizeDate(date);

  ledger.push({
    date,
    desc: el("in-desc").value.trim(),
    income: toNum(el("in-income").value),
    expense: toNum(el("in-expense").value)
  });

  el("in-date").value="";
  el("in-desc").value="";
  el("in-income").value="";
  el("in-expense").value="";
  render();
}

/* ✅ 셀 저장 */
function saveCell(i,field,txt){
  if(field==="date") ledger[i].date = normalizeDate(txt);
  else if(field==="desc") ledger[i].desc = txt;
  render();
}

/* ✅ 행 삭제 */
function removeRow(i){
  ledger.splice(i,1);
  render();
}

function render(){
  computeBalance();
  const body = el("ledger-body");
  body.innerHTML = "";

  ledger.forEach((r,i)=>{
    body.insertAdjacentHTML("beforeend",`
      <tr>
        <td><div class="cell" contenteditable="true"
            onblur="saveCell(${i},'date',this.innerText)">
          ${displayDate(r.date)}
        </div></td>

        <td><div class="cell" contenteditable="true"
            onblur="saveCell(${i},'desc',this.innerText)">
          ${r.desc}
        </div></td>

        <td class="numCell">
          <div class="cell" contenteditable="true"
              onblur="ledger[${i}].income = toNum(this.innerText); render();">
            ${comma(r.income)}
          </div>
        </td>

        <td class="numCell">
          <div class="cell" contenteditable="true"
              onblur="ledger[${i}].expense = toNum(this.innerText); render();">
            ${comma(r.expense)}
          </div>
        </td>

        <td class="numCell">${comma(r.balance)}</td>

        <td><button class="red" onclick="removeRow(${i})">삭제</button></td>
      </tr>
    `);
  });

  save();
}

function save(){
  localStorage.setItem("excelLedger", JSON.stringify(ledger));
}

render();
</script>

</body>
</html>
