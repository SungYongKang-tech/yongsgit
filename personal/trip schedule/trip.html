<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>여행 일정표</title>
  <link rel="stylesheet" href="./style.css"/>
</head>
<body>
  <div class="container">

    <!-- ✅ 상단 바 -->
    <div class="topbar">
      <div>
        <div class="badge" id="tripTitle">불러오는 중…</div>
        <div class="small" id="tripPeriod"></div>
      </div>

      <div class="actions" style="margin:0">
        <button class="btn btn-ghost" id="homeBtn">목록</button>
        <button class="btn btn-ghost" id="shareBtn">공유 링크 복사</button>
      </div>
    </div>

    <!-- ✅ 보기 모드(여행 중 핵심) -->
    <div class="card">
      <h2 style="margin-bottom:6px">일정 보기</h2>
      <div class="actions">
        <div class="chip" id="viewAll">전체</div>
        <div class="chip" id="viewToday">오늘</div>
        <div class="chip" id="viewTomorrow">내일</div>
        <div class="chip" id="toggleAdd">일정 추가 열기/닫기</div>
        <div class="chip" id="openTable">표로 보기</div>
      </div>
      <p class="small" id="viewHint">전체 일정을 실시간으로 확인할 수 있습니다.</p>
    </div>

    <!-- ✅ 참여 카드 -->
    <div class="card" id="joinCard" style="display:none">
      <h2>참여하기</h2>
      <p class="small">닉네임만 입력하면 바로 참여됩니다.</p>
      <label>닉네임</label>
      <input id="nick" placeholder="예: 성용"/>
      <div class="actions">
        <button class="btn btn-primary" id="joinBtn">참여</button>
      </div>
      <p class="small" id="joinStatus"></p>
    </div>

    <!-- ✅ 일정 추가(접기/펼치기 대상) -->
    <div class="card" id="addCard">
      <div class="topbar" style="margin-bottom:0">
        <h2 style="margin:0">일정 추가</h2>
        <button class="btn btn-ghost" id="collapseAddBtn">접기</button>
      </div>

      <div id="addForm">
        <!-- ✅ 날짜 -->
        <div class="row">
          <div>
            <label>날짜</label>
            <input id="date" type="date"/>
          </div>
        </div>

        <!-- ✅ 시간 (A안: 시작/끝 2칸, 끝은 선택) -->
        <div class="row">
          <div>
            <label>시작(선택)</label>
            <input id="timeStart" type="time"/>
          </div>
          <div>
            <label>끝(선택)</label>
            <input id="timeEnd" type="time"/>
          </div>
        </div>

        <label>제목</label>
        <input id="title" placeholder="예: 센소지 / 점심 / 체크인"/>

        <div class="row">
          <div>
            <label>장소(선택)</label>
            <input id="place" placeholder="예: 아사쿠사"/>
          </div>
          <div>
            <label>지도 링크(선택)</label>
            <input id="mapUrl" placeholder="네이버/카카오 지도 URL"/>
          </div>
        </div>

        <label>메모(선택)</label>
        <textarea id="note" placeholder="예: 10시 이전 도착 추천"></textarea>

        <label>사진(선택, 여러 장 가능)</label>
        <input id="photos" type="file" accept="image/*" multiple />

        <div class="actions">
          <button class="btn btn-primary" id="addBtn">추가</button>
          <span class="small" id="uploadHint">사진을 고르면 추가할 때 Cloudinary로 업로드됩니다.</span>
        </div>
        <p class="small" id="status"></p>
      </div>
    </div>

    <!-- ✅ 일정 리스트 -->
    <div class="list" id="list"></div>
  </div>

  <!-- ✅ 수정 모달 -->
  <div class="modal-backdrop" id="modalBack">
    <div class="modal">
      <h2>일정 수정</h2>

      <!-- ✅ 날짜 -->
      <div class="row">
        <div>
          <label>날짜</label>
          <input id="mDate" type="date"/>
        </div>
      </div>

      <!-- ✅ 시간 (A안: 시작/끝 2칸) -->
      <div class="row">
        <div>
          <label>시작(선택)</label>
          <input id="mTimeStart" type="time"/>
        </div>
        <div>
          <label>끝(선택)</label>
          <input id="mTimeEnd" type="time"/>
        </div>
      </div>

      <label>제목</label>
      <input id="mTitle"/>

      <div class="row">
        <div>
          <label>장소</label>
          <input id="mPlace"/>
        </div>
        <div>
          <label>지도 링크</label>
          <input id="mMapUrl"/>
        </div>
      </div>

      <label>메모</label>
      <textarea id="mNote"></textarea>

      <label>사진 추가(선택)</label>
      <input id="mPhotos" type="file" accept="image/*" multiple />

      <div class="actions">
        <button class="btn btn-ghost" id="closeModal">닫기</button>
        <button class="btn btn-primary" id="saveModal">저장</button>
      </div>
      <p class="small" id="mStatus"></p>
    </div>
  </div>

  <!-- ✅ 사진 미리보기(라이트박스) -->
  <div class="modal-backdrop" id="imgBack" style="display:none">
    <div class="modal" style="max-width:920px;">
      <div class="topbar" style="margin-bottom:10px">
        <h2 style="margin:0">사진 미리보기</h2>
        <div class="actions" style="margin:0">
          <button class="btn btn-ghost" id="imgClose">닫기</button>
          <button class="btn btn-ghost" id="imgDelete">이 사진 삭제</button>
        </div>
      </div>

      <img id="imgView" alt="preview" style="width:100%; border-radius:14px; border:1px solid #eee;" />
      <p class="small" id="imgInfo" style="margin-top:8px"></p>
      <p class="small" id="imgMsg" style="margin-top:6px"></p>
    </div>
  </div>

<!-- ✅ 표 모달 -->
<div class="modal-backdrop" id="tableBack" style="display:none">
  <div class="modal" style="
    max-width: 980px;
    width: 96vw;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  ">
    <!-- ✅ 상단(항상 고정) -->
    <div class="topbar" style="margin-bottom:10px; flex:0 0 auto;">
      <div>
        <h2 id="tableTitle" style="margin:0">전체 일정표</h2>
        <div class="small" id="tableSub"></div>
      </div>
      <div class="actions" style="margin:0">
        <button class="btn btn-ghost" id="copyTable">표 복사</button>
        <button class="btn btn-ghost" id="downloadTable">CSV 다운</button>
        <button class="btn btn-ghost" id="closeTable">닫기</button>
      </div>
    </div>

    <!-- ✅ 표 영역(여기만 스크롤) -->
    <div style="
      flex: 1 1 auto;
      overflow: auto;
      border: 1px solid #eee;
      border-radius: 14px;
    ">
      <!-- ✅ 표/카드 영역(여기만 스크롤) -->
<div style="flex:1 1 auto; overflow:auto; border:1px solid #eee; border-radius:14px; padding:10px;">
  <!-- PC용 표 -->
  <table id="tableEl" style="width:100%; border-collapse:collapse;"></table>

  <!-- 모바일용 카드 -->
  <div id="tableCards" style="display:none;"></div>
</div>

    </div>

    <p class="small" id="tableMsg" style="margin-top:8px; flex:0 0 auto;"></p>
  </div>
</div>




  <!-- ✅ trip 화면 보조 스크립트(접기/버튼) -->
  <script>
    document.getElementById("homeBtn")?.addEventListener("click", () => {
      location.href = "index.html";
    });

    const addForm = document.getElementById("addForm");
    const collapseBtn = document.getElementById("collapseAddBtn");
    const toggleAdd = document.getElementById("toggleAdd");

    function setAddOpen(open) {
      if (!addForm) return;
      addForm.style.display = open ? "block" : "none";
      if (collapseBtn) collapseBtn.textContent = open ? "접기" : "펼치기";
    }

    setAddOpen(false);

    collapseBtn?.addEventListener("click", () => {
      const isOpen = addForm.style.display !== "none";
      setAddOpen(!isOpen);
    });

    toggleAdd?.addEventListener("click", () => {
      const isOpen = addForm.style.display !== "none";
      setAddOpen(!isOpen);
    });
  </script>

  <script type="module" src="./app-trip.js?v=20260124"></script>
</body>
</html>
