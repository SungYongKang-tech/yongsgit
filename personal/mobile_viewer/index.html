<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>📱 모바일 친화 파일 뷰어</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f172a; --ink:#e5eaf5; --muted:#94a3b8; --accent:#4f46e5;
      --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --border:#1e293b;
    }
    [data-theme="light"]{ --bg:#f6f8fc; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --border:#e5e7eb; }
    html,body{height:100%}
    body{margin:0; font-family:"Pretendard","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:var(--bg); color:var(--ink)}
    header{position:sticky; top:0; z-index:50; background:var(--card); border-bottom:1px solid var(--border)}
    .bar{max-width:1000px; margin:0 auto; padding:10px 12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .bar h1{font-size:16px; margin:0 8px 0 0; white-space:nowrap}
    .bar .sp{flex:1 1 auto}
    .btn{border:1px solid var(--border); background:transparent; color:var(--ink); padding:8px 12px; border-radius:12px; cursor:pointer}
    .btn:hover{border-color:var(--accent)}
    .btn.primary{background:var(--accent); border-color:var(--accent); color:#fff}
    .btn.ghost{border:none; opacity:.85}
    .file{display:inline-block}
    .hint{font-size:12px; color:var(--muted)}

    .wrap{max-width:1000px; margin:0 auto; padding:14px}
    .drop{border:2px dashed var(--border); border-radius:16px; padding:22px; text-align:center; background:color-mix(in hsl, var(--card), transparent 10%);
      transition:.2s;}
    .drop.dragover{border-color:var(--accent); background:color-mix(in hsl, var(--card), var(--accent) 8%)}
    .drop p{margin:6px 0; color:var(--muted)}

    .viewer{margin-top:14px; background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden; min-height:40vh}
    .content{padding:16px}
    .content img, .content video{max-width:100%; height:auto; display:block; border-radius:12px}
    .content audio{width:100%}
    .content table{width:100%; border-collapse:collapse; font-size:14px}
    .content th, .content td{border:1px solid var(--border); padding:8px 10px}
    .content th{background:color-mix(in hsl, var(--card), var(--ink) 6%)}
    pre.code{background:color-mix(in hsl, var(--card), var(--ink) 6%); color:inherit; border-radius:12px; padding:14px; overflow:auto}

    .toolbar{display:flex; gap:8px; align-items:center; padding:10px; border-bottom:1px solid var(--border); background:var(--card)}
    .toolbar .row{display:flex; gap:6px; flex-wrap:wrap; align-items:center}
    .toolbar label{font-size:12px; color:var(--muted)}
    input[type="range"]{accent-color:var(--accent)}

    .footer{max-width:1000px; margin:16px auto; padding:10px 12px; color:var(--muted); font-size:12px}
    .badge{display:inline-block; border:1px solid var(--border); padding:2px 8px; border-radius:999px; margin-right:6px}

    /* Simulated phone width container */
    .phone{margin:0 auto}
  </style>
</head>
<body data-theme="dark">
  <header>
    <div class="bar">
      <h1>📱 모바일 친화 파일 뷰어</h1>
      <input id="file" class="file" type="file" />
      <button class="btn" id="openSample">샘플 불러오기</button>
      <span class="hint">(드래그&드롭 가능)</span>
      <span class="sp"></span>
      <label class="hint">테마</label>
      <button class="btn ghost" id="theme">Dark</button>
    </div>
  </header>

  <div class="wrap">
    <div id="drop" class="drop">
      <strong>여기에 파일을 끌어다 놓으세요</strong>
      <p>이미지, 동영상, 오디오, PDF, TXT/CSV/JSON/MD/HTML 등 기본 형식을 모바일에 최적화해 표시합니다.</p>
      <p class="hint">DOCX, PPTX 등 특수 형식은 브라우저 한정으로 미리보기가 제한될 수 있습니다.</p>
    </div>

    <div class="viewer">
      <div class="toolbar">
        <div class="row">
          <label>폰 폭</label>
          <input id="w" type="range" min="320" max="820" value="420" />
          <span id="wval" class="badge">420px</span>
        </div>
        <div class="row">
          <label>폰 글자</label>
          <input id="fs" type="range" min="14" max="22" value="16" />
          <span id="fsval" class="badge">16px</span>
        </div>
        <div class="row">
          <label>여백</label>
          <input id="pad" type="range" min="8" max="24" value="14" />
          <span id="padval" class="badge">14px</span>
        </div>
      </div>
      <div id="phone" class="phone" style="width:420px">
        <div id="content" class="content" style="font-size:16px; padding:14px">
          <p class="hint">파일을 선택하면 여기로 모바일 최적화 미리보기가 표시됩니다.</p>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="hint">
        <span class="badge">Tip</span>
        HTML/MD/TXT/CSV/JSON은 가독성 있는 레이아웃으로 자동 변환합니다. PDF는 브라우저 뷰어로, 이미지/비디오는 화면폭에 맞춰 표시합니다.
      </div>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const fileInput = $('#file');
    const drop = $('#drop');
    const phone = $('#phone');
    const content = $('#content');

    // UI controls
    const w = $('#w'), wval = $('#wval');
    const fs = $('#fs'), fsval = $('#fsval');
    const pad = $('#pad'), padval = $('#padval');
    [w,fs,pad].forEach(inp=>inp.addEventListener('input', ()=>{
      if(inp===w){ phone.style.width = inp.value+"px"; wval.textContent=inp.value+"px"; }
      if(inp===fs){ content.style.fontSize = inp.value+"px"; fsval.textContent=inp.value+"px"; }
      if(inp===pad){ content.style.padding = inp.value+"px"; padval.textContent=inp.value+"px"; }
    }));

    // Theme toggle
    $('#theme').addEventListener('click',()=>{
      const dark = document.body.getAttribute('data-theme')!=="light";
      document.body.setAttribute('data-theme', dark? 'light':'dark');
      $('#theme').textContent = dark? 'Light → Dark':'Dark → Light';
    });

    // Drag & drop
    ;['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.add('dragover')}));
    ;['dragleave','drop'].forEach(ev=> drop.addEventListener(ev, e=>{e.preventDefault(); drop.classList.remove('dragover')}));
    drop.addEventListener('drop', e=>{
      const f = e.dataTransfer.files?.[0]; if(f) handleFile(f);
    });

    fileInput.addEventListener('change', e=>{
      const f = e.target.files?.[0]; if(f) handleFile(f);
    });

    // Sample button
    $('#openSample').addEventListener('click', ()=>{
      const sample = new Blob([`# 샘플 문서\n\n이 뷰어는 **마크다운**, CSV, TXT, JSON을 이동기기 친화적으로 보여줍니다.\n\n- 이미지/비디오: 폭에 맞춤\n- PDF: 내장 뷰어\n- 코드 블록: 스크롤\n\n\n|이름|점수|\n|---|---:|\n|홍길동|98|\n|김영희|92|`], {type:'text/markdown'});
      const file = new File([sample], 'sample.md', {type:'text/markdown'});
      handleFile(file);
    });

    // Main: route by MIME or extension
    function handleFile(file){
      const name = file.name.toLowerCase();
      const type = file.type || guessMime(name);
      content.innerHTML = `<div class="hint">파일: ${escapeHtml(file.name)}<br>형식: ${type || '알 수 없음'}</div>`;

      if(type.startsWith('image/')) return renderImage(file);
      if(type.startsWith('video/')) return renderVideo(file);
      if(type.startsWith('audio/')) return renderAudio(file);
      if(type==='application/pdf') return renderPDF(file);
      if(type.startsWith('text/') || ['application/json','text/csv','text/markdown','text/html'].includes(type)){
        const reader = new FileReader();
        reader.onload = ()=> renderText(reader.result, type, name);
        reader.readAsText(file);
        return;
      }
      // Fallback
      const url = URL.createObjectURL(file);
      content.insertAdjacentHTML('beforeend', `
        <p class="hint">이 형식은 브라우저 미리보기가 제한됩니다. 아래 링크로 저장/열기를 시도하세요.</p>
        <p><a class="btn" href="${url}" download>파일 저장하기</a></p>
      `);
    }

    function renderImage(file){
      const url = URL.createObjectURL(file);
      content.innerHTML = `<img alt="image" src="${url}">`;
    }
    function renderVideo(file){
      const url = URL.createObjectURL(file);
      content.innerHTML = `<video src="${url}" controls playsinline></video>`;
    }
    function renderAudio(file){
      const url = URL.createObjectURL(file);
      content.innerHTML = `<audio src="${url}" controls></audio>`;
    }
    function renderPDF(file){
      const url = URL.createObjectURL(file);
      // Use iframe to leverage built-in PDF viewer
      content.innerHTML = `<div style="height:70vh"><iframe title="pdf" src="${url}#view=FitH" style="width:100%; height:100%; border:0"></iframe></div>`;
    }

    function renderText(text, type, name){
      if(type==='text/markdown' || name.endsWith('.md')){
        content.innerHTML = mdToHtml(text);
        return;
      }
      if(type==='text/csv' || name.endsWith('.csv')){
        content.innerHTML = csvToTable(text);
        return;
      }
      if(type==='application/json' || name.endsWith('.json')){
        try{ const obj = JSON.parse(text); content.innerHTML = `<pre class="code">${escapeHtml(JSON.stringify(obj, null, 2))}</pre>`; }
        catch{ content.innerHTML = `<pre class="code">${escapeHtml(text)}</pre>`; }
        return;
      }
      if(type==='text/html' || name.endsWith('.html') || name.endsWith('.htm')){
        // sandboxed srcdoc to avoid style leakage
        content.innerHTML = `<div style="height:70vh"><iframe sandbox="allow-same-origin allow-forms allow-scripts" style="width:100%; height:100%; border:0" srcdoc="${escapeAttr(text)}"></iframe></div>`;
        return;
      }
      // plain text
      content.innerHTML = `<pre class="code">${escapeHtml(text)}</pre>`;
    }

    // === Utilities ===
    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    }
    function escapeAttr(s){
      return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]))
              .replace(/`/g,'&#96;');
    }
    function guessMime(name){
      if(name.endsWith('.md')) return 'text/markdown';
      if(name.endsWith('.csv')) return 'text/csv';
      if(name.endsWith('.json')) return 'application/json';
      if(name.endsWith('.pdf')) return 'application/pdf';
      if(name.match(/\.(png|jpg|jpeg|gif|webp|avif|svg)$/)) return 'image/*';
      if(name.match(/\.(mp4|webm|mov|m4v)$/)) return 'video/*';
      if(name.match(/\.(mp3|wav|ogg)$/)) return 'audio/*';
      if(name.match(/\.(html|htm)$/)) return 'text/html';
      if(name.match(/\.(txt|log)$/)) return 'text/plain';
      return '';
    }

    // Very small Markdown converter (headings, bold/italic, code, lists, links, tables)
    function mdToHtml(md){
      const esc = (s)=>escapeHtml(s);
      // tables (very naive)
      if(/\n\|/.test(md)){
        md = md.replace(/\n\|([^\n]+)\|\n\|([\-\: \|]+)\|\n([\s\S]*?)(?=\n\n|$)/g, (m, head, sep, body)=>{
          const ths = head.split('|').map(s=>`<th>${esc(s.trim())}</th>`).join('');
          const rows = body.trim().split('\n').map(r=>'<tr>' + r.replace(/^\|?|\|$/g,'').split('|').map(s=>`<td>${esc(s.trim())}</td>`).join('') + '</tr>').join('');
          return `\n<table><thead><tr>${ths}</tr></thead><tbody>${rows}</tbody></table>`;
        });
      }
      let html = esc(md)
        .replace(/^###### (.*)$/gm,'<h6>$1</h6>')
        .replace(/^##### (.*)$/gm,'<h5>$1</h5>')
        .replace(/^#### (.*)$/gm,'<h4>$1</h4>')
        .replace(/^### (.*)$/gm,'<h3>$1</h3>')
        .replace(/^## (.*)$/gm,'<h2>$1</h2>')
        .replace(/^# (.*)$/gm,'<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.*?)\*/g,'<em>$1</em>')
        .replace(/`([^`]+)`/g,'<code>$1</code>')
        .replace(/\n\- (.*)/g,'\n<li>$1</li>')
        .replace(/(\n<li>.*<\/li>\n?)+/g, m=>`\n<ul>${m}\n</ul>`) 
        .replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>')
        .replace(/\n{2,}/g,'<br><br>');
      return `<div class="md">${html}</div>`;
    }

    function csvToTable(text){
      const rows = text.split(/\r?\n/).filter(r=>r.length);
      const cells = rows.map(r=> r.match(/(?:\"([^\"]*)\"|([^,]+)|)(?=,|$)/g)?.map(c=>c.replace(/^,|,$/g,'').replace(/^\"|\"$/g,'')) || []);
      const head = cells[0] || [];
      const body = cells.slice(1);
      const ths = head.map(h=>`<th>${escapeHtml(h)}</th>`).join('');
      const trs = body.map(r=> `<tr>${r.map(c=>`<td>${escapeHtml(c||'')}</td>`).join('')}</tr>`).join('');
      return `<div style="overflow:auto"><table><thead><tr>${ths}</tr></thead><tbody>${trs}</tbody></table></div>`;
    }
  </script>
</body>
</html>
