<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta property="og:title" content="KOEN íƒêµ¬ ë ˆìŠ¨" />
  <meta property="og:description" content="KOEN íƒêµ¬ ë ˆìŠ¨ ì•ˆë‚´ ë° ì‹ ì²­ í˜ì´ì§€" />
  <!-- âš ï¸ ì´ë¯¸ì§€/URLì€ í•„ìš” ì‹œ íƒêµ¬ìš©ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš” -->
  <meta property="og:image" content=https://sensational-tulumba-65e97e.netlify.app/pingpong_main/pingpong_lesson/sinyubin.jpg />
  <meta property="og:type" content="website" />

  <title>KOEN íƒêµ¬ ë ˆìŠ¨</title>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fafafa;
      margin: 0;
      padding: 24px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #0d47a1;
      font-size: 24px;
      margin: 10px 0;
      text-align: center;
    }

    .thumbnail {
      width: 100%;
      max-width: 320px;
      border-radius: 10px;
      margin-bottom: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .button-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 360px;
    }

    .link-button {
      display: block;
      padding: 14px;
      text-align: center;
      text-decoration: none;
      font-size: 16px;
      font-weight: bold;
      border-radius: 10px;
      color: white;
      transition: transform 0.1s ease, filter 0.15s ease;
      border: 0;
      cursor: pointer;
    }

    .link-button:hover { filter: brightness(1.05); }
    .link-button:active { transform: scale(0.97); }

    .btn-blue    { background-color: #1976d2; }
    .btn-green   { background-color: #388e3c; }
    .btn-purple  { background-color: #7b1fa2; }

    .waiting-box{
      margin-top:30px;
      width:100%;
      max-width:360px;
      background:#ffffff;
      border-radius:10px;
      padding:14px;
      box-shadow:0 4px 8px rgba(0,0,0,0.05);
      font-size:14px;
    }

    .waiting-box h3{
      margin:0 0 8px 0;
      font-size:15px;
      color:#444;
    }

    .waiting-list{
      line-height:1.7;
      color:#333;
    }

    /* âœ… ê´€ë¦¬ì ë¹„ë²ˆ ëª¨ë‹¬ */
    .modalBack{
      position:fixed; inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:16px;
    }
    .modal{
      width:100%;
      max-width:380px;
      background:#fff;
      border-radius:14px;
      padding:16px;
      box-shadow:0 18px 50px rgba(0,0,0,.18);
    }
    .modal h3{
      margin:0 0 10px 0;
      font-size:16px;
      color:#111;
    }
    .modal .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:10px;
    }
    .modal input{
      flex:1;
      padding:12px 12px;
      font-size:15px;
      border:1px solid #d7dbe3;
      border-radius:12px;
      outline:none;
    }
    .mBtn{
      padding:12px 12px;
      font-size:14px;
      font-weight:800;
      border-radius:12px;
      border:1px solid rgba(13,71,161,.18);
      background:#0d47a1;
      color:#fff;
      cursor:pointer;
      white-space:nowrap;
    }
    .mBtn.gray{
      background:#eef2f7;
      color:#111;
      border:1px solid #d7dbe3;
    }
    .hint{
      margin-top:8px;
      font-size:13px;
      color:#666;
    }

    @media (max-width: 480px) {
      h1 { font-size: 20px; }
      .link-button { font-size: 15px; padding: 12px; }
    }
  </style>
</head>

<body>

  <h1>ğŸ“ KOEN íƒêµ¬ ë ˆìŠ¨</h1>

  <img 
    src="https://sensational-tulumba-65e97e.netlify.app/pingpong_main/pingpong_lesson/sinyubin.jpg"
    alt="KOEN íƒêµ¬ ë ˆìŠ¨"
    class="thumbnail"
  />

  <div class="button-container">

    <button class="link-button btn-purple" id="openAdminBtn" type="button">
      ğŸ” ë ˆìŠ¨ ê´€ë¦¬ì í˜ì´ì§€
    </button>

    <a class="link-button btn-blue" href="./new-member-guide.html">
      ğŸ“„ ì‹ ê·œíšŒì› íƒêµ¬ ë ˆìŠ¨ ì•ˆë‚´ë¬¸
    </a>

    <a class="link-button btn-green" href="./lesson-schedule.html">
      ğŸ“… íƒêµ¬ ë ˆìŠ¨ ì‹œê°„í‘œ
    </a>

  </div>

  <!-- ğŸ”½ ëŒ€ê¸°ì ëª©ë¡ í…ìŠ¤íŠ¸ í‘œì‹œ -->
  <div class="waiting-box">
    <h3>â³ í˜„ì¬ ë ˆìŠ¨ ëŒ€ê¸°ì</h3>
    <div id="waitingTextList" class="waiting-list">
      ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>
  </div>

  <div style="margin-top:20px;">
    <a href="../index.html">â† KOEN íƒêµ¬ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
  </div>

  <!-- âœ… ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div class="modalBack" id="adminModalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="adminModalTitle">
      <h3 id="adminModalTitle">ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
      <div class="row">
        <input id="adminPassInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password" />
      </div>
      <div class="row" style="justify-content:flex-end;">
        <button class="mBtn gray" type="button" id="adminCancelBtn">ì·¨ì†Œ</button>
        <button class="mBtn" type="button" id="adminGoBtn">í™•ì¸</button>
      </div>
      <div class="hint">â€» ë¹„ë°€ë²ˆí˜¸ê°€ ë§ìœ¼ë©´ ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- Firebase ëŒ€ê¸°ì ë¶ˆëŸ¬ì˜¤ê¸° + ê´€ë¦¬ì ì¸ì¦ ì²˜ë¦¬ -->
  <script type="module">
    // âœ… pingpong_main/firebase.js ì‚¬ìš© (í˜„ì¬ í´ë” êµ¬ì¡°ì—ì„œ ì´ ê²½ë¡œê°€ ë§ìŒ)
    import { db } from "../firebase.js";

    // âœ… 10.12.4ë¡œ í†µì¼ (firebase.js ë²„ì „ê³¼ ë™ì¼)
    import { ref, onValue, get } from
      "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

    /* ==========================
       âœ… ëŒ€ê¸°ì í‘œì‹œ
    ========================== */
    const waitingRef = ref(db, "lesson/waiting");

    onValue(waitingRef, (snap) => {
      const data = snap.val() || {};
      const listEl = document.getElementById("waitingTextList");

      const names = Object.values(data).map(v => v?.name).filter(Boolean);

      if (names.length === 0) {
        listEl.textContent = "í˜„ì¬ ëŒ€ê¸°ìê°€ ì—†ìŠµë‹ˆë‹¤.";
      } else {
        listEl.textContent = names.join("  Â·  ");
      }
    });

    /* ==========================
       âœ… ê´€ë¦¬ì í˜ì´ì§€ ì§„ì… ë³´í˜¸
       - config/adminPassword (hash) ë¹„êµ
    ========================== */
    const $ = (id) => document.getElementById(id);

    function simpleHash(s){
      let h = 2166136261;
      for (let i=0;i<s.length;i++){
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h>>>0).toString(16);
    }

    const adminModalBack = $("adminModalBack");
    const adminPassInput = $("adminPassInput");

    function openModal(){
      adminModalBack.style.display = "flex";
      adminPassInput.value = "";
      setTimeout(()=>adminPassInput.focus(), 50);
    }
    function closeModal(){
      adminModalBack.style.display = "none";
      adminPassInput.value = "";
    }

    $("openAdminBtn").addEventListener("click", openModal);
    $("adminCancelBtn").addEventListener("click", closeModal);

    adminModalBack.addEventListener("click", (e)=>{
      if(e.target === adminModalBack) closeModal();
    });

    adminPassInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") $("adminGoBtn").click();
      if(e.key === "Escape") closeModal();
    });

    $("adminGoBtn").addEventListener("click", async ()=>{
      const pass = (adminPassInput.value || "").trim();
      if(!pass){
        alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        adminPassInput.focus();
        return;
      }

      try{
        const snap = await get(ref(db, "config/adminPassword"));
        const savedHash = snap.val();

        if(!savedHash){
          alert("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
          return;
        }

        const inputHash = simpleHash(pass);

        if(inputHash !== savedHash){
          alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          adminPassInput.focus();
          return;
        }

        localStorage.setItem("koenAdminAuth","ok");
        closeModal();
        location.href = "./admin.html";
      }catch(err){
        console.error(err);
        alert("ê´€ë¦¬ì ì¸ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });
  </script>

</body>
</html>