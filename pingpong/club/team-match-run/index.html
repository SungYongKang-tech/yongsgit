<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¨ì²´ì „ ì§„í–‰</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body{font-family:'Segoe UI',sans-serif;padding:20px;background:#f5f7fa}
    h2{text-align:center;color:#0d47a1;margin:10px 0 30px}
    .config{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
    select,button{padding:6px 14px;font-size:15px}
    table{border-collapse:collapse;width:100%;max-width:600px;margin:0 auto}
    th,td{border:1px solid #888;padding:8px 12px;text-align:center}
    th{background:#e3f2fd}
    td.self{background:#eeeeee}
    td.vs{cursor:pointer;color:#1565c0}
    td.vs:hover{background:#e1f5fe}
  </style>
</head>
<body>

  <div id="teamListArea" style="margin-bottom:30px;"></div>

  
  <h2>ë‹¨ì²´ì „ ì§„í–‰</h2>

  <!-- 2ë‹¨ê³„: ê²½ê¸° ë°©ì‹ ì„¤ì • UI -->
  <div class="config">
    ë‹¨ì‹&nbsp;
    <select id="singlesCnt">
      <option value="1">1ê²½ê¸°</option><option value="2">2ê²½ê¸°</option>
      <option value="3" selected>3ê²½ê¸°</option><option value="4">4ê²½ê¸°</option>
    </select>
    &nbsp;ë³µì‹&nbsp;
    <select id="doublesCnt">
      <option value="0">0ê²½ê¸°</option><option value="1">1ê²½ê¸°</option>
      <option value="2" selected>2ê²½ê¸°</option><option value="3">3ê²½ê¸°</option>
    </select>
    &nbsp;<button onclick="drawSummary()">ëŒ€ì§„í‘œ ìš”ì•½í‘œ ìƒì„±</button>
  </div>

  <!-- 3ë‹¨ê³„: ëŒ€ì§„í‘œ ìš”ì•½í‘œ í‘œì‹œ ì˜ì—­ -->
  <div id="summaryArea"></div>

<script>
/* ---------- Firebase ì´ˆê¸°í™” ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyA-tp3iJ8-n0yrrd8lwE1IgOdsmDqyh69k",
  authDomain: "koen-teamleague.firebaseapp.com",
  projectId: "koen-teamleague",
  storageBucket: "koen-teamleague.firebasestorage.app",
  messagingSenderId: "487164547059",
  appId: "1:487164547059:web:658a10c8bfe7272ca78c86",
  databaseURL: "https://koen-teamleague-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------- 1ë‹¨ê³„: íŒ€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ---------- */
let teamNames = [];                 // ["íŒ€A", "íŒ€B", ...]
let teamData  = {};                 // ì›ë³¸ ê°ì²´ ê·¸ëŒ€ë¡œ ë³´ê´€

db.ref("teams").once("value").then(snap=>{
  if(!snap.exists()){ alert("âš ï¸ ì €ì¥ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤!"); return;}
  teamData = snap.val();
  teamNames = Object.values(teamData).map(t => t.teamName);
  renderTeamList(); 
  alert(`âœ… ${teamNames.length}ê°œ íŒ€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
}).catch(err=>console.error(err));

/* ---------- 2.5ë‹¨ê³„: ë¶ˆëŸ¬ì˜¨ íŒ€ê³¼ ì„ ìˆ˜ ë³´ì—¬ì£¼ê¸° ---------- */


function renderTeamList() {
  let html = '<h3 style="text-align:center; color:#333;">ğŸ“‹ íŒ€ êµ¬ì„± í˜„í™©</h3>';
  html += '<table><tr><th>íŒ€ëª…</th><th>íŒ€ì› ëª©ë¡</th></tr>';

  Object.values(teamData).forEach(team => {
    const playerNames = team.players.map(p => `${p.name}(${p.level})`).join(', ');
    html += `<tr><td><strong>${team.teamName}</strong></td><td>${playerNames}</td></tr>`;
  });

  html += '</table>';
  document.getElementById('teamListArea').innerHTML = html;
}













/* ---------- 3ë‹¨ê³„: ëŒ€ì§„í‘œ ìš”ì•½í‘œ ê·¸ë¦¬ê¸° ---------- */
function drawSummary(){
  if(teamNames.length < 2){ alert("íŒ€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

  const singles = parseInt(document.getElementById("singlesCnt").value,10);
  const doubles = parseInt(document.getElementById("doublesCnt").value,10);
  const totalGames = singles + doubles;

  // í‘œ ë¨¸ë¦¬ê¸€
  let html = '<table><tr><th></th>';
  teamNames.forEach(n => html += `<th>${n}</th>`);
  html += '</tr>';

  // í–‰
  teamNames.forEach((rowName,i)=>{
    html += `<tr><th>${rowName}</th>`;
    teamNames.forEach((colName,j)=>{
      if(i===j){
        html += '<td class="self">-</td>';
      }else if(i<j){   // ì¤‘ë³µ ë°©ì§€: ì ˆë°˜ë§Œ vs í‘œì‹œ
        html += `<td class="vs" onclick="openMatch(${i},${j})">vs</td>`;
      }else{
        html += '<td></td>';
      }
    });
    html += '</tr>';
  });
  html += '</table>';

  // ì´ ê²½ê¸° ìˆ˜ ì •ë³´ í‘œì‹œ
  html += `<p style="text-align:center;margin-top:10px;">
            âš™ï¸ ë‹¨ì‹ ${singles}ê²½ê¸° + ë³µì‹ ${doubles}ê²½ê¸° â†’ <strong>${totalGames}ê²½ê¸°</strong>
            (${totalGames%2===0 ? "ì§ìˆ˜: ì„¸íŠ¸í•© ìš°ì„ " : "í™€ìˆ˜: ìŠ¹ìˆ˜ ìš°ì„ "})
           </p>`;

  document.getElementById("summaryArea").innerHTML = html;
}

/* ---------- ì´í›„ ë‹¨ê³„(4~7ë‹¨ê³„) ì—°ê²°ìš©: ë¹ˆ í•¨ìˆ˜ ---------- */
function openMatch(i,j){
  const teamA = teamNames[i];
  const teamB = teamNames[j];
  // 4ë‹¨ê³„ì—ì„œ ìƒì„¸ ê²½ê¸° ì„¸íŒ… UIë¡œ ì´ë™ / íŒì—… ë“± êµ¬í˜„ ì˜ˆì •
  alert(`${teamA} vs ${teamB} ê²½ê¸° ì„¸íŒ…ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
}
</script>
</body>
</html>
