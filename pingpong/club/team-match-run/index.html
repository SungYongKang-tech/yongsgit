<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¨ì²´ì „ ì§„í–‰</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body{font-family:'Segoe UI',sans-serif;padding:20px;background:#f5f7fa}
    h2{text-align:center;color:#0d47a1;margin:10px 0 30px}
    .config{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
    select,button{padding:6px 14px;font-size:15px}
    table{border-collapse:collapse;width:100%;max-width:600px;margin:0 auto}
    th,td{border:1px solid #888;padding:8px 12px;text-align:center}
    th{background:#e3f2fd}
    td.self{background:#eeeeee}
    td.vs{cursor:pointer;color:#1565c0}
    td.vs:hover{background:#e1f5fe}
    
    .match-card {
  border: 3px solid #0d47a1;
  padding: 20px;
  margin: 30px auto;
  max-width: 720px;
  background: #ffffff;
  border-radius: 14px;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.12);
}

.match-card h3 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 20px;
  color: #0d47a1;
}

.match-card table {
  width: 100%;
  border-collapse: collapse;
}

.match-card th, .match-card td {
  border: 1px solid #aaa;
  padding: 10px;
  text-align: center;
}

.match-card th {
  background-color: #e3f2fd;
}
  </style>  

</head>
<body>

  <div id="teamListArea" style="margin-bottom:30px;"></div>

  
  <h2>ë‹¨ì²´ì „ ì§„í–‰</h2>

  <!-- 2ë‹¨ê³„: ê²½ê¸° ë°©ì‹ ì„¤ì • UI -->
  <div class="config">
    ë‹¨ì‹&nbsp;
    <select id="singlesCnt">
      <option value="1">1ê²½ê¸°</option><option value="2">2ê²½ê¸°</option>
      <option value="3" selected>3ê²½ê¸°</option><option value="4">4ê²½ê¸°</option>
    </select>
    &nbsp;ë³µì‹&nbsp;
    <select id="doublesCnt">
      <option value="0">0ê²½ê¸°</option><option value="1">1ê²½ê¸°</option>
      <option value="2" selected>2ê²½ê¸°</option><option value="3">3ê²½ê¸°</option>
    </select>
   <button onclick="renderAllMatchesFromFirebase()">ëŒ€ì§„í‘œ ìƒì„±</button>

  </div>

  <!-- 3ë‹¨ê³„: ëŒ€ì§„í‘œ í‘œì‹œ ì˜ì—­ -->
  






<script>
/* ---------- Firebase ì´ˆê¸°í™” ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyA-tp3iJ8-n0yrrd8lwE1IgOdsmDqyh69k",
  authDomain: "koen-teamleague.firebaseapp.com",
  projectId: "koen-teamleague",
  storageBucket: "koen-teamleague.firebasestorage.app",
  messagingSenderId: "487164547059",
  appId: "1:487164547059:web:658a10c8bfe7272ca78c86",
  databaseURL: "https://koen-teamleague-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------- 1ë‹¨ê³„: íŒ€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ---------- */
let teamNames = [];                 // ["íŒ€A", "íŒ€B", ...]
let teamData  = {};                 // ì›ë³¸ ê°ì²´ ê·¸ëŒ€ë¡œ ë³´ê´€

db.ref("teams").once("value").then(snap=>{
  if(!snap.exists()){ alert("âš ï¸ ì €ì¥ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤!"); return;}

  const raw = snap.val();
  teamData = {};  // ì¬êµ¬ì„±ëœ teamName ê¸°ì¤€ ë°ì´í„°
  teamNames = [];

  Object.values(raw).forEach(team => {
    teamData[team.teamName] = team;
    teamNames.push(team.teamName);
  });

  renderTeamList(); 
  alert(`âœ… ${teamNames.length}ê°œ íŒ€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
}).catch(err=>console.error(err));

/* ---------- 2.5ë‹¨ê³„: ë¶ˆëŸ¬ì˜¨ íŒ€ê³¼ ì„ ìˆ˜ ë³´ì—¬ì£¼ê¸° ---------- */
function renderTeamList() {
  let html = '<h3 style="text-align:center; color:#333;">ğŸ“‹ íŒ€ êµ¬ì„± í˜„í™©</h3>';
  html += '<table><tr><th>íŒ€ëª…</th><th>íŒ€ì› ëª©ë¡</th></tr>';

  Object.values(teamData).forEach(team => {
    const playerNames = team.players.map(p => `${p.name}(${p.level})`).join(', ');
    html += `<tr><td><strong>${team.teamName}</strong></td><td>${playerNames}</td></tr>`;
  });

  html += '</table>';
  document.getElementById('teamListArea').innerHTML = html;
}

/* ---------- 3ë‹¨ê³„: ëŒ€ì§„í‘œ ê·¸ë¦¬ê¸° ---------- */
function renderAllMatchesFromFirebase() {
  if (!teamNames || teamNames.length < 2) {
    alert("âš ï¸ íŒ€ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); 
    return;
  }

  console.log("ğŸ“¦ teamNames:", teamNames);
  console.log("ğŸ“¦ teamData keys:", Object.keys(teamData));

  const singles = parseInt(document.getElementById("singlesCnt").value, 10);
  const doubles = parseInt(document.getElementById("doublesCnt").value, 10);
  const totalMatches = [];

  // íŒ€ ì¡°í•© ë§Œë“¤ê¸° (ì¤‘ë³µ ì—†ì´)
  for (let i = 0; i < teamNames.length; i++) {
    for (let j = i + 1; j < teamNames.length; j++) {
      const teamA = teamNames[i];
      const teamB = teamNames[j];

      if (!teamData[teamA] || !teamData[teamB]) {
        console.warn(`âš ï¸ ëŒ€ì§„í‘œ ìƒì„± ì‹¤íŒ¨: '${teamA}' ë˜ëŠ” '${teamB}' íŒ€ ì •ë³´ ì—†ìŒ`);
        continue;
      }

      totalMatches.push({ teamA, teamB });
    }
  }

  const container = document.getElementById("summaryArea");
  container.innerHTML = ""; // ê¸°ì¡´ ì¹´ë“œ ì´ˆê¸°í™”

  totalMatches.forEach(match => {
    const matchList = [];

    // ë‹¨ì‹ ê²½ê¸° ìƒì„±
    for (let i = 1; i <= singles; i++) {
      const playerA = getPlayerName(teamData[match.teamA], i - 1);
      const playerB = getPlayerName(teamData[match.teamB], i - 1);
      matchList.push({
        label: `${i}ë‹¨`,
        players: `${playerA} vs ${playerB}`,
        result: "ë¯¸ì…ë ¥"
      });
    }

    // ë³µì‹ ê²½ê¸° ìƒì„±
    for (let i = 1; i <= doubles; i++) {
      const idx = singles + (i - 1) * 2;
      const pairA = `${getPlayerName(teamData[match.teamA], idx)}/${getPlayerName(teamData[match.teamA], idx + 1)}`;
      const pairB = `${getPlayerName(teamData[match.teamB], idx)}/${getPlayerName(teamData[match.teamB], idx + 1)}`;
      matchList.push({
        label: `${i}ë³µ`,
        players: `${pairA} vs ${pairB}`,
        result: "ë¯¸ì…ë ¥"
      });
    }

    renderMatchCard(match.teamA, match.teamB, matchList);
  });
}

function getPlayerName(team, index) {
  if (!team) {
    console.warn("âš ï¸ íŒ€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤:", team);
    return "ë¯¸ì •";
  }
  if (!Array.isArray(team.players)) {
    console.warn("âš ï¸ íŒ€ì— players ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤:", team);
    return "ë¯¸ì •";
  }
  if (!team.players[index]) {
    console.warn("âš ï¸ í•´ë‹¹ ì¸ë±ìŠ¤ì— ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤:", index, team.players);
    return "ë¯¸ì •";
  }
  return team.players[index].name;
}

//  ë¡œê·¸
console.log("teamData í‚¤ ëª©ë¡:", Object.keys(teamData));
console.log("teamNames ë°°ì—´:", teamNames);
//  ë¡œê·¸

function renderMatchCard(teamA, teamB, matchList) {
  const container = document.getElementById("summaryArea");
  let html = `<div class="match-card"><h3>${teamA} VS ${teamB}</h3><table>`;
  html += `<thead><tr><th>ê²½ê¸°</th><th>ì¶œì „ ì„ ìˆ˜</th><th>ê²°ê³¼</th></tr></thead><tbody>`;

  matchList.forEach(match => {
    html += `<tr>
               <td>${match.label}</td>
               <td>${match.players}</td>
               <td>${match.result}</td>
             </tr>`;
  });

  html += `</tbody></table></div>`;
  container.innerHTML += html;
}



/* ---------- ì´í›„ ë‹¨ê³„(4~7ë‹¨ê³„) ì—°ê²°ìš©: ë¹ˆ í•¨ìˆ˜ ---------- */
function openMatch(i,j){
  const teamA = teamNames[i];
  const teamB = teamNames[j];
  // 4ë‹¨ê³„ì—ì„œ ìƒì„¸ ê²½ê¸° ì„¸íŒ… UIë¡œ ì´ë™ / íŒì—… ë“± êµ¬í˜„ ì˜ˆì •
  alert(`${teamA} vs ${teamB} ê²½ê¸° ì„¸íŒ…ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
}
</script>
<div id="summaryArea"></div>

</body>
</html>
