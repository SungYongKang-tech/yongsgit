<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ğŸ€ ê´€ë¦¬ìëª¨ë“œ</title>
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
:root{
  --ink:#0f172a; --mut:#64748b; --bg:#f5f7fb; --card:#fff;
  --accent:#2563eb; --ok:#16a34a; --danger:#ef4444; --bd:#e5e7eb;
  --shadow:0 8px 28px rgba(0,0,0,.08); --r:12px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Pretendard,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--ink);font-weight:600}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--bd);z-index:10}
.hin{padding:14px 10px;text-align:center}
h1{margin:0 0 8px;color:var(--accent);font-weight:800;font-size:22px}
.row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center}
.btn{border:1px solid #d1d5db;border-radius:8px;padding:6px 10px;background:#fff;cursor:pointer;font-weight:700}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.warn{background:var(--danger);color:#fff;border-color:var(--danger)}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
main{max-width:980px;margin:0 auto;padding:12px}
.card{background:var(--card);border:1px solid var(--bd);border-radius:var(--r);box-shadow:var(--shadow);padding:14px;margin:10px 0}
h3{margin:0 0 10px}
input,select{border:1px solid #cbd5e1;border-radius:8px;padding:8px 10px;font-weight:650}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:8px;margin-top:10px}
.item{border:1px solid var(--bd);border-radius:10px;padding:10px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:10px}
.small{color:var(--mut);font-size:13px;font-weight:650}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:.25s}
.toast.show{opacity:1}
</style>
</head>
<body>
<header>
  <div class="hin">
    <h1 id="pageHeader">ğŸ€ ê´€ë¦¬ìëª¨ë“œ</h1>
    <div class="row">
      <a class="btn" href="index.html">â† ê²½ê¸° ì…ë ¥</a>
    </div>
  </div>
</header>

<main>
  <section class="card">
    <h3>ì‚¬ì´íŠ¸ ì œëª©</h3>
    <div class="row">
      <input id="siteTitle" style="flex:1;min-width:220px" placeholder="ì˜ˆ: ìš°ë¦¬ë¶€ì„œ ë†êµ¬"/>
      <button id="saveTitle" class="btn primary">ì €ì¥</button>
    </div>
    <div class="small">ì œëª©ì€ ì…ë ¥/ê´€ë¦¬ì í˜ì´ì§€ ìƒë‹¨ì— ë°˜ì˜ë©ë‹ˆë‹¤.</div>
  </section>

  <section class="card">
    <h3>íŒ€ ê´€ë¦¬</h3>
    <div class="row">
      <input id="teamName" style="flex:1;min-width:220px" placeholder="íŒ€ ì´ë¦„"/>
      <button id="addTeam" class="btn primary">íŒ€ ë“±ë¡</button>
    </div>
    <div id="teamList" class="grid"></div>
  </section>

  <section class="card">
  <h3>ì„ ìˆ˜ ê´€ë¦¬</h3>
  <div class="row">
    <input id="playerName" style="flex:1;min-width:180px" placeholder="ì„ ìˆ˜ ì´ë¦„"/>
    <button id="addPlayer" class="btn primary">ì„ ìˆ˜ ë“±ë¡</button>
  </div>
  <div class="small">â€» ì„ ìˆ˜ëŠ” ì†Œì†íŒ€ ì—†ì´ ë“±ë¡í•˜ë©°, ê²½ê¸° ì…ë ¥ ë•Œë§ˆë‹¤ A/BíŒ€ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.</div>
  <div id="playerList" class="grid"></div>
</section>

  <section class="card">
    <h3>ì„¤ì •</h3>
    <div class="row">
      <label class="small">ì‚­ì œ ë¹„ë°€ë²ˆí˜¸</label>
      <input id="deletePassword" style="width:120px;text-align:center" placeholder="ì˜ˆ: 7910"/>
      <button id="saveDeletePassword" class="btn primary">ì €ì¥</button>
    </div>
    <div class="row" style="margin-top:8px">
      <label class="small">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
      <input id="adminPassword" style="width:120px;text-align:center" placeholder="ì˜ˆ: 1234"/>
      <button id="saveAdminPassword" class="btn primary">ì €ì¥</button>
    </div>
  </section>

  
<section class="card">
  <h3>UI ì„¤ì •</h3>
  <div class="row" style="justify-content:flex-start">
    <label style="font-weight:900">ëª¨ë°”ì¼ ì„ ìˆ˜ë²„íŠ¼ ì—´ ìˆ˜</label>
    <select id="uiMobileCols" style="min-width:140px">
      <option value="3">3ëª…</option>
      <option value="4">4ëª…</option>
    </select>
    <button class="btn ok" id="saveUi">ì €ì¥</button>
  </div>
  <div class="small" style="margin-top:6px">
    â€» íœ´ëŒ€í° í™”ë©´ì—ì„œ ì„ ìˆ˜ ì„ íƒ ë²„íŠ¼ì´ í•œ ì¤„ì— ëª‡ ê°œ ë‚˜ì˜¬ì§€ ì„¤ì •í•©ë‹ˆë‹¤.
  </div>
</section>

  <section class="card">
    <h3>ë°ì´í„° ê´€ë¦¬ (ì´ë²ˆë‹¬)</h3>
    <div class="row">
      <button id="deleteCurrentMonth" class="btn warn">ğŸ—‘ ì´ë²ˆë‹¬ ê²½ê¸° ì „ì²´ ì‚­ì œ</button>
    </div>
    <div class="small" style="color:var(--danger);font-weight:800;margin-top:6px">
      âš ï¸ ì´ë²ˆë‹¬ games ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí•©ë‹ˆë‹¤(ë³µêµ¬ ë¶ˆê°€). ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    </div>
  </section>
</main>

<div id="toast" class="toast">ì €ì¥</div>

<script type="module">
import { db } from "./firebase.js";
import { ref, onValue, push, set, remove, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const $ = (s)=>document.querySelector(s);
const toast = (m="ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤")=>{
  const t=$("#toast"); t.textContent=m; t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1500);
};
const pad2 = (n)=>String(n).padStart(2,"0");
const monthKey = (d)=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}`;

import { ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// í˜„ì¬ê°’ ë¶ˆëŸ¬ì˜¤ê¸°
onValue(ref(db,"config/uiMobileCols"), (snap)=>{
  const v = String(snap.val() ?? "4");
  const sel = document.getElementById("uiMobileCols");
  if(sel) sel.value = (v==="3" || v==="4") ? v : "4";
});

// ì €ì¥
document.getElementById("saveUi").addEventListener("click", async ()=>{
  const sel = document.getElementById("uiMobileCols");
  const v = Number(sel.value) || 4;
  await set(ref(db,"config/uiMobileCols"), v);
  alert("ì €ì¥ ì™„ë£Œ!");
});


// --- title
const titleRef = ref(db,"config/title");
onValue(titleRef, s=>{
  const v = s.val() ?? "Basketball";
  localStorage.setItem("siteTitle", v);
  document.title = `ğŸ€ ${v} ê´€ë¦¬ìëª¨ë“œ`;
  $("#pageHeader").textContent = `ğŸ€ ${v} ê´€ë¦¬ìëª¨ë“œ`;
  $("#siteTitle").value = v;
});
$("#saveTitle").onclick = async()=>{
  const v = $("#siteTitle").value.trim();
  if(!v) return toast("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”");
  await set(titleRef, v);
  toast("ì œëª© ì €ì¥ ì™„ë£Œ");
};

// --- teams
const teamsRef = ref(db,"teams");
let TEAMS = {}; // {id:{name}}
onValue(teamsRef, snap=>{
  TEAMS = snap.val() || {};
  renderTeams();
  renderTeamSelect();
});

function renderTeams(){
  const box=$("#teamList"); box.innerHTML="";
  const arr = Object.entries(TEAMS).map(([id,t])=>({id,...t}))
    .sort((a,b)=>String(a.name).localeCompare(String(b.name),'ko'));
  if(!arr.length){
    box.innerHTML = `<div class="small">ë“±ë¡ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  arr.forEach(t=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <div>
        <div style="font-weight:900">${t.name}</div>
        <div class="small">teamId: ${t.id}</div>
      </div>
      <button class="btn warn" data-del-team="${t.id}">ì‚­ì œ</button>
    `;
    div.querySelector("[data-del-team]").onclick = async()=>{
      if(!confirm(`íŒ€ "${t.name}"ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(íŒ€ì— ì†Œì†ëœ ì„ ìˆ˜ ì„¤ì •ë„ í™•ì¸ í•„ìš”)`)) return;
      await remove(ref(db,`teams/${t.id}`));
      toast("íŒ€ ì‚­ì œ ì™„ë£Œ");
    };
    box.appendChild(div);
  });
}

$("#addTeam").onclick = async()=>{
  const name = $("#teamName").value.trim();
  if(!name) return toast("íŒ€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
  await push(teamsRef, { name, createdAt: Date.now() });
  $("#teamName").value="";
  toast("íŒ€ ë“±ë¡ ì™„ë£Œ");
};

function renderTeamSelect(){
  const sel=$("#playerTeam");
  const arr = Object.entries(TEAMS).map(([id,t])=>({id,...t}))
    .sort((a,b)=>String(a.name).localeCompare(String(b.name),'ko'));
  sel.innerHTML = arr.map(t=>`<option value="${t.id}">${t.name}</option>`).join("");
}

// --- players
const playersRef = ref(db,"players");
let PLAYERS = {}; // {id:{name}}

onValue(playersRef, snap=>{
  PLAYERS = snap.val() || {};
  renderPlayers();
});

function renderPlayers(){
  const box=$("#playerList"); box.innerHTML="";
  const arr = Object.entries(PLAYERS).map(([id,p])=>({id,...p}))
    .sort((a,b)=>String(a.name).localeCompare(String(b.name),'ko'));

  if(!arr.length){
    box.innerHTML = `<div class="small">ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  arr.forEach(p=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML = `
      <div>
        <div style="font-weight:900">${p.name}</div>
        <div class="small">playerId: ${p.id}</div>
      </div>
      <button class="btn warn" data-del-player="${p.id}">ì‚­ì œ</button>
    `;
    div.querySelector("[data-del-player]").onclick = async()=>{
      if(!confirm(`ì„ ìˆ˜ "${p.name}"ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      await remove(ref(db,`players/${p.id}`));
      toast("ì„ ìˆ˜ ì‚­ì œ ì™„ë£Œ");
    };
    box.appendChild(div);
  });
}

$("#addPlayer").onclick = async()=>{
  const name = $("#playerName").value.trim();
  if(!name) return toast("ì„ ìˆ˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
  await push(playersRef, { name, joinedAt: Date.now() });
  $("#playerName").value="";
  toast("ì„ ìˆ˜ ë“±ë¡ ì™„ë£Œ");
};




// --- passwords
onValue(ref(db,"config/deletePassword"), s=>$("#deletePassword").value = s.val() ?? "7910");
$("#saveDeletePassword").onclick = async()=>{
  const v = $("#deletePassword").value.trim();
  if(!v) return toast("ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  await set(ref(db,"config/deletePassword"), v);
  toast("ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥");
};
onValue(ref(db,"config/adminPassword"), s=>$("#adminPassword").value = s.val() ?? "1234");
$("#saveAdminPassword").onclick = async()=>{
  const v = $("#adminPassword").value.trim();
  if(!v) return toast("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  await set(ref(db,"config/adminPassword"), v);
  toast("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì €ì¥");
};

// --- delete current month games
$("#deleteCurrentMonth").onclick = async()=>{
  if(!confirm("âš ï¸ ì´ë²ˆë‹¬ ê²½ê¸° ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë³µêµ¬ ë¶ˆê°€)")) return;

  const pwSnap = await get(ref(db,"config/deletePassword"));
  const savedPw = pwSnap.exists() ? String(pwSnap.val()) : "7910";

  const input = prompt("ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
  if(input === null) return;
  if(input.trim() !== savedPw.trim()) return alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");

  const now = new Date();
  const thisMonth = monthKey(now);

  const snap = await get(ref(db,"games"));
  const data = snap.val() || {};
  let count = 0;

  for(const [id,g] of Object.entries(data)){
    if(g?.monthKey === thisMonth){
      await remove(ref(db,`games/${id}`));
      count++;
    }
  }
  toast(`âœ… ${thisMonth} ê²½ê¸° ${count}ê±´ ì‚­ì œ ì™„ë£Œ`);
};
</script>
</body>
</html>
