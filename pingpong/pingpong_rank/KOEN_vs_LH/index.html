<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“ KOEN vs LH ë¦¬ê·¸ ë¹„êµ</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --koen:#2563eb; --lh:#f97316;
  --bg:#f5f7fb; --card:#fff; --ink:#0f172a; --muted:#64748b;
  --shadow:0 8px 28px rgba(0,0,0,.08);
}
*{box-sizing:border-box;font-family:"Pretendard","Noto Sans KR",sans-serif;}
body{margin:0;background:var(--bg);color:var(--ink);padding:20px;display:flex;flex-direction:column;align-items:center;}
header{text-align:center;margin-bottom:20px;}
h1{font-size:clamp(20px,5vw,28px);margin-bottom:6px;}
p{color:var(--muted);font-size:clamp(13px,3vw,15px);}
section{width:100%;max-width:640px;background:var(--card);box-shadow:var(--shadow);border-radius:16px;padding:20px;margin-bottom:20px;}
.section-title{text-align:center;font-size:clamp(16px,4vw,20px);margin-bottom:12px;}
.stats{display:flex;justify-content:space-around;flex-wrap:wrap;gap:12px;}
.card{flex:1;min-width:150px;background:var(--bg);border-radius:12px;padding:12px;}
.card h3{margin:0;font-size:17px;}
.card p{margin:4px 0;font-size:14px;color:var(--muted);}
.chart-container{width:100%;height:260px;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:12px;}
</style>
</head>
<body>

<header>
  <h1>ğŸ“ KOEN vs LH íƒêµ¬ë¦¬ê·¸ ë¹„êµ</h1>
  <p>2025ë…„ 10ì›” í™œë™ ë° íšŒì›í˜„í™©</p>
</header>

<section>
  <div class="section-title">ğŸ“Š ì¢…í•© ìš”ì•½</div>
  <div class="stats">
    <div class="card" style="border:2px solid var(--koen)">
      <h3>KOEN</h3>
      <p>íšŒì› ìˆ˜: <b id="koenMembers">-</b></p>
      <p>ê²½ê¸° ìˆ˜: <b id="koenGames">-</b></p>
      <p>í‰ê·  ìŠ¹ë¥ : <b id="koenRate">-</b>%</p>
      <p>í™œë™ì§€ìˆ˜: <b id="koenScore">-</b></p>
    </div>
    <div class="card" style="border:2px solid var(--lh)">
      <h3>LH</h3>
      <p>íšŒì› ìˆ˜: <b id="lhMembers">-</b></p>
      <p>ê²½ê¸° ìˆ˜: <b id="lhGames">-</b></p>
      <p>í‰ê·  ìŠ¹ë¥ : <b id="lhRate">-</b>%</p>
      <p>í™œë™ì§€ìˆ˜: <b id="lhScore">-</b></p>
    </div>
  </div>
</section>

<section>
  <div class="section-title">ğŸ“ˆ í™œë™ ë¹„êµ ê·¸ë˜í”„</div>
  <div class="chart-container"><canvas id="activityChart"></canvas></div>
</section>

<section>
  <div class="section-title">ğŸ† í‰ê·  ìŠ¹ë¥  ë¹„êµ</div>
  <div class="chart-container"><canvas id="winrateChart"></canvas></div>
</section>

<section>
  <div class="section-title">ğŸ‘¥ íšŒì› ìˆ˜ ë¹„êµ</div>
  <div class="chart-container"><canvas id="memberChart"></canvas></div>
</section>

<footer>Â© 2025 ë‚¨ë™ë³¸ì‚¬ & LH íƒêµ¬ë™í˜¸íšŒ</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// ğŸ”¹ KOEN Firebase
const koenConfig = {
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};

// ğŸ”¹ LH Firebase
const lhConfig = {
  apiKey:"AIzaSyCM6FQqWaeI4Rx3ovD6OnhA_o-sgFvyWyI",
  authDomain:"pingpongclub2-6ce04.firebaseapp.com",
  databaseURL:"https://pingpongclub2-6ce04-default-rtdb.firebaseio.com",
  projectId:"pingpongclub2-6ce04",
  storageBucket:"pingpongclub2-6ce04.firebasestorage.app",
  messagingSenderId:"27948766659",
  appId:"1:27948766659:web:b7f79c1937c2123ed29976"
};

// ì•± ì´ˆê¸°í™”
const appKoen = initializeApp(koenConfig, "koenApp");
const appLh = initializeApp(lhConfig, "lhApp");
const dbKoen = getDatabase(appKoen);
const dbLh = getDatabase(appLh);

// ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
async function fetchClubData(db) {
  const [playersSnap, matchesSnap] = await Promise.all([
    get(child(ref(db), "players")),
    get(child(ref(db), "matches"))
  ]);

  const players = playersSnap.exists() ? Object.values(playersSnap.val()) : [];
  const matches = matchesSnap.exists() ? Object.values(matchesSnap.val()) : [];

  // ìŠ¹íŒ¨ ê³„ì‚°
  const wins = matches.filter(m => m.result === "win").length;
  const losses = matches.filter(m => m.result === "lose").length;
  const total = wins + losses;
  const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;

  return {
    memberCount: players.length,
    totalGames: matches.length,
    winRate,
    score: Math.round(matches.length * (winRate / 100))
  };
}

Promise.all([fetchClubData(dbKoen), fetchClubData(dbLh)]).then(([koen, lh]) => {
  document.getElementById("koenMembers").textContent = koen.memberCount;
  document.getElementById("koenGames").textContent = koen.totalGames;
  document.getElementById("koenRate").textContent = koen.winRate;
  document.getElementById("koenScore").textContent = koen.score;

  document.getElementById("lhMembers").textContent = lh.memberCount;
  document.getElementById("lhGames").textContent = lh.totalGames;
  document.getElementById("lhRate").textContent = lh.winRate;
  document.getElementById("lhScore").textContent = lh.score;

  // í™œë™ ê·¸ë˜í”„
  new Chart(document.getElementById("activityChart"), {
    type: "bar",
    data: {
      labels: ["KOEN", "LH"],
      datasets: [{
        label: "ì´ ê²½ê¸° ìˆ˜",
        data: [koen.totalGames, lh.totalGames],
        backgroundColor: ["#2563eb", "#f97316"],
        borderRadius: 8
      }]
    },
    options: { plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });

  // ìŠ¹ë¥  ë„ë„›
  new Chart(document.getElementById("winrateChart"), {
    type: "doughnut",
    data: {
      labels: ["KOEN", "LH"],
      datasets: [{ data: [koen.winRate, lh.winRate], backgroundColor: ["#2563eb","#f97316"] }]
    },
    options: { cutout:"70%", plugins:{legend:{position:"bottom"}} }
  });

  // íšŒì› ìˆ˜ ê·¸ë˜í”„
  new Chart(document.getElementById("memberChart"), {
    type: "bar",
    data: {
      labels: ["KOEN", "LH"],
      datasets: [{ label:"íšŒì› ìˆ˜", data:[koen.memberCount, lh.memberCount], backgroundColor:["#2563eb","#f97316"], borderRadius:8 }]
    },
    options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
});
</script>
</body>
</html>
