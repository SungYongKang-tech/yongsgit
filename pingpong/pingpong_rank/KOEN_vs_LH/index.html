<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🏓 KOEN vs LH 리그 비교 대시보드</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --koen:#2563eb; --lh:#f97316;
  --bg:#f5f7fb; --card:#fff; --ink:#0f172a; --muted:#64748b;
  --shadow:0 6px 20px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;font-family:"Pretendard","Noto Sans KR",sans-serif;}
body{margin:0;background:var(--bg);color:var(--ink);padding:18px;display:flex;flex-direction:column;align-items:center;}
header{text-align:center;margin-bottom:18px;}
h1{font-size:clamp(20px,5vw,28px);margin-bottom:4px;}
p{color:var(--muted);font-size:clamp(13px,3vw,15px);}
section{width:100%;max-width:700px;background:var(--card);box-shadow:var(--shadow);border-radius:16px;padding:20px;margin-bottom:20px;}
.section-title{text-align:center;font-size:18px;margin-bottom:12px;}
.card-wrap{display:flex;flex-wrap:wrap;justify-content:space-around;gap:12px;}
.card{flex:1;min-width:150px;background:var(--bg);border-radius:12px;padding:12px;transition:transform .2s;}
.card:hover{transform:translateY(-3px);}
.card h3{margin:0;font-size:17px;}
.card p{margin:4px 0;font-size:14px;color:var(--muted);}
.winner-banner{
  text-align:center;background:linear-gradient(90deg,var(--koen),var(--lh));
  color:white;padding:10px 0;border-radius:12px;margin-bottom:10px;
  font-size:clamp(14px,3vw,16px);font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.chart-container{width:100%;height:280px;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:12px;}
</style>
</head>
<body>

<header>
  <h1>🏓 KOEN vs LH 리그 비교 대시보드</h1>
  <p>2025년 10월 활동 및 회원 현황</p>
</header>

<section>
  <div class="winner-banner" id="winnerText">결과를 불러오는 중...</div>
  <div class="card-wrap">
    <div class="card" style="border:2px solid var(--koen)">
      <h3>KOEN</h3>
      <p>회원 수: <b id="koenMembers">-</b></p>
      <p>경기 수: <b id="koenGames">-</b></p>
      <p>평균 승률: <b id="koenRate">-</b>%</p>
      <p>활동지수: <b id="koenScore">-</b></p>
    </div>
    <div class="card" style="border:2px solid var(--lh)">
      <h3>LH</h3>
      <p>회원 수: <b id="lhMembers">-</b></p>
      <p>경기 수: <b id="lhGames">-</b></p>
      <p>평균 승률: <b id="lhRate">-</b>%</p>
      <p>활동지수: <b id="lhScore">-</b></p>
    </div>
  </div>
</section>

<section>
  <div class="section-title">📈 종합 비교 (Radar Chart)</div>
  <div class="chart-container"><canvas id="radarChart"></canvas></div>
</section>

<section>
  <div class="section-title">👥 회원 레벨 분포 (예시)</div>
  <div class="chart-container"><canvas id="levelChart"></canvas></div>
</section>

<footer>© 2025 남동본사 & LH 탁구동호회</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// Firebase 설정
const koenConfig = {
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
const lhConfig = {
  apiKey:"AIzaSyCM6FQqWaeI4Rx3ovD6OnhA_o-sgFvyWyI",
  authDomain:"pingpongclub2-6ce04.firebaseapp.com",
  databaseURL:"https://pingpongclub2-6ce04-default-rtdb.firebaseio.com",
  projectId:"pingpongclub2-6ce04",
  storageBucket:"pingpongclub2-6ce04.firebasestorage.app",
  messagingSenderId:"27948766659",
  appId:"1:27948766659:web:b7f79c1937c2123ed29976"
};

const appKoen = initializeApp(koenConfig, "koenApp");
const appLh = initializeApp(lhConfig, "lhApp");
const dbKoen = getDatabase(appKoen);
const dbLh = getDatabase(appLh);

async function fetchClub(db){
  const [pSnap,mSnap] = await Promise.all([
    get(child(ref(db),"players")),
    get(child(ref(db),"matches"))
  ]);
  const players = pSnap.exists()?Object.values(pSnap.val()):[];
  const matches = mSnap.exists()?Object.values(mSnap.val()):[];

  const wins = matches.filter(m=>m.result==="win").length;
  const losses = matches.filter(m=>m.result==="lose").length;
  const total = wins+losses;
  const winRate = total?((wins/total)*100).toFixed(1):0;

  // 레벨별 카운트
  const levelCount = [1,2,3,4,5,6].map(l => players.filter(p=>p.level==l).length);

  return {
    members: players.length,
    games: matches.length,
    rate: winRate,
    score: Math.round(matches.length*(winRate/100)),
    levelCount
  };
}

Promise.all([fetchClub(dbKoen), fetchClub(dbLh)]).then(([koen,lh])=>{
  // 숫자 표시
  document.getElementById("koenMembers").textContent = koen.members;
  document.getElementById("koenGames").textContent = koen.games;
  document.getElementById("koenRate").textContent = koen.rate;
  document.getElementById("koenScore").textContent = koen.score;
  document.getElementById("lhMembers").textContent = lh.members;
  document.getElementById("lhGames").textContent = lh.games;
  document.getElementById("lhRate").textContent = lh.rate;
  document.getElementById("lhScore").textContent = lh.score;

  // 승자 계산
  const totalK = koen.games+koen.score;
  const totalL = lh.games+lh.score;
  const winner = totalK > totalL ? "KOEN 🏆" : (totalK < totalL ? "LH 🏆" : "무승부 🤝");
  document.getElementById("winnerText").textContent =
    `${winner}이(가) 이번 달 더 활발히 활동했습니다!`;

  // Radar Chart
  new Chart(document.getElementById("radarChart"),{
    type:"radar",
    data:{
      labels:["회원수","경기수","승률","활동지수"],
      datasets:[
        {label:"KOEN",data:[koen.members,koen.games,koen.rate,koen.score],
         borderColor:"#2563eb",backgroundColor:"rgba(37,99,235,0.2)",fill:true},
        {label:"LH",data:[lh.members,lh.games,lh.rate,lh.score],
         borderColor:"#f97316",backgroundColor:"rgba(249,115,22,0.2)",fill:true}
      ]
    },
    options:{scales:{r:{beginAtZero:true,angleLines:{color:"#ddd"}}}}
  });

  // Level 분포 비교
  new Chart(document.getElementById("levelChart"),{
    type:"bar",
    data:{
      labels:["Lv1","Lv2","Lv3","Lv4","Lv5","Lv6"],
      datasets:[
        {label:"KOEN",data:koen.levelCount,backgroundColor:"rgba(37,99,235,0.8)",borderRadius:6},
        {label:"LH",data:lh.levelCount,backgroundColor:"rgba(249,115,22,0.8)",borderRadius:6}
      ]
    },
    options:{plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:true}}}
  });
});
</script>
</body>
</html>
