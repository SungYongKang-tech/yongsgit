<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ“ KOEN vs LH ë¦¬ê·¸ ì¸ì‚¬ì´íŠ¸</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{ --koen:#2563eb; --lh:#f97316; --bg:#f6f8fb; --card:#fff; --muted:#64748b; --ink:#0f172a; --shadow:0 6px 20px rgba(0,0,0,0.08); }
*{box-sizing:border-box;font-family:"Pretendard","Noto Sans KR",sans-serif;}
body{margin:0;background:var(--bg);color:var(--ink);padding:18px;display:flex;flex-direction:column;align-items:center;}
header{text-align:center;margin-bottom:16px;}
h1{font-size:clamp(22px,5vw,28px);margin-bottom:6px;}
p{color:var(--muted);font-size:14px;}
section{width:100%;max-width:740px;background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:20px;margin-bottom:20px;display: flex;flex-direction: column;align-items: stretch;}
.section-title{text-align:center;font-size:18px;margin:4px 0 6px;}
.banner{padding:10px;border-radius:10px;margin-bottom:8px;font-weight:600;}
.winner-banner{ text-align:center;background:linear-gradient(90deg,var(--koen),var(--lh));color:white; }
.error-banner{ background:#fee2e2;color:#991b1b; display:none; }
.chart-container{width:100%;height:auto;min-height:auto;margin-top: 0;display: flex;justify-content: center;align-items: center;}
footer{text-align:center;color:var(--muted);font-size:13px;margin-top:10px;}
#monthlyReport{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:18px;}
.report-wrapper{display:flex;flex-wrap:wrap;gap:16px;margin-top:10px;}
.report-card{flex:1 1 340px;background:var(--bg);border-radius:12px;padding:12px 14px;border-left:5px solid var(--koen);}
.report-card.lh{border-left-color:var(--lh);}
.report-card h4{margin:0 0 10px;font-size:15px;color:var(--ink);}
.report-card table{width:100%;border-collapse:collapse;font-size:14px;}
.report-card th,.report-card td{text-align:center;padding:6px 0;}
.report-card th{background:#f1f5f9;font-weight:600;color:#334155;}
.report-card tr:nth-child(even) td{background:rgba(0,0,0,0.02);}
.top-player{ text-align:center;margin-bottom:14px;padding:10px;background:linear-gradient(90deg,#fef3c7,#fde68a);border-radius:12px;font-weight:600;color:#78350f;box-shadow:0 3px 8px rgba(0,0,0,0.08); }

.section-title { margin-bottom: 2px; }
.chart-container { margin-top: 0; }

/* ğŸŒ™ ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #1e293b;          /* ì „ì²´ ë°°ê²½ - ì–´ë‘ìš´ ë‚¨íšŒìƒ‰ */
    --card: #334155;        /* ì¹´ë“œ ë°°ê²½ - ì‚´ì§ ë°ì€ ë‚¨íšŒìƒ‰ */
    --ink: #f1f5f9;         /* ë³¸ë¬¸ ê¸€ì - ë°ì€ í°ìƒ‰ */
    --muted: #cbd5e1;       /* ì„¤ëª… í…ìŠ¤íŠ¸ - ì€ì€í•œ íšŒìƒ‰ */
    --shadow: 0 6px 20px rgba(0,0,0,0.4); /* ê·¸ë¦¼ì ì¡°ê¸ˆ ì§„í•˜ê²Œ */
  }

  body {
    background: var(--bg);
    color: var(--ink);
  }

  section {
    background: var(--card);
    box-shadow: var(--shadow);
  }

  .banner.winner-banner {
    background: linear-gradient(90deg, #3b82f6, #fb923c);
  }

  footer {
    color: var(--muted);
  }
}


</style>
</head>
<body>
<header>
  <h1>ğŸ“ KOEN vs LH ë¦¬ê·¸ ì¸ì‚¬ì´íŠ¸</h1>
  
</header>

<section>
  <div id="errorText" class="banner error-banner">ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
  <div class="banner winner-banner" id="winnerText">ë°ì´í„° ê³„ì‚° ì¤‘...</div>
 <!-- <div class="section-title">ğŸ“ ì›”ê°„ ë¦¬ê·¸ í¼í¬ë¨¼ìŠ¤ ë¹„êµ</div>-->
  <div class="chart-container"><canvas id="radarChart"></canvas></div>

<!-- âœ… ì—¬ê¸°ì— ì¶”ê°€ -->
  <div class="index-guide">
    <h3>ğŸ“˜ ì§€í‘œ ì„¤ëª…</h3>
    <ul>
      <li>ğŸ•’ <b>ì‹œê°„ëŒ€ì§€ìˆ˜</b> : íŠ¹ì • ì‹œê°„ëŒ€ì— ì–¼ë§ˆë‚˜ í™œë°œí•˜ê²Œ ê²½ê¸°ê°€ ì—´ë ¸ë‚˜</li>
      <li>ğŸ… <b>ìŠ¹ë¥ ì§€ìˆ˜</b> : ì „ì²´ íšŒì›ì˜ í‰ê·  ìŠ¹ë¥ ë¡œ, íŒ€ì˜ ì „ë°˜ì ì¸ ê²½ê¸°ë ¥</li>
      <li>ğŸ¯ <b>ì°¸ì—¬ìœ¨</b> : ì „ì²´ íšŒì› ì¤‘ ì‹¤ì œë¡œ ê²½ê¸°ì— ì°¸ì—¬í•œ ë¹„ìœ¨</li>
    </ul>
  </div>

</section>

<section id="monthlyReport">
  <div class="section-title">ğŸ“… ì§€ë‚œë‹¬ í´ëŸ½ë³„ ì›”ê°„ ë¦¬í¬íŠ¸<br>(15ê²½ê¸° ì´ìƒ)</div>
  <div class="report-wrapper">
    <div class="report-card" id="koenReport"></div>
    <div class="report-card lh" id="lhReport"></div>
  </div>
</section>

<section id="levelDist">
  <div class="section-title">ğŸ“ ë¶€ìˆ˜ë³„ ì¸ì› ë¶„í¬ ë¹„êµ</div>
  <div class="chart-container"><canvas id="levelChart"></canvas></div>
</section>

<section id="timeDist">
  <div class="section-title">ğŸ•’ ê²½ê¸° ì‹œê°„ëŒ€ ë¶„í¬ ë¹„êµ</div>
  <div class="chart-container" style="display:flex;flex-wrap:wrap;gap:16px;justify-content:center;">
    <div style="flex:1;min-width:300px;">
      <h4 style="text-align:center;margin-bottom:8px;color:#2563eb;">KOEN</h4>
      <canvas id="chartKoenTime"></canvas>
    </div>
    <div style="flex:1;min-width:300px;">
      <h4 style="text-align:center;margin-bottom:8px;color:#f97316;">LH</h4>
      <canvas id="chartLhTime"></canvas>
    </div>
  </div>
</section>


<footer>Â© 2025 ë‚¨ë™ë³¸ì‚¬ & LH íƒêµ¬ë™í˜¸íšŒ</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";


/* ========= ë‚ ì§œ ========= */
const now = new Date();
const year = now.getFullYear();
const month = String(now.getMonth()+1).padStart(2,"0");
const monthKey = `${year}-${month}`;
const prev = new Date(now.getFullYear(), now.getMonth()-1);
const prevKey = `${prev.getFullYear()}-${String(prev.getMonth()+1).padStart(2,"0")}`;

/* ========= Firebase ========= */
const koenConfig={apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",authDomain:"pingpongclub-4a5fd.firebaseapp.com",databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",projectId:"pingpongclub-4a5fd"};
const lhConfig={apiKey:"AIzaSyCM6FQqWaeI4Rx3ovD6OnhA_o-sgFvyWyI",authDomain:"pingpongclub2-6ce04.firebaseapp.com",databaseURL:"https://pingpongclub2-6ce04-default-rtdb.firebaseio.com",projectId:"pingpongclub2-6ce04"};
const appKoen=initializeApp(koenConfig,"koen");
const appLh=initializeApp(lhConfig,"lh");
const dbKoen=getDatabase(appKoen);
const dbLh=getDatabase(appLh);

/* ========= ê³µí†µ ìœ í‹¸ ========= */
const showError = (msg) => {
  const el = document.getElementById('errorText');
  el.textContent = `âš ï¸ ${msg}`;
  el.style.display = 'block';
  console.error(msg);
};
window.addEventListener('error', e => showError(e.message));

function calcTimeIndex(matches){
  if(!matches.length) return 0;
  const z={morning:0,noon:0,evening:0,night:0};
  matches.forEach(m=>{
    const h=new Date(m.createdAt||0).getHours();
    if(h>=5&&h<11)z.morning++; else if(h>=11&&h<15)z.noon++;
    else if(h>=15&&h<21)z.evening++; else z.night++;
  });
  const concentration=(Math.max(...Object.values(z))/matches.length)*100;
  return (100 - concentration).toFixed(1);
}

/* âœ… ìŠ¹ë¥ ì§€ìˆ˜: winnerSide + namesA/B + 1~9ë¶€ë§Œ */
function calcWinRateByLevel(matches, players){
  if(!matches.length || !players.length) return 0;
  const levelMap = {};
  players.forEach(p=>{
    const lv=parseInt(p.level||0);
    if(lv>=1 && lv<=9 && p.name) levelMap[p.name.trim()] = lv;
  });

  const levelStats = {};
  matches.forEach(m=>{
    if(!m.winnerSide) return;
    const A = m.namesA || [], B = m.namesB || [];
    const winners = m.winnerSide === "A" ? A : (m.winnerSide === "B" ? B : []);
    const losers  = m.winnerSide === "A" ? B : (m.winnerSide === "B" ? A : []);

    winners.forEach(n=>{
      const lv = levelMap[n];
      if(!lv) return;
      if(!levelStats[lv]) levelStats[lv] = { win:0, total:0 };
      levelStats[lv].win++; levelStats[lv].total++;
    });
    losers.forEach(n=>{
      const lv = levelMap[n];
      if(!lv) return;
      if(!levelStats[lv]) levelStats[lv] = { win:0, total:0 };
      levelStats[lv].total++;
    });
  });

  let totalRate=0, count=0;
  for(let lv=1; lv<=9; lv++){
    const s=levelStats[lv];
    if(s && s.total>0){
      totalRate += (s.win/s.total)*100;
      count++;
    }
  }
  const avg = count>0 ? (totalRate/count).toFixed(1) : 0;
  console.debug("ğŸ“ ìŠ¹ë¥ ì§€ìˆ˜:", {avg, levelStats});
  return avg;
}

/* ========= ì‹¤ì‹œê°„ êµ¬ë…: matchesëŠ” ë£¨íŠ¸ì—ì„œ ì½ê³  monthKeyë¡œ í•„í„° ========= */
function listenClub(db, name, cb){
  const pRef = ref(db, "players");
  const mRef = ref(db, "matches"); // âœ… ë£¨íŠ¸
  onValue(pRef, pSnap=>{
    onValue(mRef, mSnap=>{
      const players = pSnap.exists()? Object.values(pSnap.val()) : [];
      const all = mSnap.exists()? Object.values(mSnap.val()) : [];

      // ì´ë²ˆ ë‹¬ë§Œ í•„í„°
      const matches = all.filter(m => m?.monthKey === monthKey);

      const memberCount = players.length;
      const games = matches.length;
      const activeRate = memberCount ? ((games/memberCount)*10).toFixed(1) : 0;
      const timeIndex = calcTimeIndex(matches);
      const winRate = calcWinRateByLevel(matches, players);

      cb({ name, memberCount, games, activeRate, timeIndex, winRate });
    }, err => showError(`matches êµ¬ë… ì˜¤ë¥˜: ${err?.message||err}`));
  }, err => showError(`players êµ¬ë… ì˜¤ë¥˜: ${err?.message||err}`));
}

/* ========= ë ˆì´ë” ========= */
let radar;
function render(koen, lh){
  try{
document.getElementById("winnerText").textContent = `${year}ë…„ ${month}ì›” ë¦¬ê·¸ í¼í¬ë¨¼ìŠ¤ ë¹„êµ`;

    if(radar) radar.destroy();
    const normalize = (v,max)=> (max===0?0:Math.min(100,(v/max)*100));
    const maxMembers=Math.max(koen.memberCount, lh.memberCount, 1);
    const maxGames=Math.max(koen.games, lh.games, 1);
    const maxActive=Math.max(koen.activeRate, lh.activeRate, 1);
    const maxWin=Math.max(koen.winRate, lh.winRate, 1);
    const maxTime=Math.max(koen.timeIndex, lh.timeIndex, 1);

    const labels=[
      `íšŒì›ìˆ˜\n(${koen.memberCount}/${lh.memberCount})`,
      `ê²½ê¸°ìˆ˜\n(${koen.games}/${lh.games})`,
      `ì°¸ì—¬ìœ¨\n(${koen.activeRate}/${lh.activeRate})`,
      `ìŠ¹ë¥ ì§€ìˆ˜\n(${koen.winRate}/${lh.winRate})`,
      `ì‹œê°„ëŒ€ì§€ìˆ˜\n(${koen.timeIndex}/${lh.timeIndex})`
    ];

    radar = new Chart(document.getElementById("radarChart"), {
      type: "radar",
      data: {
        labels,
        datasets: [
          {
            label: "KOEN",
            data: [
              normalize(koen.memberCount, maxMembers),
              normalize(koen.games, maxGames),
              normalize(koen.activeRate, maxActive),
              normalize(koen.winRate, maxWin),
              normalize(koen.timeIndex, maxTime)
            ],
            borderColor:"rgba(37,99,235,0.6)",
            backgroundColor:"rgba(37,99,235,0.25)",
            pointBackgroundColor:"#2563eb"
          },
          {
            label: "LH",
            data: [
              normalize(lh.memberCount, maxMembers),
              normalize(lh.games, maxGames),
              normalize(lh.activeRate, maxActive),
              normalize(lh.winRate, maxWin),
              normalize(lh.timeIndex, maxTime)
            ],
            borderColor:"rgba(249,115,22,0.6)",
            backgroundColor:"rgba(249,115,22,0.25)",
            pointBackgroundColor:"#f97316"
          }
        ]
      },
      options:{
        maintainAspectRatio:false,
        plugins:{legend:{position:"bottom"}},
        scales:{
          r:{
            beginAtZero:true,max:100,ticks:{display:false},
            grid:{color:"rgba(0,0,0,0.08)"},
            pointLabels:{padding:18,font:{size:12,weight:"500"},color:"#334155",callback:v=>v.split("\n")}
          }
        }
      }
    });
  }catch(e){
    showError(`ë ˆì´ë” ë Œë” ì˜¤ë¥˜: ${e.message}`);
  }
}

listenClub(dbKoen, "koen", data => { 
  koen = data; 
  if(lh.name) render(koen, lh); 
});
listenClub(dbLh, "lh", data => { 
  lh = data; 
  if(koen.name) render(koen, lh); 
});

// ğŸ§© ë‘ í´ëŸ½ ì„ ìˆ˜ ë°ì´í„°ë„ ë¶ˆëŸ¬ì™€ì„œ ë¶€ìˆ˜ë³„ ë¶„í¬ ë Œë”ë§

async function loadLevelDist(){
  const pKoenSnap = await get(ref(dbKoen, "players"));
  const pLhSnap = await get(ref(dbLh, "players"));
  const koenPlayers = pKoenSnap.exists()? Object.values(pKoenSnap.val()) : [];
  const lhPlayers = pLhSnap.exists()? Object.values(pLhSnap.val()) : [];
  renderLevelDistribution(koenPlayers, lhPlayers);
}
loadLevelDist();

/* ========= ê²½ê¸° ì‹œê°„ëŒ€ ë¶„í¬ ========= */
function calcTimeDistData(matches){
  const z={morning:0,noon:0,evening:0,night:0};
  matches.forEach(m=>{
    const h=new Date(m.createdAt||0).getHours();
    if(h>=5 && h<9) z.morning++;        // ğŸŒ… ì•„ì¹¨ (05~09ì‹œ)
    else if(h>=11 && h<13) z.noon++;    // â˜€ ì ì‹¬ (11~13ì‹œ)
    else if(h>=18 && h<20) z.evening++; // ğŸŒ‡ ì €ë… (18~20ì‹œ)
    else if(h>=20 && h<22) z.night++;   // ğŸŒ™ ì•¼ê°„ (20~22ì‹œ)
  });
  return z;
}

async function renderTimeDistribution(){
  const [koenSnap, lhSnap] = await Promise.all([
    get(ref(dbKoen,"matches")),
    get(ref(dbLh,"matches"))
  ]);
  const koenMatches = koenSnap.exists()?Object.values(koenSnap.val()).filter(m=>m.monthKey===monthKey):[];
  const lhMatches   = lhSnap.exists()?Object.values(lhSnap.val()).filter(m=>m.monthKey===monthKey):[];

  const k=calcTimeDistData(koenMatches);
  const l=calcTimeDistData(lhMatches);

  const labels=['ğŸŒ… ì•„ì¹¨(05~09ì‹œ)','â˜€ ì ì‹¬(11~13ì‹œ)','ğŸŒ‡ ì €ë…(18~20ì‹œ)','ğŸŒ™ ì•¼ê°„(20~22ì‹œ)'];
  const koenData=[k.morning,k.noon,k.evening,k.night];
  const lhData=[l.morning,l.noon,l.evening,l.night];

  const makeChart=(ctx,data,color)=>new Chart(ctx,{
    type:'doughnut',
    data:{
      labels,
      datasets:[{
        data,
        backgroundColor:[
          '#93c5fd', // ì•„ì¹¨ - ì—°í•˜ëŠ˜
          '#fde68a', // ì ì‹¬ - ë°ì€ ë…¸ë‘
          '#fca5a5', // ì €ë… - ì½”ë„
          '#a78bfa'  // ì•¼ê°„ - ì—°ë³´ë¼
        ],
        borderColor:'#fff',
        borderWidth:2
      }]
    },
    options: {
    plugins: {
      legend: {
        position: 'bottom',
        labels:{
  font:{ size:13 },
  color: window.matchMedia('(prefers-color-scheme: dark)').matches 
    ? '#f8fafc' // ğŸŒ™ ë” ë°ì€ í°ìƒ‰
    : '#334155'
}
      },
      title: { display: false }
    },
    cutout: '55%'
    }
  });

  makeChart(document.getElementById('chartKoenTime'),koenData,'#2563eb');
  makeChart(document.getElementById('chartLhTime'),lhData,'#f97316');
}

renderTimeDistribution();

/* ========= ì§€ë‚œë‹¬ ë¦¬í¬íŠ¸ (15ê²½ê¸° ì´ìƒ) ========= */
function calcPlayerStatsDetailed(matches, players){
  const stats={}; const levelMap={};
  players.forEach(p => levelMap[p.name] = p.level || "-");
  matches.forEach(m=>{
    const A = m.namesA || [], B = m.namesB || [];
    if(m.winnerSide==="A"){
      A.forEach(n=>{ stats[n] = stats[n]||{win:0,lose:0,games:0}; stats[n].win++;  stats[n].games++; });
      B.forEach(n=>{ stats[n] = stats[n]||{win:0,lose:0,games:0}; stats[n].lose++; stats[n].games++; });
    }else if(m.winnerSide==="B"){
      B.forEach(n=>{ stats[n] = stats[n]||{win:0,lose:0,games:0}; stats[n].win++;  stats[n].games++; });
      A.forEach(n=>{ stats[n] = stats[n]||{win:0,lose:0,games:0}; stats[n].lose++; stats[n].games++; });
    }
  });
  return Object.entries(stats)
    .filter(([_,s])=> s.games>=15)
    .map(([name,s])=>({ name, level: levelMap[name]||"-", games:s.games, win:s.win, lose:s.lose, rate: ((s.win/s.games)*100).toFixed(1) }))
    .sort((a,b)=> b.rate - a.rate);
}

function renderMonthlyReport(db, clubName, containerId){
  const reportRef = ref(db, `monthlyReports/${prevKey}/players`);

  onValue(reportRef, snap => {
    const box = document.getElementById(containerId);

    if (!snap.exists()) {
      box.innerHTML = `<h4>${clubName.toUpperCase()} âšª ë°ì´í„° ì—†ìŒ</h4>
        <p style="color:var(--muted);font-size:13px;">${prevKey}ì›” ë¦¬í¬íŠ¸ ì—†ìŒ</p>`;
      return;
    }

    // Firebaseì˜ players ë°°ì—´ ë°ì´í„°
    const stats = Object.values(snap.val())
      .filter(s => s.total >= 15) // âœ… 15ê²½ê¸° ì´ìƒ
      .sort((a, b) => b.rate - a.rate);

    if (!stats.length) {
      box.innerHTML = `<h4>${clubName.toUpperCase()} âšª ë°ì´í„° ì—†ìŒ</h4>
        <p style="color:var(--muted);font-size:13px;">15ê²½ê¸° ì´ìƒ ì°¸ê°€ì ì—†ìŒ</p>`;
      return;
    }

    const top = stats[0];
// âœ… ì´ ê²½ê¸° ìˆ˜ ê³„ì‚°
    const totalMatches = Math.round(stats.reduce((sum, s) => sum + s.total, 0) / 2);

    box.innerHTML = `
      <div class="top-player">ğŸ† TOP PLAYER: ${top.name} (${top.level}) â€” ìŠ¹ë¥  ${top.rate}% (${top.win}ìŠ¹ ${top.lose}íŒ¨)</div>
      <h4>${clubName.toUpperCase()} í´ëŸ½</h4>
      <table>
        <thead>
          <tr><th>ì´ë¦„(ë¶€ìˆ˜)</th><th>ê²½ê¸°ìˆ˜</th><th>ìŠ¹/íŒ¨</th><th>ìŠ¹ë¥ </th></tr>
        </thead>
        <tbody>
          ${stats.map(s => `
            <tr>
              <td>${s.name} (${s.level})</td>
              <td>${s.total}</td>
              <td>${s.win}/${s.lose}</td>
              <td>${s.rate}%</td>
            </tr>`).join("")}
        </tbody>
      </table>
      <p style="text-align:center;margin-top:8px;font-size:13px;color:#1e3a8a;font-weight:600;">
        ğŸ”¹ ì´ ê²½ê¸° ìˆ˜: <b>${totalMatches} ê²½ê¸°</b>
      </p>
    `;

  });
}


/* ========= ì‹¤í–‰ ========= */
let koen={}, lh={};
listenClub(dbKoen, "koen", data => { koen = data; if(lh.name) render(koen, lh); });
listenClub(dbLh, "lh",   data => { lh   = data; if(koen.name) render(koen, lh); });

renderMonthlyReport(dbKoen, "koen", "koenReport");
renderMonthlyReport(dbLh, "lh",   "lhReport");

/* ========= ë¶€ìˆ˜ë³„ ì¸ì› ë¶„í¬ ========= */
function renderLevelDistribution(koenPlayers, lhPlayers){
  const getLevelCount = (players)=>{
    const counts = Array(10).fill(0); // 1~9ë¶€
    players.forEach(p=>{
      const lv = parseInt(p.level);
      if(lv>=1 && lv<=9) counts[lv]++;
    });
    return counts.slice(1);
  };

  const ctx = document.getElementById('levelChart').getContext('2d');
  const labels = ['1ë¶€','2ë¶€','3ë¶€','4ë¶€','5ë¶€','6ë¶€','7ë¶€','8ë¶€','9ë¶€'];
  const koenCounts = getLevelCount(koenPlayers);
  const lhCounts = getLevelCount(lhPlayers);

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [
        {
          label: 'KOEN',
          data: koenCounts,
          backgroundColor: 'rgba(37,99,235,0.6)'
        },
        {
          label: 'LH',
          data: lhCounts,
          backgroundColor: 'rgba(249,115,22,0.6)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      },
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });
}

</script>
</body>
</html>
