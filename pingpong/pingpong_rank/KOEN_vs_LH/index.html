<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>🏓 KOEN vs LH 탁구리그 비교</title>

<!-- Pretendard 폰트 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --koen:#2563eb;
  --lh:#f97316;
  --bg:#f5f7fb;
  --card:#fff;
  --ink:#0f172a;
  --muted:#64748b;
  --shadow:0 8px 28px rgba(0,0,0,0.08);
}
* {box-sizing:border-box; font-family:"Pretendard","Noto Sans KR",sans-serif;}
body {
  margin:0;
  background:var(--bg);
  color:var(--ink);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
header {
  text-align:center;
  margin-bottom:20px;
}
header h1 {
  font-size:clamp(20px,5vw,28px);
  color:var(--ink);
  margin-bottom:6px;
}
header p {
  color:var(--muted);
  font-size:clamp(13px,3vw,15px);
}
section {
  width:100%;
  max-width:600px;
  background:var(--card);
  box-shadow:var(--shadow);
  border-radius:16px;
  padding:20px;
  margin-bottom:18px;
}
.section-title {
  text-align:center;
  font-size:clamp(16px,4vw,20px);
  margin-bottom:12px;
  color:var(--ink);
}
.stats {
  display:flex;
  justify-content:space-around;
  text-align:center;
  gap:10px;
}
.card {
  flex:1;
  background:var(--bg);
  border-radius:12px;
  padding:12px;
}
.card h3 {
  margin:0;
  font-size:clamp(16px,4vw,18px);
}
.card p {
  margin:4px 0;
  color:var(--muted);
  font-size:clamp(13px,3vw,15px);
}
.chart-container {
  width:100%;
  height:250px;
}
footer {
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-top:12px;
}
@media (max-width:480px){
  .stats {flex-direction:column; align-items:center;}
  .card {width:90%;}
}
</style>
</head>
<body>

<header>
  <h1>🏓 KOEN vs LH 월간 탁구리그 비교</h1>
  <p>2025년 10월 활동 현황</p>
</header>

<section>
  <div class="section-title">📊 종합 요약</div>
  <div class="stats">
    <div class="card" style="border:2px solid var(--koen)">
      <h3>KOEN</h3>
      <p>총 경기: <b id="koenGames">-</b></p>
      <p>평균 승률: <b id="koenRate">-</b>%</p>
      <p>활동지수: <b id="koenScore">-</b></p>
    </div>
    <div class="card" style="border:2px solid var(--lh)">
      <h3>LH</h3>
      <p>총 경기: <b id="lhGames">-</b></p>
      <p>평균 승률: <b id="lhRate">-</b>%</p>
      <p>활동지수: <b id="lhScore">-</b></p>
    </div>
  </div>
</section>

<section>
  <div class="section-title">📈 활동 비교 그래프</div>
  <div class="chart-container"><canvas id="activityChart"></canvas></div>
</section>

<section>
  <div class="section-title">🏆 평균 승률 비교</div>
  <div class="chart-container"><canvas id="winrateChart"></canvas></div>
</section>

<footer>© 2025 남동본사 & LH 탁구동호회</footer>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// KOEN 설정
const koenConfig = {
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
// LH 설정
const lhConfig = {
  apiKey: "AIzaSyCM6FQqWaeI4Rx3ovD6OnhA_o-sgFvyWyI",
  authDomain: "pingpongclub2-6ce04.firebaseapp.com",
  databaseURL:"https://pingpongclub2-6ce04-default-rtdb.firebaseio.com",
  projectId: "pingpongclub2-6ce04",
  storageBucket: "pingpongclub2-6ce04.firebasestorage.app",
  messagingSenderId: "27948766659",
  appId: "1:27948766659:web:b7f79c1937c2123ed29976"
};

// 앱 초기화
const appKoen = initializeApp(koenConfig, "koenApp");
const appLh = initializeApp(lhConfig, "lhApp");
const dbKoen = getDatabase(appKoen);
const dbLh = getDatabase(appLh);

async function fetchClubData(db) {
  const snapshot = await get(child(ref(db), "players"));
  if (!snapshot.exists()) return [];
  return Object.values(snapshot.val());
}

function calculateStats(players){
  const totalGames = players.reduce((a,p)=>a+(p.games||0),0);
  const avgWin = players.length>0 ? (players.reduce((a,p)=>a+(p.winRate||0),0)/players.length).toFixed(1):0;
  const score = Math.round(totalGames * (avgWin/100));
  return { totalGames, avgWin, score };
}

Promise.all([fetchClubData(dbKoen), fetchClubData(dbLh)]).then(([koenPlayers, lhPlayers])=>{
  const koen = calculateStats(koenPlayers);
  const lh = calculateStats(lhPlayers);

  document.getElementById("koenGames").textContent = koen.totalGames;
  document.getElementById("koenRate").textContent = koen.avgWin;
  document.getElementById("koenScore").textContent = koen.score;

  document.getElementById("lhGames").textContent = lh.totalGames;
  document.getElementById("lhRate").textContent = lh.avgWin;
  document.getElementById("lhScore").textContent = lh.score;

  // 차트 1: 활동량 비교
  new Chart(document.getElementById("activityChart"), {
    type: 'bar',
    data: {
      labels: ["KOEN", "LH"],
      datasets: [{
        label: "총 경기 수",
        data: [koen.totalGames, lh.totalGames],
        backgroundColor: [ "rgba(37,99,235,0.8)", "rgba(249,115,22,0.8)" ],
        borderRadius: 8
      }]
    },
    options: { plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });

  // 차트 2: 평균 승률 비교
  new Chart(document.getElementById("winrateChart"), {
    type: 'doughnut',
    data: {
      labels: ["KOEN", "LH"],
      datasets: [{
        data: [koen.avgWin, lh.avgWin],
        backgroundColor: ["#2563eb","#f97316"]
      }]
    },
    options: {
      cutout:"70%",
      plugins:{
        legend:{position:'bottom'},
        tooltip:{callbacks:{label:(ctx)=>ctx.label+": "+ctx.parsed+"%"}}
      }
    }
  });
});
</script>

</body>
</html>
