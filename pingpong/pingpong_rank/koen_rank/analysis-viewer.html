<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ“ ì„ ìˆ˜ë³„ ë¶„ì„ ë·°ì–´</title>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

<style>
body {
  margin:0; background:#f5f7fb; font-family:"Pretendard",sans-serif;
}

.wrap {
  display:flex;
  height:100vh;
}

.left {
  width:280px;
  background:#ffffff;
  border-right:1px solid #e5e7eb;
  overflow-y:auto;
  padding:16px;
}

.left h2 {
  margin:0 0 12px; font-size:18px; font-weight:900; color:#1e3a8a;
}

.player-item {
  padding:10px 12px;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
  margin-bottom:6px;
  border:1px solid #e5e7eb;
  background:#fff;
}

.player-item:hover {
  background:#eef2ff;
}

.player-item.active {
  background:#2563eb;
  color:white;
  border-color:#1e40af;
}

.right {
  flex:1;
  padding:24px;
  overflow-y:auto;
}

#title {
  font-size:24px;
  font-weight:900;
  color:#1e3a8a;
  margin-bottom:16px;
}

#content {
  white-space:pre-wrap;
  font-size:16px;
  line-height:1.7;
  color:#0f172a;
}
</style>
</head>

<body>

<div class="wrap">

  <!-- ì¢Œì¸¡: ì„ ìˆ˜ ëª©ë¡ -->
  <div class="left">
    <h2>ì„ ìˆ˜ ëª©ë¡</h2>
    <div id="playerList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </div>

  <!-- ìš°ì¸¡: ë¶„ì„ ë‚´ìš© -->
  <div class="right">
    <div id="title">ì„ ìˆ˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    <div id="content"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
initializeApp(firebaseConfig);
const db = getDatabase();

/* âœ… ì„ ìˆ˜ ëª©ë¡ ë¡œë“œ */
async function loadPlayerList(){
  const snap = await get(ref(db, "players"));
  if (!snap.exists()) {
    document.getElementById("playerList").textContent = "ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  const box = document.getElementById("playerList");
  box.innerHTML = "";

  const arr = Object.values(snap.val()).sort((a,b)=> a.name.localeCompare(b.name));

  arr.forEach(p=>{
    const div = document.createElement("div");
    div.className = "player-item";
    div.textContent = `${p.name} (${p.level ?? "-"})`;

    div.addEventListener("click", ()=> loadAnalysis(p.name, div));
    box.appendChild(div);
  });
}

/* âœ… ì„ ìˆ˜ë³„ ë¶„ì„ ë¡œë“œ */
async function loadAnalysis(name, el){
  document.querySelectorAll(".player-item").forEach(x=>x.classList.remove("active"));
  el.classList.add("active");

  document.getElementById("title").textContent = `${name} ë¶„ì„`;

  const snap = await get(ref(db, "analysis/" + name));

  if (!snap.exists()){
    document.getElementById("content").textContent = "ì €ì¥ëœ ë¶„ì„ì´ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  const data = snap.val();
  document.getElementById("content").textContent = data.analysis ?? "ë‚´ìš© ì—†ìŒ";
}

/* âœ… ìµœì´ˆ ì‹¤í–‰ */
loadPlayerList();

</script>

</body>
</html>
