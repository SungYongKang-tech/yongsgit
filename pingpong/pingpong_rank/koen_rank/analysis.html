<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” íƒêµ¬ ìŠ¤íƒ€ì¼ ë¶„ì„</title>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<style>
:root{
  --ink:#0f172a; --muted:#64748b; --bg:#f5f7fb; --card:#fff;
  --accent:#2563eb; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
  --shadow:0 8px 28px rgba(2,6,23,.08);
}
*{box-sizing:border-box}
body{margin:0;font-family:"Pretendard","Noto Sans KR",system-ui,sans-serif;background:var(--bg);color:var(--ink);font-weight:600}
.wrap{max-width:900px;margin:0 auto;padding:16px}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e5e7eb;z-index:5}
.head-in{max-width:900px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between}
h1{margin:0;font-size:clamp(18px,4vw,22px);color:#1e40af}
.btn{border:1px solid #d1d5db;padding:8px 12px;border-radius:10px;background:#fff;cursor:pointer;font-weight:800}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-top:12px}
.sec-title{font-size:16px;font-weight:900;color:#0f172a;margin:0 0 8px}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#e2efff;color:#1e40af;font-size:12px;font-weight:900}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.kv{display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.k{font-size:13px;color:#334155}
.v{font-size:16px;font-weight:900}
.note{font-size:12.5px;color:#64748b}
ul.clean{list-style:none;padding:0;margin:0;display:grid;gap:6px}
li.i{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;background:linear-gradient(180deg,#fff,#fbfdff 85%)}
.hl{color:#1e3a8a}
.good{color:var(--ok);font-weight:900}
.warn{color:var(--warn);font-weight:900}
.bad{color:var(--bad);font-weight:900}
a.link{color:#1e40af;text-decoration:none;font-weight:900}
.divider{height:1px;background:#eef2f7;margin:12px 0}
.small{font-size:13px;color:#475569}
input,textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font:inherit}
label{font-size:12px;color:#475569;font-weight:800}
.grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
.col-12{grid-column:span 12}
.col-6{grid-column:span 6}
@media(max-width:720px){.col-6{grid-column:span 12}}
#summary {
  font-size: 15.5px;   /* ê¸°ì¡´ë³´ë‹¤ ì•½ 15% ì»¤ì§ */
  line-height: 1.55; 
}

</style>
</head>
<body>
<header>
  <div class="head-in">
    <h1>ğŸ” íƒêµ¬ ìŠ¤íƒ€ì¼ ë¶„ì„</h1>
    <div class="row">
      <button class="btn" id="btnBack">â† ê°œì¸ ì„±ì </button>
      <button class="btn" id="btnAdminToggle">ê´€ë¦¬ìëª¨ë“œ</button>
      <span class="badge" id="who"></span>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- ìš”ì•½ -->
  <section class="card">
    <div class="sec-title">ğŸ“Œ í•µì‹¬ ìš”ì•½</div>
    <div id="summary" class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </section>

  <!-- í†µí•©ë¦¬ê·¸ (9~10ì›”) -->
  <section class="card">
    <div class="sec-title">ğŸ“… í†µí•©ë¦¬ê·¸ ìš”ì•½ <span class="badge">'25-09 ~ '25-10</span></div>
    <div id="integratedBox" class="kv"></div>
    <div class="divider"></div>
    <ul id="integratedBullets" class="clean"></ul>
    <div class="note">* í†µí•©ë¦¬ê·¸ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
  </section>

  <!-- ë‹¨ì‹/ë³µì‹ (11ì›”~) -->
  <section class="card">
    <div class="sec-title">ğŸ¯ ì„¸ë¶€ ì„±í–¥ (11ì›”~)</div>
    <div class="grid">
      <div class="col-6">
        <div class="badge">ë‹¨ì‹</div>
        <ul id="singleBullets" class="clean"></ul>
      </div>
      <div class="col-6">
        <div class="badge">ë³µì‹</div>
        <ul id="doubleBullets" class="clean"></ul>
      </div>
    </div>
    <div class="divider"></div>
    <ul id="recommend" class="clean"></ul>
  </section>

  <!-- ê´€ë¦¬ì ë©”ëª¨ (í™•ì¥í˜•) -->
  <section class="card" id="adminCard" style="display:none">
    <div class="sec-title">ğŸ›  ê´€ë¦¬ì ë©”ëª¨ (í™•ì¥í˜•)</div>
    <p class="small">ì €ì¥ ê²½ë¡œ: <code>playerDetail/{ì´ë¦„}/</code></p>
    <div class="grid">
      <div class="col-6">
        <label>ìŠ¤íƒ€ì¼ (ì˜ˆ: ê³µê²©í˜•, ìˆ˜ë¹„í˜•, ì¹´ìš´í„°)</label>
        <input id="ad_style" placeholder="ê³µê²©í˜•">
      </div>
      <div class="col-6">
        <label>ì„ í˜¸ íŒŒíŠ¸ë„ˆ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
        <input id="ad_favs" placeholder="í™ê¸¸ë™, ê¹€ì˜í¬">
      </div>
      <div class="col-6">
        <label>ê°•ì  (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
        <input id="ad_strengths" placeholder="ì´ˆêµ¬ ë“œë¼ì´ë¸Œ, ë°œë¹ ë¥¸ í’‹ì›Œí¬">
      </div>
      <div class="col-6">
        <label>ì•½ì  (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
        <input id="ad_weaknesses" placeholder="ë°±ìª½ ì»¤íŠ¸ ì²˜ë¦¬, ê¸´ ë ë¦¬">
      </div>
      <div class="col-12">
        <label>ì–´ë ¤ìš´ ìƒëŒ€ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
        <input id="ad_hards" placeholder="ì´ìƒì¤€, ë°•ë‚˜ë ¹">
      </div>
      <div class="col-12">
        <label>ë©”ëª¨</label>
        <textarea id="ad_memo" rows="3" placeholder="ì „ì§„ ê³µê²© ìœ„ì£¼. ì»¤íŠ¸ ë³¼ ëŒ€ë¹„ í•„ìš”."></textarea>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn primary" id="btnSaveAdmin">ì €ì¥</button>
      <span class="note">â€» Firebase ë³´ì•ˆê·œì¹™ì—ì„œ ê´€ë¦¬ìë§Œ ì“°ê¸° ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•˜ì„¸ìš”.</span>
    </div>
  </section>
</main>

<script type="module">
/* ===== ê¸°ë³¸ ìœ í‹¸ ===== */
const $ = s => document.querySelector(s);
const shortMonth = m => `'${m.slice(2)}`;
const fmt1 = n => (Math.round(n*10)/10).toFixed(1);
const yyyymm = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
const KST = ts => new Date(new Date(ts).toLocaleString("en-US",{timeZone:"Asia/Seoul"}));
const cmpMonth = (a,b)=> a.localeCompare(b);
const POINT_WIN = 2, POINT_LOSE = -1;

/* ===== URL íŒŒë¼ë¯¸í„° ===== */
const params = new URLSearchParams(location.search);
const playerName = params.get('name') || '';

/* ===== Firebase ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain: "pingpongclub-4a5fd.firebaseapp.com",
  databaseURL: "https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId: "pingpongclub-4a5fd",
  storageBucket: "pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId: "802826774007",
  appId: "1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

/* ===== ìƒíƒœ ë³´ê´€ ===== */
let playerLevels = {};     // {name: level}
let months = [];
let perMonthAll = {};
let perMonthSingle = {};
let perMonthDouble = {};
let oppMapSingle = {};
let partnerMapDouble = {};
let sumPointsFromNov = 0;
let sumSglTotal = 0, sumSglWin = 0, sumSglLose = 0;
let sumDblTotal = 0, sumDblWin = 0, sumDblLose = 0;
let sumAllTotal = 0, sumAllWin = 0, sumAllLose = 0;

/* ===== ì´ˆê¸° UI ===== */
$('#who').textContent = playerName || 'ì„ ìˆ˜ ë¯¸ì§€ì •';
$('#btnBack').addEventListener('click', ()=> {
  // player.htmlë¡œ ëŒì•„ê°€ê¸°
  location.href = `player.html?name=${encodeURIComponent(playerName)}`;
});
$('#btnAdminToggle').addEventListener('click', ()=>{
  const vis = $('#adminCard').style.display !== 'none';
  $('#adminCard').style.display = vis ? 'none' : 'block';
});

/* ===== ë°ì´í„° ë¡œë“œ ===== */
// 0) ì„ ìˆ˜ ë ˆë²¨
const playerSnap = await get(ref(db,'players'));
if (playerSnap.exists()){
  const pdata = playerSnap.val() || {};
  Object.values(pdata).forEach(p=>{
    if (p.name) playerLevels[p.name] = p.level ?? '-';
  });
}

// 1) í†µí•©ë¦¬ê·¸(9~10ì›”)
async function loadPastMonths(){
  const targets = ['2025-09','2025-10'];
  for (const m of targets){
    const snap = await get(ref(db, `monthlyReports/${m}/players`));
    if (!snap.exists()) continue;
    const arr = Object.values(snap.val());
    const row = arr.find(r => (r.name === playerName));
    if (!row) continue;

    const win = Number(row.wins ?? row.win ?? 0);
    const lose = Number(row.losses ?? row.lose ?? 0);
    const total = win + lose;
    const rate = total ? (win/total*100) : 0;

    perMonthAll[m] = { total, win, lose, rate };
    months.push(m);

    sumAllTotal += total; sumAllWin += win; sumAllLose += lose;
  }
}

// 2) 11ì›”~ matches (ë‹¨/ë³µì‹)
async function loadMatchesFromNov(){
  const snap = await get(ref(db,'matches'));
  if (!snap.exists()) return;
  const data = Object.values(snap.val());
  const NOV_2025 = '2025-11';

  const myMatches = data.filter(m=>{
    const mk = m.monthKey || yyyymm(KST(m.createdAt ?? Date.now()));
    if (cmpMonth(mk, NOV_2025) < 0) return false;
    const names = [...(m.namesA||[]), ...(m.namesB||[])];
    return names.includes(playerName);
  });

  myMatches.forEach(m=>{
    const mk = m.monthKey || yyyymm(KST(m.createdAt ?? Date.now()));
    if (!months.includes(mk)) months.push(mk);
  });

  months.forEach(m=>{
    if (!perMonthAll[m])    perMonthAll[m]    = { total:0, win:0, lose:0, rate:0 };
    if (!perMonthSingle[m]) perMonthSingle[m] = { total:0, win:0, lose:0, rate:0 };
    if (!perMonthDouble[m]) perMonthDouble[m] = { total:0, win:0, lose:0, rate:0, points:0 };
  });

  myMatches.forEach(m=>{
    const mk = m.monthKey || yyyymm(KST(m.createdAt ?? Date.now()));
    const A = m.namesA || [];
    const B = m.namesB || [];
    const mode = m.mode || 'single';
    const winA = (m.winnerSide === 'A');
    const iAmA = A.includes(playerName);
    const iAmB = B.includes(playerName);
    const iWon = (winA && iAmA) || (!winA && iAmB);

    // í†µí•©
    perMonthAll[mk].total++; if (iWon) perMonthAll[mk].win++; else perMonthAll[mk].lose++;

    if (mode === 'single'){
      perMonthSingle[mk].total++; if (iWon) perMonthSingle[mk].win++; else perMonthSingle[mk].lose++;
      const opp = iAmA ? B[0] : A[0];
      if (opp){
        if (!oppMapSingle[opp]) oppMapSingle[opp] = { win:0, lose:0 };
        if (iWon) oppMapSingle[opp].win++; else oppMapSingle[opp].lose++;
      }
    } else {
      perMonthDouble[mk].total++; if (iWon) perMonthDouble[mk].win++; else perMonthDouble[mk].lose++;
      perMonthDouble[mk].points += iWon ? POINT_WIN : POINT_LOSE;
      sumPointsFromNov += iWon ? POINT_WIN : POINT_LOSE;

      let partner = null;
      if (iAmA) partner = A.find(n=>n!==playerName);
      else if (iAmB) partner = B.find(n=>n!==playerName);
      if (partner){
        if (!partnerMapDouble[partner]) partnerMapDouble[partner] = { win:0, lose:0, points:0 };
        if (iWon){ partnerMapDouble[partner].win++; partnerMapDouble[partner].points += POINT_WIN; }
        else     { partnerMapDouble[partner].lose++; partnerMapDouble[partner].points += POINT_LOSE; }
      }
    }
  });

  months.forEach(m=>{
    const a = perMonthAll[m];    a.rate = a.total? (a.win/a.total*100):0;
    if (perMonthSingle[m]){ const s = perMonthSingle[m]; s.rate = s.total? (s.win/s.total*100):0; }
    if (perMonthDouble[m]){ const d = perMonthDouble[m]; d.rate = d.total? (d.win/d.total*100):0; }
  });

  months.forEach(m=>{
    const s = perMonthSingle[m] || { total:0, win:0, lose:0 };
    const d = perMonthDouble[m] || { total:0, win:0, lose:0 };
    sumSglTotal += s.total; sumSglWin += s.win; sumSglLose += s.lose;
    sumDblTotal += d.total; sumDblWin += d.win; sumDblLose += d.lose;
  });
}

/* ===== ê´€ë¦¬ì ë©”ëª¨ ë¡œë“œ/ì„¸ì´ë¸Œ ===== */
function csvToArray(s){ return (s||'').split(',').map(v=>v.trim()).filter(Boolean); }
function arrayToCSV(a){ return (a||[]).join(', '); }

async function loadAdminMemo(){
  const snap = await get(ref(db, `playerDetail/${playerName}`));
  if (!snap.exists()) return;
  const d = snap.val() || {};
  $('#ad_style').value = d.style ?? '';
  $('#ad_strengths').value = arrayToCSV(d.strengths);
  $('#ad_weaknesses').value = arrayToCSV(d.weaknesses);
  $('#ad_favs').value = arrayToCSV(d.favoritePartners);
  $('#ad_hards').value = arrayToCSV(d.hardOpponents);
  $('#ad_memo').value = d.memo ?? '';
}

$('#btnSaveAdmin').addEventListener('click', async ()=>{
  const payload = {
    style: $('#ad_style').value.trim() || null,
    strengths: csvToArray($('#ad_strengths').value),
    weaknesses: csvToArray($('#ad_weaknesses').value),
    favoritePartners: csvToArray($('#ad_favs').value),
    hardOpponents: csvToArray($('#ad_hards').value),
    memo: $('#ad_memo').value.trim() || null,
    updatedAt: Date.now()
  };
  await set(ref(db, `playerDetail/${playerName}`), payload);
  alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  renderSummaryAndBullets(); // ë©”ëª¨ ë°˜ì˜
});

/* ===== ë Œë”ë§ ===== */
function bestOf(map, metric='total', take=1){
  const arr = Object.entries(map).map(([name,v])=>({
    name, win:v.win, lose:v.lose, total:(v.win+v.lose),
    rate: (v.win+v.lose)? (v.win/(v.win+v.lose)*100):0,
    points: v.points ?? 0
  })).sort((a,b)=> (b[metric]??0) - (a[metric]??0));
  return arr.slice(0,take);
}

function renderIntegrated(){
  const box = $('#integratedBox'); box.innerHTML = '';
  const monthsSorted = Object.keys(perMonthAll).filter(m => (m==='2025-09'||m==='2025-10')).sort();
  let tWin=0,tLose=0,tTot=0;

  monthsSorted.forEach(m=>{
    const a = perMonthAll[m];
    tWin += a.win; tLose += a.lose; tTot += a.total;
    box.insertAdjacentHTML('beforeend', `
      <div class="card" style="padding:12px">
        <div class="row"><span class="badge">${shortMonth(m)}</span></div>
        <div class="row" style="margin-top:6px">
          <div class="k">ì „ì </div><div class="v">${a.win}ìŠ¹ ${a.lose}íŒ¨</div>
          <div class="k">ìŠ¹ë¥ </div><div class="v">${fmt1(a.rate)}%</div>
          <div class="k">ê²½ê¸°ìˆ˜</div><div class="v">${a.total}</div>
        </div>
      </div>
    `);
  });

  const bullets = $('#integratedBullets'); bullets.innerHTML='';
  if (tTot===0){
    bullets.insertAdjacentHTML('beforeend', `<li class="i">í†µí•©ë¦¬ê·¸ ê¸°ë¡ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</li>`);
  }else{
    const rate = tTot? fmt1(tWin/tTot*100) : '0.0';
    bullets.insertAdjacentHTML('beforeend', `
      <li class="i">í†µí•© ê¸°ì¤€ ì´ <b>${tTot}</b>ê²½ê¸°, <b>${tWin}ìŠ¹ ${tLose}íŒ¨</b> (<b>${rate}%</b>)</li>
      <li class="i">í†µí•©ë¦¬ê·¸ëŠ” <span class="hl">ì°¸ê³ ìš©</span>ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤. ì„¸ë¶€ ì„±í–¥ì€ 11ì›” ì´í›„ ìë£Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.</li>
    `);
  }
}

async function renderSummaryAndBullets(){
  // ê´€ë¦¬ì ë©”ëª¨ ë¶ˆëŸ¬ì˜¤ê¸°
  const memoSnap = await get(ref(db, `playerDetail/${playerName}`));
  const memo = memoSnap.exists() ? (memoSnap.val()||{}) : {};

  // í†µí•© ì „ì²´
  let tAll = 0, wAll = 0, lAll = 0;
  Object.values(perMonthAll).forEach(a=>{ tAll+=a.total; wAll+=a.win; lAll+=a.lose; });
  const allRate = tAll? fmt1(wAll/tAll*100):'0.0';

  // ë‹¨ì‹/ë³µì‹(11ì›”~)
  const sTot=sumSglTotal, sW=sumSglWin, sL=sumSglLose, sRate = sTot? fmt1(sW/sTot*100):'0.0';
  const dTot=sumDblTotal, dW=sumDblWin, dL=sumDblLose, dRate = dTot? fmt1(dW/dTot*100):'0.0';

  // ëŒ€í‘œ ìƒëŒ€/íŒŒíŠ¸ë„ˆ
  const topOpp = bestOf(oppMapSingle, 'total', 1)[0];
  const topPtn = bestOf(partnerMapDouble, 'total', 1)[0];

  // ìš”ì•½ ë¬¸ë‹¨(ì§§ê³  ì„ ëª…í•˜ê²Œ)
  const lines = [];
  lines.push(`ì„ ìˆ˜ <b class="hl">${playerName}</b>ì˜ ìµœê·¼ íë¦„ì„ ë³´ë©´, í†µí•© ê¸°ì¤€ <b>${tAll}</b>ê²½ê¸°ì—ì„œ <b>${wAll}ìŠ¹ ${lAll}íŒ¨</b>(<b>${allRate}%</b>)ì…ë‹ˆë‹¤.`);
  if (sTot || dTot){
    if (sTot) lines.push(`ë‹¨ì‹ì€ <b>${sW}ìŠ¹ ${sL}íŒ¨</b>(<b>${sRate}%</b>)ë¡œ ${Number(sRate) >= Number(dRate) ? 'ì•ˆì •ì ' : 'ë³´ì™„ì´ í•„ìš”í•´ ë³´'}ì…ë‹ˆë‹¤.`);
    if (dTot) lines.push(`ë³µì‹ì€ <b>${dW}ìŠ¹ ${dL}íŒ¨</b>(<b>${dRate}%</b>)ë¡œ ${Number(dRate) > Number(sRate) ? 'ê°•ì ì´' : 'ê°•í™”ê°€ í•„ìš”í•´'} ë³´ì…ë‹ˆë‹¤.`);
  } else {
    lines.push(`<span class="warn">ë‹¨ì‹/ë³µì‹ ì „ì  ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</span>`);

  }
  if (topOpp) lines.push(`ë‹¨ì‹ì—ì„œ ìì£¼ ë§ëŒ€í•œ ìƒëŒ€ëŠ” <a class="link" href="player.html?name=${encodeURIComponent(topOpp.name)}">${topOpp.name}</a> ì…ë‹ˆë‹¤.`);
  if (topPtn) lines.push(`ë³µì‹ í˜¸í¡ì´ ë§ì€ íŒŒíŠ¸ë„ˆëŠ” <a class="link" href="player.html?name=${encodeURIComponent(topPtn.name)}">${topPtn.name}</a> ì…ë‹ˆë‹¤.`);
  if (memo.style) lines.push(`ê´€ë¦¬ì ë©”ëª¨: <b>${memo.style}</b> ì„±í–¥.`);
  if (memo.memo) lines.push(`ë©”ëª¨: ${memo.memo}`);

  $('#summary').innerHTML = lines.map(s=>`<div>â€¢ ${s}</div>`).join('');

  // ë‹¨ì‹ bullets
  const singleBox = $('#singleBullets'); singleBox.innerHTML='';
  if (!sTot){
    singleBox.insertAdjacentHTML('beforeend', `<li class="i">ë‹¨ì‹ ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. (ë‚´ì¼ë¶€í„° ìë™ ë°˜ì˜)</li>`);
  }else{
    // ìŠ¹ë¥ /ëŒ€ì§„
    singleBox.insertAdjacentHTML('beforeend', `<li class="i">ì „ì : <b>${sW}ìŠ¹ ${sL}íŒ¨</b> (<b>${sRate}%</b>)</li>`);
    if (topOpp) singleBox.insertAdjacentHTML('beforeend',
      `<li class="i">ìì£¼ ë§ëŒ€í•œ ìƒëŒ€: <a class="link" href="player.html?name=${encodeURIComponent(topOpp.name)}">${topOpp.name}</a> â€” ${topOpp.win}ìŠ¹ ${topOpp.lose}íŒ¨</li>`
    );
    // ê°•ì /ì•½ì (ê´€ë¦¬ì)
    if (memo.strengths?.length) singleBox.insertAdjacentHTML('beforeend', `<li class="i">ê°•ì : ${memo.strengths.join(', ')}</li>`);
    if (memo.weaknesses?.length) singleBox.insertAdjacentHTML('beforeend', `<li class="i">ì•½ì : ${memo.weaknesses.join(', ')}</li>`);
    if (memo.hardOpponents?.length) singleBox.insertAdjacentHTML('beforeend', `<li class="i">ì–´ë ¤ìš´ ìƒëŒ€: ${memo.hardOpponents.map(n=>`<a class="link" href="player.html?name=${encodeURIComponent(n)}">${n}</a>`).join(', ')}</li>`);
  }

  // ë³µì‹ bullets
  const doubleBox = $('#doubleBullets'); doubleBox.innerHTML='';
  if (!dTot){
    doubleBox.insertAdjacentHTML('beforeend', `<li class="i">ë³µì‹ ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. (ë‚´ì¼ë¶€í„° ìë™ ë°˜ì˜)</li>`);
  }else{
    doubleBox.insertAdjacentHTML('beforeend', `<li class="i">ì „ì : <b>${dW}ìŠ¹ ${dL}íŒ¨</b> (<b>${dRate}%</b>) Â· ëˆ„ì  ìŠ¹ì  <b>${sumPointsFromNov>0? '+'+sumPointsFromNov: sumPointsFromNov}</b></li>`);
    if (topPtn) doubleBox.insertAdjacentHTML('beforeend',
      `<li class="i">í˜¸í¡ ë§ì€ íŒŒíŠ¸ë„ˆ: <a class="link" href="player.html?name=${encodeURIComponent(topPtn.name)}">${topPtn.name}</a> â€” ${topPtn.win}ìŠ¹ ${topPtn.lose}íŒ¨</li>`
    );
    if (memo.favoritePartners?.length) doubleBox.insertAdjacentHTML('beforeend', `<li class="i">ì„ í˜¸ íŒŒíŠ¸ë„ˆ: ${memo.favoritePartners.map(n=>`<a class="link" href="player.html?name=${encodeURIComponent(n)}">${n}</a>`).join(', ')}</li>`);
  }

  // ì—°ìŠµ ì¶”ì²œ(ê°„ê²°)
  const rec = $('#recommend'); rec.innerHTML='';
  if (!sTot && !dTot){
    rec.insertAdjacentHTML('beforeend', `<li class="i">ì˜¤ëŠ˜ì€ <b>í†µí•©ë¦¬ê·¸ íë¦„ ìœ ì§€</b>ì— ì§‘ì¤‘í•˜ì„¸ìš”. ë‹¨/ë³µì‹ ë°ì´í„°ê°€ ìŒ“ì´ë©´ ë§ì¶¤ ì¶”ì²œì´ í™œì„±í™”ë©ë‹ˆë‹¤.</li>`);
  }else{
    if (Number(dRate) > Number(sRate)){
      rec.insertAdjacentHTML('beforeend', `<li class="i">ë³µì‹ ê°•ì  ìœ ì§€ + <span class="bad">ë‹¨ì‹ ì•ˆì •ì„±</span> ë³´ì™„(ë¦¬ì‹œë¸Œ/ì„œë¸Œ 1êµ¬ ì„¤ê³„)ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</li>`);
    }else{
      rec.insertAdjacentHTML('beforeend', `<li class="i">ë‹¨ì‹ì€ ì•ˆì •ì ì…ë‹ˆë‹¤. <span class="hl">ë³µì‹ íŒŒíŠ¸ë„ˆì‹­</span> ì¡°ì§ í›ˆë ¨(ì„œë¸Œ ì½œÂ·í¬ì§€ì…˜ êµëŒ€)ì„ ëŠ˜ë ¤ë³´ì„¸ìš”.</li>`);
    }
  }
}

/* ===== ë¶€íŠ¸ìŠ¤íŠ¸ë© ===== */
await loadPastMonths();
await loadMatchesFromNov();
months = [...new Set(months)].sort();

renderIntegrated();
await renderSummaryAndBullets();

// ê´€ë¦¬ì ì¹´ë“œ ìë™ í‘œì‹œ (URLì— admin=1 ì´ë©´)
if (params.get('admin') === '1'){
  $('#adminCard').style.display = 'block';
}
await loadAdminMemo();
</script>
</body>
</html>
