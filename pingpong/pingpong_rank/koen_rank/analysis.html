<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” íƒêµ¬ ìŠ¤íƒ€ì¼ ë¶„ì„</title>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

<style>
:root{
  --ink:#0f172a; --muted:#64748b; --bg:#f5f7fb; --card:#fff;
  --accent:#2563eb; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
  --shadow:0 8px 28px rgba(2,6,23,.08);
}
body{margin:0;font-family:"Pretendard","Noto Sans KR";background:var(--bg);color:var(--ink);font-weight:600}
.wrap{max-width:900px;margin:0 auto;padding:16px}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e5e7eb;z-index:9999}
.head-in{max-width:900px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between}
h1{margin:0;font-size:20px;color:#1e40af;font-weight:900}
.btn{border:1px solid #d1d5db;padding:8px 12px;border-radius:10px;background:#fff;cursor:pointer;font-weight:800}
.btn.primary{background:var(--accent);color:#fff}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-top:12px}
.sec-title{font-size:16px;font-weight:900;color:#0f172a;margin-bottom:8px}
.badge{padding:4px 8px;border-radius:999px;background:#e2efff;color:#1e40af;font-size:12px;font-weight:900}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
input,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px}
label{font-size:12px;color:#475569;font-weight:800}
.grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
.col-6{grid-column:span 6}
.col-12{grid-column:span 12}
@media(max-width:720px){.col-6{grid-column:span 12}}
.box{padding:12px;background:#f1f5f9;border-radius:12px}
</style>
</head>

<body>
<header>
  <div class="head-in">
    <h1>ğŸ” íƒêµ¬ ìŠ¤íƒ€ì¼ ë¶„ì„</h1>
    <div class="row">
      <button class="btn" id="btnBack">â† ê°œì¸ ì„±ì </button>
      <button class="btn" id="btnAdminToggle">ê´€ë¦¬ìëª¨ë“œ</button>
      <span class="badge" id="who"></span>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- âœ… AI ì½”ì¹˜ ë¶„ì„ ì¶œë ¥ ì˜ì—­ -->
  <section class="card">
    <div id="analysisContent">AI ë¶„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  </section>

  <!-- âœ… ê´€ë¦¬ì ì…ë ¥ ì˜ì—­ -->
  <section class="card" id="adminCard" style="display:none;">
    <div class="sec-title">ğŸ›  ê´€ë¦¬ì ê¸°ìˆ  ë©”ëª¨</div>

    <div class="grid">
      <div class="col-6">
        <label>íƒ€ë²• / ê·¸ë¦½</label>
        <input id="ad_grip" placeholder="ì˜ˆ: ì˜¤ë¥¸ì† ì‰ì´í¬">
      </div>

      <div class="col-6">
        <label>êµ¬ë ¥</label>
        <input id="ad_years" placeholder="ì˜ˆ: 3ë…„">
      </div>

      <div class="col-6">
        <label>ë ˆìŠ¨ ì—¬ë¶€</label>
        <input id="ad_lesson" placeholder="ì˜ˆ: ì£¼1íšŒ ë ˆìŠ¨ ì¤‘">
      </div>

      <div class="col-6">
        <label>í˜„ì¬ í¼(ì»¨ë””ì…˜)</label>
        <input id="ad_form" placeholder="ì˜ˆ: ë“œë¼ì´ë¸Œ íƒ€ì´ë° ì¢‹ì•„ì§">
      </div>

      <div class="col-6">
        <label>ê¸°ìˆ  ê°•ì </label>
        <input id="ad_strong" placeholder="ì˜ˆ: ì´ˆêµ¬ ë“œë¼ì´ë¸Œ, ì „ì§„ í”Œë¦­">
      </div>

      <div class="col-6">
        <label>ê¸°ìˆ  ì•½ì </label>
        <input id="ad_weak" placeholder="ì˜ˆ: ë°± ì „í™˜ ëŠë¦¼">
      </div>

      <div class="col-12">
        <label>ê¸°íƒ€ ë©”ëª¨</label>
        <textarea id="ad_memo" rows="3" placeholder="ì˜ˆ: ìµœê·¼ ë¼ì¼“ êµì²´ í›„ ì ì‘ ì¤‘â€¦"></textarea>
      </div>
    </div>

    <button class="btn primary" id="btnSaveAdmin" style="margin-top:12px;">ì €ì¥</button>
  </section>

</main>


<!-- âœ… Firebase + JS -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* âœ… Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain: "pingpongclub-4a5fd.firebaseapp.com",
  databaseURL: "https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId: "pingpongclub-4a5fd",
  storageBucket: "pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId: "802826774007",
  appId: "1:802826774007:web:ca4d05be778eeaf1723af2"
};

initializeApp(firebaseConfig);
const db = getDatabase();

/* âœ… URL íŒŒë¼ë¯¸í„° */
const params = new URLSearchParams(location.search);
const playerName = params.get("name") || "";
document.getElementById("who").textContent = playerName;

/* âœ… ê´€ë¦¬ìë©”ëª¨ ë¡œë“œ */
async function loadAdminMemo() {
  const snap = await get(ref(db, `playerDetail/${playerName}`));
  return snap.exists() ? snap.val() : {};
}

/* âœ… ê´€ë¦¬ìë©”ëª¨ ì €ì¥ */
document.getElementById("btnSaveAdmin").addEventListener("click", async () => {
  const data = {
    grip: document.getElementById("ad_grip").value.trim(),
    years: document.getElementById("ad_years").value.trim(),
    lesson: document.getElementById("ad_lesson").value.trim(),
    form: document.getElementById("ad_form").value.trim(),
    strong: document.getElementById("ad_strong").value.trim(),
    weak: document.getElementById("ad_weak").value.trim(),
    memo: document.getElementById("ad_memo").value.trim()
  };

  await set(ref(db, `playerDetail/${playerName}`), data);
  alert("âœ… ì €ì¥ ì™„ë£Œ");
});

/* âœ… ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ */
async function getAdminPassword() {
  const snap = await get(ref(db, "config/adminPassword"));
  return snap.exists() ? snap.val() : null;
}

/* âœ… ê´€ë¦¬ìëª¨ë“œ í† ê¸€ */
let adminOn = false;

document.getElementById("btnAdminToggle").addEventListener("click", async () => {
  if (!adminOn) {
    const savedPw = await getAdminPassword();
    const input = prompt("ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
    if (input !== savedPw) return alert("âŒ ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    adminOn = true;
  } else {
    adminOn = false;
  }
  applyAdmin();
});

function applyAdmin() {
  document.getElementById("adminCard").style.display = adminOn ? "block" : "none";
  document.getElementById("btnAdminToggle").classList.toggle("primary", adminOn);
  document.getElementById("btnAdminToggle").textContent =
    adminOn ? "ê´€ë¦¬ìëª¨ë“œ ON" : "ê´€ë¦¬ìëª¨ë“œ";
}

/* âœ… AI ì½”ì¹˜ ë¶„ì„ ë¬¸ì¥ ìƒì„±ê¸° */
function makeAIAnalysis(adminMemo) {
  let out = [];

  out.push(`<div class="sec-title">ğŸ¤– AI ì½”ì¹˜ ë¶„ì„</div>`);

  let text = "";

  text += `${playerName} ì„ ìˆ˜ëŠ” `;
  if (adminMemo.grip) text += `${adminMemo.grip} ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©í•˜ë©° `;
  if (adminMemo.years) text += `êµ¬ë ¥ì€ ì•½ ${adminMemo.years} ì •ë„ì…ë‹ˆë‹¤. `;

  if (adminMemo.lesson) text += `í˜„ì¬ ${adminMemo.lesson} ìƒíƒœì´ë©° `;
  if (adminMemo.form) text += `ìš”ì¦˜ ê²½ê¸°ì—ì„œëŠ” "${adminMemo.form}" ê²½í–¥ì´ ëšœë ·í•©ë‹ˆë‹¤. `;

  if (adminMemo.strong) text += `ê°•ì ì€ ${adminMemo.strong}ì´ë©° `;
  if (adminMemo.weak) text += `ë³´ì™„í•´ì•¼ í•  ë¶€ë¶„ì€ ${adminMemo.weak}ì…ë‹ˆë‹¤. `;

  if (adminMemo.memo) text += `ì¶”ê°€ ë©”ëª¨: ${adminMemo.memo}`;

  out.push(`<div class="box">${text}</div>`);

  return out.join("\n");
}

/* âœ… ì‹¤í–‰ */
(async () => {
  const adminMemo = await loadAdminMemo();

  /* ê´€ë¦¬ìë©”ëª¨ ì…ë ¥ì°½ ìë™ì±„ì›€ */
  if (adminMemo.grip) document.getElementById("ad_grip").value = adminMemo.grip;
  if (adminMemo.years) document.getElementById("ad_years").value = adminMemo.years;
  if (adminMemo.lesson) document.getElementById("ad_lesson").value = adminMemo.lesson;
  if (adminMemo.form) document.getElementById("ad_form").value = adminMemo.form;
  if (adminMemo.strong) document.getElementById("ad_strong").value = adminMemo.strong;
  if (adminMemo.weak) document.getElementById("ad_weak").value = adminMemo.weak;
  if (adminMemo.memo) document.getElementById("ad_memo").value = adminMemo.memo;

  /* âœ… AI ì½”ì¹˜ ë¶„ì„ ìƒì„± */
  const html = makeAIAnalysis(adminMemo);
  document.getElementById("analysisContent").innerHTML = html;
})();
</script>

</body>
</html>
