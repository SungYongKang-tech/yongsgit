<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Makeup Lesson Manager</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Pretendard",sans-serif;
  margin:0;background:#f5f5f7;
}
header{
  background:#fff;padding:16px;font-size:1.3rem;font-weight:700;
  border-bottom:1px solid #ddd;
}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:10px;}
th,td{border:1px solid #ccc;padding:10px;text-align:center;}
td.selectable{cursor:pointer;}
td.selected{background:#2563eb;color:white;}

.btn{
  width:100%;padding:12px;margin-top:12px;background:#2563eb;color:white;
  border:none;font-size:1rem;border-radius:8px;cursor:pointer;
}

.list{padding:16px;}
.group-box{
  background:#fff;padding:14px;margin-bottom:14px;border-radius:8px;
  border-left:5px solid #2563eb;
}
.group-title{ font-weight:bold;margin-bottom:6px; }

.schedule-box{padding:16px;}
input{
  width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:8px;
}

.schedule-table td{ height:40px;cursor:pointer; }

/* Popup */
.popup-bg{
  position:fixed;left:0;right:0;top:0;bottom:0;
  background:rgba(0,0,0,0.35);display:none;
}
.popup{
  background:#fff;
  position:absolute;
  left:0; right:0; bottom:0;
  padding:20px;
  border-radius:20px 20px 0 0;
  animation:slideUp .25s ease-out;
}
@keyframes slideUp{ from{transform:translateY(100%);} to{transform:translateY(0);} }

.name-item{
  background:#fff;border:1px solid #ddd;padding:10px;border-radius:8px;
  margin-bottom:6px;cursor:pointer;
}
</style>
</head>

<body>

<header>ë ˆìŠ¨ ì‹œê°„í‘œ</header>

<div style="padding:12px;">
<table>
  <thead>
    <tr>
      <th>ì‹œê°„</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th>
    </tr>
  </thead>
  <tbody id="lessonBody"></tbody>
</table>

<button class="btn" onclick="openMakeupPopup()">ë³´ê°• ëŒ€ìƒì ìƒì„±</button>
</div>

<header>ë³´ê°• ëŒ€ìƒì</header>
<div class="list" id="makeupList"></div>

<header>ë³´ê°• ìŠ¤ì¼€ì¥´</header>
<div class="schedule-box">
  <button class="btn" style="background:#16a34a;" onclick="openSchedulePopup()">ë³´ê°• ìŠ¤ì¼€ì¥´ ìƒì„±</button>
  <div id="scheduleArea"></div>
</div>

<!-- ë³´ê°• ëŒ€ìƒì ìƒì„± íŒì—… -->
<div id="makeupPopup" class="popup-bg">
  <div class="popup">
    <h3>ë³´ê°• ë‚ ì§œ & ì‚¬ìœ  ì…ë ¥</h3>
    <input type="date" id="makeupDate">
    <input id="makeupReason" placeholder="ì‚¬ìœ  ì…ë ¥">

    <button class="btn" onclick="createMakeupTargets()">ìƒì„±</button>
    <button class="btn" style="background:#6b7280;" onclick="closeMakeupPopup()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- ìŠ¤ì¼€ì¥´ ìƒì„± íŒì—… -->
<div id="schedulePopup" class="popup-bg">
  <div class="popup">
    <h3>ë³´ê°• ìŠ¤ì¼€ì¥´ ì„¤ì •</h3>

    <input type="date" id="scheduleDate">

    <label>ì‹œì‘ ì‹œê°„ (11:25)</label>
    <input value="11:25" disabled>

    <label>êµì‹œ ìˆ˜ (15ë¶„ ë‹¨ìœ„)</label>
    <input id="periodCount" type="number" placeholder="ì˜ˆ: 5">

    <button class="btn" onclick="generateSchedule()">ìŠ¤ì¼€ì¥´ ìƒì„±</button>
    <button class="btn" style="background:#6b7280;" onclick="closeSchedulePopup()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- ì´ë¦„ ì„ íƒ íŒì—… -->
<div id="assignPopup" class="popup-bg">
  <div class="popup">
    <h3>ë³´ê°• ëŒ€ìƒì ì„ íƒ</h3>

    <div id="candidateList"></div>

    <button class="btn" style="background:#ef4444;" onclick="deleteSlot()">ì‚­ì œ</button>
    <button class="btn" style="background:#6b7280;" onclick="cancelAssign()">ì·¨ì†Œ</button>
  </div>
</div>

<script>
// ----------------------------
// ë ˆìŠ¨ ì‹œê°„í‘œ ì›ë³¸
// ----------------------------
const timetable = {
  "11:25": {mon:"ì •ìŠ¹ëª©", tue:"ì´ì„¸ë€", wed:"ì •ìŠ¹ëª©", thu:"ì´ì„¸ë€"},
  "11:40": {mon:"ì´ìƒì¤€", tue:"ë°•ë‚˜ë ¹", wed:"ì´ìƒì¤€", thu:"ë°•ë‚˜ë ¹"},
  "11:55": {mon:"ì´ë‚­ì£¼", tue:"ê¹€ìŠ¹ì¼", wed:"ì´ë‚­ì£¼", thu:"ê¹€ìŠ¹ì¼"},
  "12:10": {mon:"ì¡°ë³´ë¯¸", tue:"ì†¡ì€ì•„", wed:"ì¡°ë³´ë¯¸", thu:"ì†¡ì€ì•„"},
  "12:25": {mon:"ê³ ì€ì„ ", tue:"ì„ì¶˜ê·¼", wed:"ê³ ì€ì„ ", thu:"ì„ì¶˜ê·¼"},
};

let selectedCells = [];
let makeupGroups = [];   // [{date, reason, names:[{name,done:false}]}]
let clickedSlot = null;
let originalSlotValue = "";

// ----------------------------
// ë ˆìŠ¨ ì‹œê°„í‘œ ë Œë”ë§
// ----------------------------
function renderLessonTable(){
  const body=document.getElementById("lessonBody");
  body.innerHTML="";

  Object.keys(timetable).forEach(time=>{
    const tr=document.createElement("tr");
    tr.innerHTML += `<td>${time}</td>`;

    ["mon","tue","wed","thu"].forEach(day=>{
      const name=timetable[time][day];
      const td=document.createElement("td");
      td.className="selectable";
      td.innerText=name;
      td.onclick=()=>toggle(time,day,name,td);
      tr.appendChild(td);
    });

    body.appendChild(tr);
  });
}

function toggle(time,day,name,td){
  const key=`${time}_${day}_${name}`;

  if(selectedCells.includes(key)){
    selectedCells = selectedCells.filter(x=>x!==key);
    td.classList.remove("selected");
  } else {
    selectedCells.push(key);
    td.classList.add("selected");
  }
}

// ----------------------------
// ë³´ê°• ëŒ€ìƒì íŒì—…
// ----------------------------
function openMakeupPopup(){
  document.getElementById("makeupPopup").style.display="block";
}

function closeMakeupPopup(){
  document.getElementById("makeupPopup").style.display="none";
}

// ----------------------------
// ë³´ê°• ëŒ€ìƒì ìƒì„±
// ----------------------------
function createMakeupTargets(){
  const date=document.getElementById("makeupDate").value;
  const reason=document.getElementById("makeupReason").value;

  if(!date || !reason){
    alert("ë‚ ì§œì™€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const group={date, reason, names:[]};

  selectedCells.forEach(k=>{
    const [t,d,name] = k.split("_");
    group.names.push({name,done:false});
  });

  makeupGroups.push(group);
  selectedCells=[];
  
  closeMakeupPopup();
  renderLessonTable();
  renderMakeupList();
}

// ----------------------------
// ë³´ê°• ëŒ€ìƒì ë Œë”ë§
// ----------------------------
function renderMakeupList(){
  const box=document.getElementById("makeupList");
  box.innerHTML="";

  if(makeupGroups.length===0){
    box.innerHTML=`<div style="color:#666;">ë³´ê°• ëŒ€ìƒì ì—†ìŒ</div>`;
    return;
  }

  makeupGroups.forEach((group, idx)=>{
    const div=document.createElement("div");
    div.className="group-box";

    let html = `
      <div class="group-title" style="display:flex;justify-content:space-between;align-items:center;">
        <span>${group.date} / ${group.reason}</span>
        <button 
          style="background:#ef4444;color:white;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;font-size:0.8rem;"
          onclick="deleteGroup(${idx})"
        >
          ì‚­ì œ
        </button>
      </div>
    `;

    group.names.forEach(n=>{
      const doneTxt = n.done ? "<span style='color:green'>(ë³´ê°•ì™„ë£Œ)</span>" : "";
      const btn = n.done ? "" :
        `<button onclick="completeWithoutSchedule('${group.date}','${n.name}')">ë¹ˆíƒ€ì„ ë³´ê°•ì™„ë£Œ</button>`;

      html += `<div>- ${n.name} ${doneTxt} ${btn}</div>`;
    });

    div.innerHTML = html;
    box.appendChild(div);
  });
}


// ë¹ˆíƒ€ì„ ë³´ê°• ì™„ë£Œ
function completeWithoutSchedule(date, name){
  makeupGroups.forEach(g=>{
    if(g.date===date){
      g.names.forEach(n=>{
        if(n.name===name){
          n.done=true;
        }
      });
    }
  });

  renderMakeupList();
}

// ----------------------------
// ìŠ¤ì¼€ì¥´ ìƒì„± íŒì—…
// ----------------------------
function openSchedulePopup(){
  document.getElementById("schedulePopup").style.display="block";
}
function closeSchedulePopup(){
  document.getElementById("schedulePopup").style.display="none";
}

// ----------------------------
// ìŠ¤ì¼€ì¥´ ìƒì„±
// ----------------------------
function generateSchedule(){
  const date=document.getElementById("scheduleDate").value;
  const period = parseInt(document.getElementById("periodCount").value);

  if(!date || !period){
    alert("ê°’ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  document.getElementById("schedulePopup").style.display="none";

  const box=document.getElementById("scheduleArea");
  box.innerHTML=`<h3>${date} ë³´ê°• ìŠ¤ì¼€ì¥´</h3>`;

  let html=`<table class="schedule-table"><tr><th>ì‹œê°„</th><th>ë³´ê°•ì</th><th>ì™„ë£Œ</th></tr>`;

  // ğŸ”¥ ì‹œì‘ì‹œê°„ ê³ ì •
  let currentTime = "11:25";

  for(let i=0;i<period;i++){
    html += `
      <tr>
        <td>${currentTime}</td>
        <td onclick="openAssignPopup(this)"></td>
        <td><button onclick="markDoneFromSchedule(this)">ì™„ë£Œ</button></td>
      </tr>
    `;

    // ğŸ”¥ ì •í™•í•˜ê²Œ 15ë¶„ ì¦ê°€
    currentTime = addMinutes(currentTime, 15);
  }

  html += `</table>`;
  box.innerHTML += html;
}


// ë‹«ê¸° ë²„íŠ¼
function closeSchedule(){
  document.getElementById("scheduleArea").innerHTML="";
}

// ----------------------------
// ìŠ¤ì¼€ì¥´ ë‚´ ì™„ë£Œ ì²˜ë¦¬
// ----------------------------
function markDoneFromSchedule(btn){
  const td = btn.parentElement.previousElementSibling;
  const name = td.innerText.trim();

  if(!name) return alert("ì´ ì¹¸ì— ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤.");

  markDone(name);
  renderMakeupList();
  alert(name+" ë³´ê°•ì™„ë£Œ!");
}

function markDone(name){
  makeupGroups.forEach(g=>{
    g.names.forEach(n=>{
      if(n.name===name) n.done=true;
    });
  });
}

// ----------------------------
// ë°°ì • íŒì—…
// ----------------------------
function getAssignedNames(){
  const arr=[];
  document.querySelectorAll("#scheduleArea td:nth-child(2)")
    .forEach(td=>{
      if(td.innerText.trim()) arr.push(td.innerText.trim());
    });
  return arr;
}

function openAssignPopup(td){
  clickedSlot=td;
  originalSlotValue = td.innerText.trim();

  const assigned=getAssignedNames();
  const list=document.getElementById("candidateList");
  list.innerHTML="";

  makeupGroups.forEach((g,gi)=>{
    const title=document.createElement("div");
    title.style="font-weight:bold;margin:8px 0 4px;";
    title.innerText=`${g.date} / ${g.reason}`;
    list.appendChild(title);

    g.names.filter(n=>!n.done).forEach((n,ni)=>{
      const div=document.createElement("div");
      div.className="name-item";

      if(assigned.includes(n.name)){
        div.style.opacity="0.4";
        div.style.pointerEvents="none";
        div.innerText=n.name+" (ë°°ì •ë¨)";
      } else {
        div.innerText=n.name;
        div.onclick=()=>assign(gi,ni);
      }

      list.appendChild(div);
    });
  });

  document.getElementById("assignPopup").style.display="block";
}

function assign(groupIdx, nameIdx){
  const name = makeupGroups[groupIdx].names[nameIdx].name;
  clickedSlot.innerText=name;
  document.getElementById("assignPopup").style.display="none";
}

function deleteSlot(){
  clickedSlot.innerText="";
  document.getElementById("assignPopup").style.display="none";
}

function cancelAssign(){
  clickedSlot.innerText=originalSlotValue;
  document.getElementById("assignPopup").style.display="none";
}
function deleteGroup(index){
  if(confirm("ì´ ë³´ê°• ëŒ€ìƒì ê·¸ë£¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
    makeupGroups.splice(index, 1);
    renderMakeupList();
  }
}

function addMinutes(time, minutesToAdd){
  const [hh, mm] = time.split(":").map(Number);
  const base = new Date(2000, 0, 1, hh, mm);
  base.setMinutes(base.getMinutes() + minutesToAdd);

  const newH = String(base.getHours()).padStart(2, "0");
  const newM = String(base.getMinutes()).padStart(2, "0");
  return `${newH}:${newM}`;
}

// ----------------------------
// ì´ˆê¸° ì‹¤í–‰
// ----------------------------
renderLessonTable();
renderMakeupList();

</script>
</body>
</html>
