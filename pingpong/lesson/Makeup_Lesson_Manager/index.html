<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Makeup Lesson Manager</title>

<style>
/* ===== 전체 배경 & 폰트 ===== */
body{
  font-family:-apple-system, BlinkMacSystemFont, "Pretendard", sans-serif;
  margin:0;
  background:#eef1f6;
  color:#1e293b;
}

/* ===== 헤더 ===== */
header{
  background:#ffffff;
  padding:18px 20px;
  font-size:1.4rem;
  font-weight:700;
  border-bottom:1px solid #d1d5db;
  position:sticky;
  top:0;
  z-index:10;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
}

/* ===== 버튼 스타일 공통 ===== */
.btn{
  width:100%;
  padding:12px;
  margin-top:12px;
  border:none;
  font-size:1rem;
  font-weight:600;
  border-radius:10px;
  cursor:pointer;
  background:linear-gradient(135deg, #2563eb, #3b82f6);
  color:white;
  transition:0.2s;
}

.btn:hover{
  opacity:0.92;
  transform:translateY(-2px);
}

.btn-gray{
  background:#6b7280 !important;
}

.btn-danger{
  background:#ef4444 !important;
}

/* ===== 레슨 시간표 테이블 ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-top:10px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 14px rgba(0,0,0,0.08);
}
th{
  background:#f3f4f6;
  font-weight:700;
  padding:12px;
}
td{
  padding:12px;
  border:1px solid #e5e7eb;
}
td.selectable{
  cursor:pointer;
  transition:0.15s;
}
td.selectable:hover{
  background:#e3edff;
}
td.selected{
  background:#2563eb;
  color:white;
}

/* ===== 보강 대상자 카드 ===== */
.list{
  padding:16px;
}

.group-box{
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:14px;
  border-left:7px solid #2563eb;
  box-shadow:0 4px 12px rgba(0,0,0,0.07);
}

.group-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
  margin-bottom:8px;
}

.name-item{
  background:#f9fafb;
  border:1px solid #e5e7eb;
  padding:10px;
  border-radius:10px;
  margin-bottom:6px;
  cursor:pointer;
  transition:0.15s;
}
.name-item:hover{
  background:#e8f0ff;
}

/* 완료 라벨 */
.done-label{
  color:#16a34a;
  font-weight:bold;
}

/* 예정 라벨 */
.pending-label{
  color:#6b7280;
  font-weight:600;
}

/* ===== 보강 스케줄 카드 ===== */
.schedule-box{
  padding:16px;
}

.schedule-card{
  background:#ffffff;
  padding:16px;
  margin-bottom:18px;
  border-radius:14px;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}

.schedule-title{
  font-size:1.2rem;
  font-weight:700;
  margin-bottom:10px;
}

/* 스케줄 테이블 */
.schedule-table{
  width:100%;
  border-collapse:collapse;
}
.schedule-table th{
  background:#f1f5f9;
  padding:10px;
}
.schedule-table td{
  padding:10px;
  border:1px solid #e5e7eb;
}

/* 상태 버튼 */
.state-btn{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  font-size:0.9rem;
  cursor:pointer;
  transition:0.15s;
}
.state-btn.pending{
  background:#2563eb;
  color:white;
}
.state-btn.done{
  background:#16a34a;
  color:white;
}
.state-btn:hover{
  opacity:0.85;
}

/* ===== 팝업 ===== */
.popup-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  backdrop-filter:blur(4px);
  display:none;
}
.popup{
  background:#fff;
  position:absolute;
  left:0; right:0; bottom:0;
  padding:24px;
  border-radius:20px 20px 0 0;
  animation:slideUp .25s ease-out;
  box-shadow:0 -4px 12px rgba(0,0,0,0.15);
}

@keyframes slideUp{
  from{ transform:translateY(100%); }
  to{ transform:translateY(0); }
}

input{
  width:100%;
  padding:12px;
  margin:6px 0;
  border:1px solid #d1d5db;
  border-radius:10px;
  font-size:1rem;
}


</style>
</head>

<body>

<header>레슨 시간표</header>

<div style="padding:12px;">
<table>
  <thead>
    <tr>
      <th>시간</th>
      <th>월</th>
      <th>화</th>
      <th>수</th>
      <th>목</th>
    </tr>
  </thead>
  <tbody id="lessonBody"></tbody>
</table>

<button class="btn" onclick="openMakeupPopup()">보강 대상자 생성</button>
</div>

<header>보강 대상자</header>
<div class="list" id="makeupList"></div>

<header>보강 스케쥴</header>
<div class="schedule-box">
  <button class="btn" style="background:#16a34a;" onclick="openSchedulePopup()">보강 스케쥴 생성</button>
  <div id="scheduleArea" style="margin-top:16px;"></div>
</div>

<!-- 보강 대상자 생성 팝업 -->
<div id="makeupPopup" class="popup-bg">
  <div class="popup">
    <h3>레슨 미실시 날짜 & 사유 입력</h3>
    <input type="date" id="makeupDate">
    <input id="makeupReason" placeholder="사유 입력">

    <button class="btn" onclick="createMakeupTargets()">생성</button>
    <button class="btn" style="background:#6b7280;margin-top:12px;" onclick="closeMakeupPopup()">취소</button>
  </div>
</div>

<!-- 보강 스케줄 생성 팝업 -->
<div id="schedulePopup" class="popup-bg">
  <div class="popup">
    <h3>보강 스케쥴 설정</h3>
    <input type="date" id="scheduleDate">

    <label>시작 시간 (수정 가능)</label>
    <input id="startTime" type="time" value="11:25">

    <label>교시 수 (기본 5교시 / 15분 단위)</label>
    <input id="periodCount" type="number" value="5" min="1">

    <button class="btn" onclick="generateSchedule()">스케쥴 생성</button>
    <button class="btn" style="background:#6b7280;" onclick="closeSchedulePopup()">취소</button>
  </div>
</div>

<!-- 이름 선택 팝업 -->
<div id="assignPopup" class="popup-bg">
  <div class="popup">
    <h3>보강 대상자 선택</h3>
    <div id="candidateList"></div>

    <button class="btn" style="background:#ef4444;margin-top:12px;" onclick="deleteSlot()">삭제</button>
    <button class="btn" style="background:#6b7280;margin-top:12px;" onclick="cancelAssign()">취소</button>
  </div>
</div>

<script>
/* ----------------------------  
     기본 데이터
-----------------------------*/

const timetable = {
  "11:25": {mon:"정승목", tue:"이세란", wed:"정승목", thu:"이세란"},
  "11:40": {mon:"이상준", tue:"박나령", wed:"이상준", thu:"박나령"},
  "11:55": {mon:"이낭주", tue:"김승일", wed:"이낭주", thu:"김승일"},
  "12:10": {mon:"조보미", tue:"송은아", wed:"조보미", thu:"송은아"},
  "12:25": {mon:"고은선", tue:"임춘근", wed:"고은선", thu:"임춘근"},
};

let selectedCells = [];
let makeupGroups = [];  
let scheduleList = [];

let clickedSchedule = null;

/* ----------------------------  
  레슨 시간표 렌더링
-----------------------------*/

function renderLessonTable(){
  const body=document.getElementById("lessonBody");
  body.innerHTML="";

  Object.keys(timetable).forEach(time=>{
    const tr=document.createElement("tr");
    tr.innerHTML += `<td>${time}</td>`;

    ["mon","tue","wed","thu"].forEach(day=>{
      const name=timetable[time][day];
      const td=document.createElement("td");
      td.className="selectable";
      td.innerText=name;
      td.onclick=()=>toggle(time,day,name,td);
      tr.appendChild(td);
    });

    body.appendChild(tr);
  });
}

function toggle(time,day,name,td){
  const key=`${time}_${day}_${name}`;
  if(selectedCells.includes(key)){
    selectedCells = selectedCells.filter(x=>x!==key);
    td.classList.remove("selected");
  } else {
    selectedCells.push(key);
    td.classList.add("selected");
  }
}

/* ----------------------------  
    보강 대상자 생성
-----------------------------*/

function openMakeupPopup(){
  if(selectedCells.length===0){
    alert("보강 대상자를 선택하세요.");
    return;
  }
  document.getElementById("makeupPopup").style.display="block";
}

function closeMakeupPopup(){
  document.getElementById("makeupPopup").style.display="none";
}

function createMakeupTargets(){
  const date=document.getElementById("makeupDate").value;
  const reason=document.getElementById("makeupReason").value;

  if(!date || !reason){
    alert("날짜와 사유 입력");
    return;
  }

  const newGroup = { date, reason, names:[] };

  selectedCells.forEach(key=>{
    const [t,d,name] = key.split("_");
    newGroup.names.push({ name, done:false });
  });

  makeupGroups.push(newGroup);
  selectedCells=[];
  closeMakeupPopup();

  renderMakeupList();
  renderLessonTable();
}

/* ----------------------------  
    보강 대상자 리스트
-----------------------------*/
function renderMakeupList(){
  const box=document.getElementById("makeupList");
  box.innerHTML="";

  if(makeupGroups.length===0){
    box.innerHTML=`<div style="color:#666;">보강 대상자 없음</div>`;
    return;
  }

  makeupGroups.forEach((group, idx)=>{
    const div=document.createElement("div");
    div.className="group-box";

    let html = `
      <div class="group-title">
        <span>${group.date} (${getKoreanDay(group.date)}) / ${group.reason}</span>
        <button style="background:#ef4444;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:0.8rem;"
          onclick="deleteGroup(${idx})">삭제</button>
      </div>
    `;

    group.names.forEach((n,i)=>{
      const state = n.done 
  ? "<span style='color:green; font-weight:bold;'>(보강완료)</span>" 
  : "<span style='color:#999'>(보강예정)</span>";


      const btn = `
        <button onclick="completeWithoutSchedule(${idx}, ${i})"
          style="margin-left:8px;padding:4px 6px;">
          ${n.done ? "보강완료 취소" : "빈타임 보강완료"}
        </button>
      `;

      html += `<div>- ${n.name} ${state} ${btn}</div>`;
    });

    div.innerHTML = html;
    box.appendChild(div);
  });
}


function deleteGroup(idx){
  if(!confirm("해당 그룹을 삭제할까요?")) return;

  makeupGroups.splice(idx,1);
  renderMakeupList();
}

/* ----------------------------  
   스케줄 생성
-----------------------------*/

function openSchedulePopup(){
  document.getElementById("schedulePopup").style.display="block";
}

function closeSchedulePopup(){
  document.getElementById("schedulePopup").style.display="none";
}

function generateSchedule(){
  const date = document.getElementById("scheduleDate").value;
  const period = parseInt(document.getElementById("periodCount").value);
  const startTime = document.getElementById("startTime").value;

  if(!date || !period || !startTime){
    alert("값을 모두 입력하세요.");
    return;
  }

  closeSchedulePopup();

  let schedule = { date, slots:[] };

  let [hh, mm] = startTime.split(":").map(Number);

  for(let i=0;i<period;i++){
    const time = `${String(hh).padStart(2,"0")}:${String(mm).padStart(2,"0")}`;
    schedule.slots.push({ time, name:"", done:false, groupDate:null });

    mm += 15;
    if(mm >= 60){ mm = 0; hh++; }
  }

  scheduleList.push(schedule);
  renderScheduleList();
}

/* ----------------------------  
    스케줄 리스트 렌더링
-----------------------------*/

function renderScheduleList(){
  const box=document.getElementById("scheduleArea");
  box.innerHTML="";

  scheduleList.forEach((sc, idx)=>{
    const wrap=document.createElement("div");
    wrap.style="margin-bottom:20px;background:#fff;padding:14px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);";

    wrap.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
       <h3>${sc.date} (${getKoreanDay(sc.date)})</br> 보강 스케쥴</h3>

        <div>
          <button onclick="toggleScheduleView(${idx})"
            style="padding:6px 10px;border:none;border-radius:6px;background:#2563eb;color:#fff;margin-right:6px;">
            보기/숨기기
          </button>

          <button onclick="removeSchedule(${idx})"
            style="padding:6px 10px;border:none;border-radius:6px;background:#ef4444;color:#fff;">
            닫기
          </button>
        </div>
      </div>

      <div id="scheduleTable_${idx}"></div>
    `;

    box.appendChild(wrap);
    renderScheduleTable(idx);
  });
}

function toggleScheduleView(idx){
  const box=document.getElementById(`scheduleTable_${idx}`);
  box.style.display = (box.style.display==="none" ? "block" : "none");
}

function removeSchedule(idx){
  if(confirm("이 스케쥴을 삭제하시겠습니까?")){
    scheduleList.splice(idx,1);
    renderScheduleList();
  }
}

/* ----------------------------  
    스케줄 테이블 렌더링
-----------------------------*/

function renderScheduleTable(idx){
  const sc = scheduleList[idx];
  const container=document.getElementById(`scheduleTable_${idx}`);

  let html = `
    <table class="schedule-table">
      <tr><th>시간</th><th>보강자</th><th>상태</th></tr>
  `;

  sc.slots.forEach((slot, sidx)=>{
    const btnLabel = slot.done ? "보강완료" : "보강예정";
    const btnColor = slot.done ? "background:green;color:white;" : "background:#2563eb;color:white;";

    html += `
      <tr>
        <td>${slot.time}</td>
        <td onclick="openAssignPopupSchedule(${idx}, ${sidx})">${slot.name}</td>
        <td>
          <button onclick="markDoneSchedule(${idx}, ${sidx})"
            style="padding:6px 10px;border:none;border-radius:6px;${btnColor}">
            ${btnLabel}
          </button>
        </td>
      </tr>
    `;
  });

  html += `</table>`;
  container.innerHTML = html;
}

/* ----------------------------  
    보강완료 처리 (그룹 구분)
-----------------------------*/

function markDoneSchedule(sIdx, slotIdx){
  const slot = scheduleList[sIdx].slots[slotIdx];
  if(!slot.name){
    alert("보강자를 먼저 배정하세요.");
    return;
  }

  slot.done = true;

  // groupDate 기준으로 해당 그룹만 완료 처리
  markDoneGroup(slot.groupDate, slot.name);

  renderMakeupList();
  renderScheduleTable(sIdx);
}

function markDoneGroup(groupDate, name){
  makeupGroups.forEach(g=>{
    if(g.date === groupDate){
      g.names.forEach(n=>{
        if(n.name === name){
          n.done = true;
        }
      });
    }
  });
}

/* ----------------------------  
    이름 배정 팝업
-----------------------------*/

function openAssignPopupSchedule(sIdx, slotIdx){
  clickedSchedule = { sIdx, slotIdx };

  const list=document.getElementById("candidateList");
  list.innerHTML="";

  makeupGroups.forEach(group=>{
    const title=document.createElement("div");
    title.style="font-weight:bold;margin:10px 0 4px;";
    title.innerText = `${group.date} (${getKoreanDay(group.date)}) / ${group.reason}`;
    list.appendChild(title);

    group.names
      .filter(x => !x.done)
      .forEach(n => {
        const div=document.createElement("div");
        div.className="name-item";
        div.innerText = n.name;
        div.onclick = ()=>assignToSchedule(sIdx, slotIdx, n.name, group.date);
        list.appendChild(div);
      });
  });

  document.getElementById("assignPopup").style.display="block";
}

function assignToSchedule(sIdx, slotIdx, name, groupDate){
  const slot = scheduleList[sIdx].slots[slotIdx];
  slot.name = name;
  slot.done = false;
  slot.groupDate = groupDate;  // ⭐ 그룹 날짜 저장 → 그룹 구분 가능

  document.getElementById("assignPopup").style.display="none";
  renderScheduleTable(sIdx);
}

function deleteSlot(){
  if(clickedSchedule){
    const slot = scheduleList[clickedSchedule.sIdx].slots[clickedSchedule.slotIdx];
    slot.name = "";
    slot.done = false;
    slot.groupDate = null;
    renderScheduleTable(clickedSchedule.sIdx);
  }
  document.getElementById("assignPopup").style.display="none";
}

function cancelAssign(){
  document.getElementById("assignPopup").style.display="none";
}

/* ----------------------------  
    날짜 → 요일 변환
-----------------------------*/

function getKoreanDay(dateStr){
  const days = ["일","월","화","수","목","금","토"];
  return days[new Date(dateStr).getDay()];
}

/* ----------------------------
   빈타임 보강완료 / 취소 (토글)
-----------------------------*/
function completeWithoutSchedule(groupIndex, nameIndex){
  const target = makeupGroups[groupIndex].names[nameIndex];

  // 상태 토글
  target.done = !target.done;

  // 화면 갱신
  renderMakeupList();
}

/* 초기 렌더링 */
renderLessonTable();
renderMakeupList();

</script>

</body>
</html>
