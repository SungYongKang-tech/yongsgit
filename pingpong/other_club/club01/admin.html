<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>🏓 관리자 모드</title>
<style>
:root{
  --ink:#0f172a; --muted:#64748b; --bg:#f5f7fb;
  --primary:#0d47a1; --accent:#2563eb; --danger:#ef4444; --ok:#16a34a;
}
body{margin:0;font-family:system-ui,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--ink)}
.wrap{max-width:640px;margin:0 auto;padding:20px}
h1{text-align:center;color:var(--primary)}
.card{background:#fff;border-radius:12px;padding:16px;margin-top:12px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input{padding:6px 8px;font-size:14px;border:1px solid #ccc;border-radius:6px}
.btn{border:1px solid #ccc;border-radius:6px;padding:6px 10px;font-size:14px;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.warn{background:var(--danger);color:#fff;border-color:var(--danger)}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #e5e7eb;padding:6px;text-align:center;font-size:14px}
thead{background:#f1f5f9}
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
background:#111827;color:#fff;padding:8px 12px;border-radius:10px;opacity:0;transition:.25s}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <h1>🏓 PingPong Club 관리자</h1>

  <!-- 선수 등록 -->
  <div class="card">
    <h3>선수 등록</h3>
    <div class="row">
      <input id="name" type="text" placeholder="이름 입력 (예: 김승일)" />
      <input id="level" type="number" placeholder="부수" style="width:80px" />
      <button id="add" class="btn primary">등록</button>
    </div>
    <small style="color:var(--muted)">입력 후 등록 버튼을 누르면 Firebase에 바로 저장됩니다.</small>

    <table>
      <thead><tr><th>이름</th><th>부수</th><th>상태</th><th>관리</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<div id="toast" class="toast">저장되었습니다</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, set, remove, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// ✅ Firebase 연결
const firebaseConfig = {
  apiKey: "AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain: "pingpongclub-4a5fd.firebaseapp.com",
  databaseURL: "https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId: "pingpongclub-4a5fd",
  storageBucket: "pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId: "802826774007",
  appId: "1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const playerRef = ref(db, "players");

const $ = (s) => document.querySelector(s);
const toast = (msg="저장되었습니다")=>{
  const t=$("#toast");t.textContent=msg;t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1500);
};

// ✅ 실시간 선수 목록 표시
onValue(playerRef, (snap)=>{
  const tbody=$("#tbody");
  tbody.innerHTML="";
  const data=snap.val()||{};
  Object.entries(data).forEach(([id,p])=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.name}</td>
      <td>${p.level}</td>
      <td>${p.hidden?"숨김":"활성"}</td>
      <td>
        ${p.hidden
          ? `<button class="btn ok" onclick="unhide('${id}')">복구</button>`
          : `<button class="btn warn" onclick="hide('${id}')">숨김</button>`}
        <button class="btn warn" onclick="del('${id}')">삭제</button>
      </td>`;
    tbody.appendChild(tr);
  });
});

// ✅ 등록 버튼 클릭 → Firebase에 push
$("#add").onclick = async ()=>{
  const name=$("#name").value.trim();
  const level=parseInt($("#level").value)||0;
  if(!name){toast("이름을 입력하세요");return;}
  await push(playerRef,{name,level,hidden:false,joinedAt:Date.now()});
  $("#name").value="";$("#level").value="";
  toast("선수 등록 완료");
};

// ✅ 숨김/복구/삭제 함수
window.hide=async(id)=>{await set(ref(db,`players/${id}/hidden`),true);toast("숨김 처리됨");};
window.unhide=async(id)=>{await set(ref(db,`players/${id}/hidden`),false);toast("복구됨");};
window.del=async(id)=>{
  if(!confirm("정말 삭제하시겠습니까?"))return;
  await remove(ref(db,`players/${id}`));toast("삭제 완료");
};
</script>
</body>
</html>
