<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🏓 관리자모드</title>
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

:root{
  --ink:#0f172a; --muted:#64748b; --card:#fff; --bg:#f5f7fb;
  --primary:#0d47a1; --accent:#2563eb; --ok:#16a34a; --danger:#ef4444;
  --shadow:0 8px 28px rgba(0,0,0,.08); --gray:#9ca3af;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Pretendard","Noto Sans KR",sans-serif;
  font-weight:600;
  color:var(--ink);
  background:var(--bg);
}
header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid #e5e7eb}
.wrap{max-width:1040px;margin:0 auto;padding:14px 16px}
h1{margin:4px 0 6px;font-size:clamp(20px,4vw,24px);color:var(--primary);font-weight:700}
h3{margin:0 0 8px;font-size:17px;color:#1e293b;font-weight:700}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.btn{
  border:1px solid #d1d5db;border-radius:8px;padding:6px 10px;
  font-size:14px;background:#fff;cursor:pointer;font-weight:600;
  transition:.15s;
}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.warn{background:var(--danger);color:#fff;border-color:var(--danger)}
.btn.gray{background:var(--gray);color:#fff;border-color:var(--gray)}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:12px;padding:14px;box-shadow:var(--shadow);margin:10px 0}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;margin-top:8px}
thead th{background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:6px;font-size:14px;color:#334155;text-align:center;font-weight:700}
tbody td{
  border-bottom:1px solid #f1f5f9;
  padding:4px 6px;
  font-size:14px;
  text-align:center;
  line-height:1.3;
}
tbody tr:hover{background:#f9fafb}
input[type="text"],input[type="number"]{
  padding:6px 8px;font-size:14px;border:1px solid #cbd5e1;border-radius:6px;
}
.toast{
  position:fixed;left:50%;transform:translateX(-50%);bottom:18px;
  background:#111827;color:#fff;padding:10px 14px;border-radius:12px;
  opacity:0;transition:.25s;font-weight:600;
}
.toast.show{opacity:1}
@media(max-width:640px){
  input[type="text"],input[type="number"]{flex:1}
  .btn{font-size:13px;padding:5px 8px}
}
</style>
</head>
<body>
<header>
  <div class="wrap row" style="justify-content:space-between;">
    <h1 id="pageHeader">🏓 관리자모드</h1>
    <div class="row">
      <a class="btn" href="index.html">← 경기결과</a>
      <a class="btn primary" href="monthly-report.html">📊 월간 리포트</a>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- 제목 설정 -->
  <section class="card">
    <h3>사이트 제목 설정</h3>
    <div class="row">
      <input id="siteTitle" type="text" placeholder="예: KOEN 탁구클럽" style="flex:1"/>
      <button id="saveTitle" class="btn primary">저장</button>
    </div>
    <small style="color:var(--muted)">이 제목은 경기결과/월간리포트/관리자모드 전체에 반영됩니다.</small>
  </section>

  <!-- 선수 등록 -->
  <section class="card">
    <h3>선수 등록</h3>
    <div class="row">
      <input id="playerName" type="text" placeholder="이름 (예: 김승일)" style="flex:1;min-width:120px"/>
      <input id="playerLevel" type="number" placeholder="부수" style="width:60px;text-align:center"/>
      <button id="addPlayer" class="btn primary">등록</button>
    </div>

    <table>
      <thead><tr><th>이름</th><th>부수</th><th>관리</th></tr></thead>
      <tbody id="playersTable"></tbody>
    </table>
  </section>

  <!-- 복식 가중치 및 비밀번호 -->
  <section class="card">
    <h3>설정 관리</h3>
    <div class="row">
      <label>복식 가중치:</label>
      <input id="doubleWeight" type="number" min="0" max="1" step="0.1" value="1" style="width:70px;text-align:center">
      <button id="saveDoubleWeight" class="btn primary">저장</button>
    </div>

    <div class="row" style="margin-top:6px;">
      <label>삭제 비밀번호:</label>
      <input id="deletePassword" type="text" placeholder="예: 7910" style="width:90px;text-align:center">
      <button id="saveDeletePassword" class="btn primary">저장</button>
    </div>

    <div class="row" style="margin-top:6px;">
      <label>관리자 접속 비밀번호:</label>
      <input id="adminPassword" type="text" placeholder="예: 1234" style="width:90px;text-align:center">
      <button id="saveAdminPassword" class="btn primary">저장</button>
    </div>
  </section>
</main>

<div id="toast" class="toast">저장되었습니다</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const $ = s=>document.querySelector(s);
const toast=(m="저장되었습니다")=>{
  const t=$("#toast");t.textContent=m;t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1500);
};

// ===== 제목 관리 =====
const titleRef = ref(db, 'config/title');
const cachedTitle = localStorage.getItem('siteTitle');
if(cachedTitle){
  document.title = `🏓 ${cachedTitle} 관리자모드`;
  $('#pageHeader').textContent = `🏓 ${cachedTitle} 관리자모드`;
}
onValue(titleRef, s=>{
  const val = s.val() ?? 'PingPong Club';
  localStorage.setItem('siteTitle', val);
  document.title = `🏓 ${val} 관리자모드`;
  $('#pageHeader').textContent = `🏓 ${val} 관리자모드`;
  $('#siteTitle').value = val;
});
$('#saveTitle').onclick = async()=>{
  const title = $('#siteTitle').value.trim();
  if(!title)return toast('제목을 입력하세요');
  await set(titleRef, title);
  localStorage.setItem('siteTitle', title);
  toast('제목 변경 완료');
};

// ===== 선수 관리 =====
const playerRef = ref(db, 'players');
onValue(playerRef,snap=>{
  const tbody=$("#playersTable");tbody.innerHTML="";
  const data=snap.val()||{};
  Object.entries(data).forEach(([id,p])=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${p.name}</td>
      <td><input type="number" value="${p.level}" style="width:50px;text-align:center" onchange="updateLevel('${id}',this.value)"></td>
      <td>
        ${p.hidden?`<button class="btn ok" onclick="unhide('${id}')">복구</button>`:`<button class="btn gray" onclick="hide('${id}')">숨김</button>`}
        <button class="btn warn" onclick="del('${id}')">삭제</button>
      </td>`;
    tbody.appendChild(tr);
  });
});
window.updateLevel=async(id,v)=>{await set(ref(db,`players/${id}/level`),parseInt(v));toast('부수 수정 완료');};
$('#addPlayer').onclick=async()=>{
  const name=$('#playerName').value.trim();
  const level=parseInt($('#playerLevel').value)||0;
  if(!name)return toast('이름 입력');
  await push(playerRef,{name,level,hidden:false,joinedAt:Date.now()});
  $('#playerName').value='';$('#playerLevel').value='';
  toast('선수 등록 완료');
};
window.hide=async(id)=>{await set(ref(db,`players/${id}/hidden`),true);toast('숨김 처리');};
window.unhide=async(id)=>{await set(ref(db,`players/${id}/hidden`),false);toast('복구 완료');};
window.del=async(id)=>{if(!confirm('정말 삭제하시겠습니까?'))return;await remove(ref(db,`players/${id}`));toast('삭제 완료');};

// ===== 기타 설정 =====
onValue(ref(db,'config/doubleWeight'),s=>$('#doubleWeight').value=s.val()??1);
$('#saveDoubleWeight').onclick=async()=>{
  const v=parseFloat($('#doubleWeight').value);
  if(isNaN(v)||v<0||v>1)return toast('0~1 사이 숫자만 입력');
  await set(ref(db,'config/doubleWeight'),v);
  toast('복식 가중치 저장');
};
onValue(ref(db,'config/deletePassword'),s=>$('#deletePassword').value=s.val()??'7910');
$('#saveDeletePassword').onclick=async()=>{
  const v=$('#deletePassword').value.trim();
  if(!v)return toast('비밀번호 입력');
  await set(ref(db,'config/deletePassword'),v);
  toast('삭제 비밀번호 저장');
};
onValue(ref(db,'config/adminPassword'),s=>$('#adminPassword').value=s.val()??'1234');
$('#saveAdminPassword').onclick=async()=>{
  const v=$('#adminPassword').value.trim();
  if(!v)return toast('관리자 비밀번호 입력');
  await set(ref(db,'config/adminPassword'),v);
  toast('관리자 비밀번호 저장');
};
</script>
</body>
</html>
