<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ“ PingPong Club Â· ê´€ë¦¬ì</title>
<style>
:root{
  --ink:#0f172a; --muted:#64748b; --card:#fff; --bg:#f5f7fb;
  --primary:#0d47a1; --accent:#2563eb; --ok:#16a34a; --danger:#ef4444;
  --shadow:0 8px 28px rgba(0,0,0,.08)
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,"Noto Sans KR",sans-serif;color:var(--ink);background:var(--bg)}
header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid #e5e7eb}
.wrap{max-width:1040px;margin:0 auto;padding:14px 16px}
h1{margin:4px 0 6px;font-size:clamp(18px,4vw,24px);color:var(--primary)}
main{max-width:1040px;margin:16px auto;padding:0 16px 40px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{border:1px solid #d1d5db;border-radius:10px;padding:8px 12px;font-size:14px;background:#fff;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.warn{background:#ef4444;color:#fff;border-color:#ef4444}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:14px;box-shadow:var(--shadow);margin:12px 0}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
thead th{background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:10px;font-size:14px;color:#334155;text-align:left}
tbody td{border-bottom:1px solid #f1f5f9;padding:8px;font-size:14px}
.muted{color:var(--muted)}
input[type="text"],input[type="number"]{padding:6px 8px;font-size:14px;border:1px solid #ccc;border-radius:6px}
input[type="number"]{width:90px}
.small{font-size:12px}
.hint{color:#64748b;font-size:13px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;pointer-events:none;transition:.25s}
.toast.show{opacity:1}
#locked{position:fixed;inset:0;background:#f5f7fb;display:flex;align-items:center;justify-content:center;font-size:18px;color:#555;}
</style>
</head>
<body>
<div id="locked">ğŸ”’ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...</div>

<header>
  <div class="wrap">
    <div class="row">
      <h1 style="margin-right:auto">ğŸ“ PingPong Club Â· ê´€ë¦¬ì</h1>
      <a class="btn" href="index.html">â† ê²°ê³¼ì…ë ¥</a>
      <a class="btn primary" href="monthly-report.html">ğŸ“Š ì›”ê°„ë¦¬í¬íŠ¸</a>
    </div>
    <div class="row"><span class="small muted">â€» ì„ ìˆ˜ë“±ë¡, ë³µì‹ê°€ì¤‘ì¹˜, ìˆ¨ê¹€, ì‚­ì œ ë¹„ë°€ë²ˆí˜¸, ê²½ê¸° ì´ˆê¸°í™” ê´€ë¦¬</span></div>
  </div>
</header>

<main id="main" style="display:none">
  <!-- ì„ ìˆ˜ ë“±ë¡ -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div style="font-weight:700">ì„ ìˆ˜ ë“±ë¡</div>
      <div class="small muted">ë“±ë¡ ì‹œ ë°”ë¡œ ê²°ê³¼ì…ë ¥ í˜ì´ì§€ì— ë°˜ì˜ë©ë‹ˆë‹¤.</div>
    </div>
    <div class="row" style="margin-top:10px; justify-content:flex-start;">
      <input id="playerName" type="text" placeholder="ì´ë¦„ (ì˜ˆ: ê¹€ìŠ¹ì¼)" style="flex:1; min-width:140px;">
      <input id="playerLevel" type="number" placeholder="ë¶€ìˆ˜" style="width:80px;">
      <button id="addPlayer" class="btn primary">ë“±ë¡</button>
    </div>
    <div style="overflow:auto; margin-top:14px">
      <table>
        <thead><tr><th>ì´ë¦„</th><th>ë¶€ìˆ˜</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
        <tbody id="playersTable"></tbody>
      </table>
    </div>
  </section>

  <!-- í†µê³„ ì˜µì…˜ -->
  <section class="card">
    <div class="row" style="justify-content:space-between"><div style="font-weight:700">í†µê³„ ì˜µì…˜</div></div>
    <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-top:8px">
      <!-- ë³µì‹ ê°€ì¤‘ì¹˜ -->
      <div class="card" style="margin:0">
        <div class="muted small" style="margin-bottom:6px">ë³µì‹ ê°€ì¤‘ì¹˜</div>
        <div class="row">
          <input id="doubleWeight" type="number" min="0" max="1" step="0.1" value="1" />
          <button id="saveDoubleWeight" class="btn primary">ì €ì¥</button>
        </div>
        <div class="hint">ì˜ˆ) 0.5 â‡’ ë³µì‹ì€ ë‹¨ì‹ì˜ ì ˆë°˜ ê°€ì¤‘</div>
      </div>

      <!-- ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ -->
      <div class="card" style="margin:0">
        <div class="muted small" style="margin-bottom:6px">ì‚­ì œ ë¹„ë°€ë²ˆí˜¸</div>
        <div class="row">
          <input id="deletePassword" type="text" placeholder="ì˜ˆ: 7910" style="flex:1;max-width:120px;">
          <button id="saveDeletePassword" class="btn primary">ì €ì¥</button>
        </div>
        <div class="hint">ê²°ê³¼ì…ë ¥ í™”ë©´ì—ì„œ ê²½ê¸° ì‚­ì œ ì‹œ ì‚¬ìš©í•˜ëŠ” 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸</div>
      </div>
    </div>
  </section>

  <!-- ğŸ”‘ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„¹ì…˜ -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div style="font-weight:700">ğŸ”‘ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
      <div class="small muted">ì´ ë¹„ë°€ë²ˆí˜¸ëŠ” ê´€ë¦¬ìëª¨ë“œ ì§„ì… ì‹œ ì‚¬ìš©ë©ë‹ˆë‹¤.</div>
    </div>
    <div class="row" style="margin-top:10px;">
      <input id="adminPassword" type="text" placeholder="ìƒˆ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="flex:1;max-width:160px;">
      <button id="saveAdminPassword" class="btn primary">ì €ì¥</button>
    </div>
  </section>

  <!-- ë°ì´í„° ê´€ë¦¬ -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div style="font-weight:700;color:#b91c1c">ë°ì´í„° ê´€ë¦¬</div>
      <div class="small muted">âš ï¸ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
    <div class="row" style="margin-top:8px">
      <button id="purgeMatches" class="btn warn">ğŸ—‘ï¸ ëª¨ë“  ê²½ê¸° ê¸°ë¡ ì‚­ì œ</button>
      <span class="hint">`matches` ì „ì²´ ì‚­ì œ (ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•„ìš”)</span>
    </div>
  </section>
</main>

<div id="toast" class="toast">Saved</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, set, remove, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain: "pingpongclub-4a5fd.firebaseapp.com",
  databaseURL: "https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId: "pingpongclub-4a5fd",
  storageBucket: "pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId: "802826774007",
  appId: "1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const $ = (s,ctx=document)=>ctx.querySelector(s);
const toast = (msg='ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤')=>{
  const t=$('#toast');t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),1600);
};

/* ê´€ë¦¬ì ì ‘ê·¼ ë¹„ë°€ë²ˆí˜¸ */
const adminPwRef = ref(db,'config/adminPassword');
let adminPw = '1234'; // ê¸°ë³¸ê°’
get(adminPwRef).then(s=>{ if(s.exists()) adminPw = s.val(); }).then(()=>{
  const input = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
  if(input === adminPw){
    $('#locked').style.display='none';
    $('#main').style.display='block';
  } else {
    $('#locked').innerHTML='ğŸš« ì ‘ê·¼ ê±°ë¶€: ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
  }
});

/* ğŸ”‘ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ */
$('#saveAdminPassword').onclick = async ()=>{
  const newPw = $('#adminPassword').value.trim();
  if(!newPw){ toast('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
  await set(adminPwRef, newPw);
  adminPw = newPw;
  $('#adminPassword').value = '';
  toast('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
};

/* ì´í•˜ ê¸°ì¡´ ì½”ë“œ ë™ì¼ (ì„ ìˆ˜ë“±ë¡, ê°€ì¤‘ì¹˜, ì‚­ì œ ë“±) */
const playerRef = ref(db,'players');
onValue(playerRef,snap=>{
  const data=snap.val()||{};
  const tbody=$('#playersTable');
  tbody.innerHTML='';
  Object.entries(data).forEach(([id,p])=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${p.name}</td>
      <td>${p.level}</td>
      <td>${p.hidden?'ìˆ¨ê¹€':'í™œì„±'}</td>
      <td>
        ${p.hidden
          ? `<button class="btn ok" onclick="unhide('${id}')">ë³µêµ¬</button>`
          : `<button class="btn warn" onclick="hide('${id}')">ìˆ¨ê¹€</button>`}
        <button class="btn warn" onclick="del('${id}')">ì‚­ì œ</button>
      </td>`;
    tbody.appendChild(tr);
  });
});

$('#addPlayer').onclick=async()=>{
  const name=$('#playerName').value.trim();
  const level=parseInt($('#playerLevel').value)||0;
  if(!name)return toast('ì´ë¦„ ì…ë ¥');
  await push(playerRef,{name,level,hidden:false,joinedAt:Date.now()});
  $('#playerName').value='';$('#playerLevel').value='';
  toast('ì„ ìˆ˜ ë“±ë¡ ì™„ë£Œ');
};

window.hide=async(id)=>{await set(ref(db,`players/${id}/hidden`),true);toast('ìˆ¨ê¹€ ì²˜ë¦¬');};
window.unhide=async(id)=>{await set(ref(db,`players/${id}/hidden`),false);toast('ë³µêµ¬ ì™„ë£Œ');};
window.del=async(id)=>{if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;await remove(ref(db,`players/${id}`));toast('ì‚­ì œ ì™„ë£Œ');};

const weightRef = ref(db,'config/doubleWeight');
onValue(weightRef,s=>$('#doubleWeight').value=s.val()??1);
$('#saveDoubleWeight').onclick=async()=>{
  const v=parseFloat($('#doubleWeight').value);
  if(isNaN(v)||v<0||v>1)return toast('0~1 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥');
  await set(weightRef,v);
  toast('ë³µì‹ ê°€ì¤‘ì¹˜ ì €ì¥');
};

let currentPw='7910';
const deletePwRef = ref(db,'config/deletePassword');
onValue(deletePwRef,s=>{
  $('#deletePassword').value=s.val()??'7910';
  currentPw=s.val()??'7910';
});
$('#saveDeletePassword').onclick=async()=>{
  const v=$('#deletePassword').value.trim();
  if(!v)return toast('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥');
  await set(deletePwRef,v);
  currentPw=v;
  toast('ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥');
};

$('#purgeMatches').onclick=async()=>{
  const pw=prompt('ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
  if(pw!==currentPw)return toast('ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜');
  if(!confirm('âš ï¸ ì •ë§ ëª¨ë“  ê²½ê¸° ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆê¹Œ?'))return;
  await remove(ref(db,'matches'));
  toast('ëª¨ë“  ê²½ê¸° ê¸°ë¡ ì‚­ì œ ì™„ë£Œ');
};
</script>
</body>
</html>
