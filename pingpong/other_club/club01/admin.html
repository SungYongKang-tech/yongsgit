<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ğŸ“ PingPong Club Â· ê´€ë¦¬ì</title>
<style>
:root{
  --ink:#0f172a; --muted:#64748b; --card:#fff; --bg:#f5f7fb;
  --primary:#0d47a1; --accent:#2563eb; --ok:#16a34a; --danger:#ef4444;
  --shadow:0 8px 28px rgba(0,0,0,.08)
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
color:var(--ink);background:var(--bg)}
.wrap{max-width:1000px;margin:0 auto;padding:14px 16px}
h1{color:var(--primary);margin:6px 0}
.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:14px;margin:12px 0;box-shadow:var(--shadow)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{border:1px solid #d1d5db;border-radius:8px;padding:8px 12px;font-size:14px;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.warn{background:var(--danger);color:#fff;border-color:var(--danger)}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #e5e7eb;padding:8px;font-size:14px;text-align:center}
thead th{background:#f1f5f9}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:.25s}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ“ PingPong Club ê´€ë¦¬ì</h1>

  <!-- ì œëª© ìˆ˜ì • -->
  <section class="card">
    <h3>ì‚¬ì´íŠ¸ ì œëª© ìˆ˜ì •</h3>
    <div class="row">
      <input id="titleInput" type="text" placeholder="ì˜ˆ: KOEN íƒêµ¬ ì›”ê°„ë¦¬ê·¸" style="flex:1;padding:6px 8px"/>
      <button id="saveTitle" class="btn primary">ì €ì¥</button>
    </div>
  </section>

  <!-- ë³µì‹ê°€ì¤‘ì¹˜ / ë¹„ë°€ë²ˆí˜¸ -->
  <section class="card">
    <h3>ê¸°ë³¸ ì„¤ì •</h3>
    <div class="row">
      <label>ë³µì‹ ê°€ì¤‘ì¹˜ <input id="doubleWeight" type="number" min="0" max="1" step="0.1" style="width:80px"/></label>
      <button id="saveDouble" class="btn primary">ì €ì¥</button>
    </div>
    <div class="row" style="margin-top:8px">
      <label>ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ <input id="delPw" type="text" placeholder="ì˜ˆ: 7910"/></label>
      <button id="saveDelPw" class="btn primary">ì €ì¥</button>
    </div>
    <div class="row" style="margin-top:8px">
      <label>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ <input id="adminPw" type="text" placeholder="ì˜ˆ: 771225"/></label>
      <button id="saveAdminPw" class="btn primary">ì €ì¥</button>
    </div>
  </section>

  <!-- ì„ ìˆ˜ ì¶”ê°€/ê´€ë¦¬ -->
  <section class="card">
    <h3>ì„ ìˆ˜ ê´€ë¦¬</h3>
    <div class="row">
      <input id="playerName" type="text" placeholder="ì´ë¦„" />
      <input id="playerLevel" type="number" min="1" max="20" placeholder="ë¶€ìˆ˜" />
      <button id="addPlayer" class="btn primary">ë“±ë¡</button>
    </div>
    <table style="margin-top:10px">
      <thead><tr><th>ì´ë¦„</th><th>ë¶€ìˆ˜</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
      <tbody id="playerTable"></tbody>
    </table>
  </section>

  <!-- ìˆ¨ê¹€ ì„ ìˆ˜ -->
  <section class="card">
    <h3>ìˆ¨ê¹€ ì„ ìˆ˜ ëª©ë¡</h3>
    <div class="row">
      <input id="hideName" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™"/>
      <button id="addHide" class="btn primary">ìˆ¨ê¹€ ì¶”ê°€</button>
    </div>
    <table style="margin-top:10px">
      <thead><tr><th>ì´ë¦„</th><th>ê´€ë¦¬</th></tr></thead>
      <tbody id="hideTable"></tbody>
    </table>
  </section>

  <!-- ë°ì´í„° ì´ˆê¸°í™” -->
  <section class="card">
    <h3>ë°ì´í„° ê´€ë¦¬</h3>
    <button id="clearAll" class="btn warn">âš ï¸ ëª¨ë“  ê²½ê¸° ê¸°ë¡ ì‚­ì œ</button>
  </section>
</div>
<div id="toast" class="toast">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, set, remove, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const $=(s,ctx=document)=>ctx.querySelector(s);
const toast=m=>{const t=$('#toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500);};

// ì œëª©
onValue(ref(db,'config/title'),s=>$('#titleInput').value=s.val()||'');
$('#saveTitle').onclick=async()=>{await set(ref(db,'config/title'),$('#titleInput').value.trim());toast('ì œëª© ì €ì¥');};

// ê°€ì¤‘ì¹˜
onValue(ref(db,'config/doubleWeight'),s=>$('#doubleWeight').value=s.val()??0.5);
$('#saveDouble').onclick=async()=>{await set(ref(db,'config/doubleWeight'),parseFloat($('#doubleWeight').value)||0.5);toast('ë³µì‹ ê°€ì¤‘ì¹˜ ì €ì¥');};

// ì‚­ì œ PW
onValue(ref(db,'config/deletePassword'),s=>$('#delPw').value=s.val()||'');
$('#saveDelPw').onclick=async()=>{await set(ref(db,'config/deletePassword'),$('#delPw').value.trim());toast('ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥');};

// ê´€ë¦¬ì PW
onValue(ref(db,'config/adminPassword'),s=>$('#adminPw').value=s.val()||'');
$('#saveAdminPw').onclick=async()=>{await set(ref(db,'config/adminPassword'),$('#adminPw').value.trim());toast('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì €ì¥');};

// ì„ ìˆ˜ ëª©ë¡
const playerRef=ref(db,'players');
let players={};
onValue(playerRef,s=>{
  players=s.val()||{};
  const tbody=$('#playerTable');tbody.innerHTML='';
  Object.entries(players).forEach(([key,p])=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td><td>${p.level}</td><td>${p.hidden?'ìˆ¨ê¹€':'í™œì„±'}</td>
    <td>
    ${p.hidden?`<button class="btn ok" onclick="unhide('${key}')">ë³µêµ¬</button>`:`<button class="btn" onclick="hide('${key}')">ìˆ¨ê¹€</button>`}
    <button class="btn warn" onclick="del('${key}')">ì‚­ì œ</button></td>`;
    tbody.appendChild(tr);
  });
});
window.hide=async(k)=>{await set(ref(db,'players/'+k+'/hidden'),true);toast('ìˆ¨ê¹€ì²˜ë¦¬');};
window.unhide=async(k)=>{await set(ref(db,'players/'+k+'/hidden'),false);toast('ë³µêµ¬ì™„ë£Œ');};
window.del=async(k)=>{if(confirm('ì •ë§ ì‚­ì œí•©ë‹ˆê¹Œ?')){await remove(ref(db,'players/'+k));toast('ì‚­ì œì™„ë£Œ');}};

// ì„ ìˆ˜ ì¶”ê°€
$('#addPlayer').onclick=async()=>{
  const n=$('#playerName').value.trim(), lv=parseInt($('#playerLevel').value)||0;
  if(!n){toast('ì´ë¦„ì…ë ¥');return;}
  const newRef=ref(db,'players/'+Date.now());
  await set(newRef,{name:n,level:lv,hidden:false,joinedAt:Date.now()});
  $('#playerName').value='';$('#playerLevel').value='';toast('ë“±ë¡ì™„ë£Œ');
};

// ìˆ¨ê¹€ ëª©ë¡
const hideRef=ref(db,'hiddenPlayers');
let hidden=[];
onValue(hideRef,s=>{hidden=s.val()||[];renderHidden();});
function renderHidden(){
  const t=$('#hideTable');t.innerHTML='';
  hidden.forEach((n,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${n}</td><td><button class="btn ok" onclick="recover(${i})">ë³µêµ¬</button></td>`;
    t.appendChild(tr);
  });
}
$('#addHide').onclick=async()=>{
  const n=$('#hideName').value.trim();
  if(!n){toast('ì´ë¦„ì…ë ¥');return;}
  if(hidden.includes(n)){toast('ì´ë¯¸ ìˆìŒ');return;}
  hidden.push(n);await set(hideRef,hidden);$('#hideName').value='';toast('ìˆ¨ê¹€ ì¶”ê°€');
};
window.recover=async(i)=>{hidden.splice(i,1);await set(hideRef,hidden);toast('ë³µêµ¬ì™„ë£Œ');};

// ê²½ê¸° ì „ì²´ ì‚­ì œ
$('#clearAll').onclick=async()=>{
  if(confirm('ëª¨ë“  ê²½ê¸° ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆê¹Œ?')){await remove(ref(db,'matches'));toast('ê¸°ë¡ ì „ì²´ ì‚­ì œë¨');}
};

// 60ì¼ ìë™ì‚­ì œ
async function autoCleanup(){
  const snap=await get(playerRef);
  const list=snap.val()||{};
  const now=Date.now();
  for(const [k,v] of Object.entries(list)){
    if(v.hidden && now-(v.joinedAt||0)>60*24*60*60*1000){
      await remove(ref(db,'players/'+k));
    }
  }
}
autoCleanup();
</script>
</body>
</html>
