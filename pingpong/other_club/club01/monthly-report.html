<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>월간리포트</title>
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:#f5f7fb;color:#0f172a}
h1{text-align:center;color:#0d47a1}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #e5e7eb;padding:6px;font-size:14px;text-align:center}
thead{background:#f1f5f9}
</style>
</head>
<body>
<h1 id="siteTitle">탁구 월간리그</h1>
<div style="text-align:center">
  <button onclick="location.href='index.html'">🎮 경기입력</button>

  <button onclick="location.href='admin.html'">⚙ 관리자</button>
</div>
<table style="margin-top:10px">
<thead><tr><th>이름</th><th>경기수</th><th>승</th><th>패</th><th>승률</th></tr></thead>
<tbody id="tbody"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
const firebaseConfig={
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const $=(s)=>document.querySelector(s);

onValue(ref(db,'config/title'),s=>$('#siteTitle').textContent=s.val()||'탁구 월간리그');

onValue(ref(db,'matches'),snap=>{
  const all=snap.val()||{};
  const stats={};
  Object.values(all).forEach(m=>{
    const monthKey=m.monthKey;
    const now=new Date();
    const curKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
    if(monthKey!==curKey)return;
    const A=m.namesA[0],B=m.namesB[0],winA=m.winnerSide==='A';
    [A,B].forEach(n=>{if(!stats[n])stats[n]={g:0,w:0,l:0};});
    stats[A].g++;stats[B].g++;
    if(winA){stats[A].w++;stats[B].l++;}else{stats[B].w++;stats[A].l++;}
  });
  const arr=Object.entries(stats).map(([n,v])=>({...v,name:n,rate:v.g?(v.w/v.g):0}));
  arr.sort((a,b)=>b.rate-a.rate);
  const tbody=$('#tbody');tbody.innerHTML='';
  arr.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.name}</td><td>${r.g}</td><td>${r.w}</td><td>${r.l}</td><td>${(r.rate*100).toFixed(1)}%</td>`;
    tbody.appendChild(tr);
  });
});
</script>
</body>
</html>
