<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title id="pageTitle">🏓 경기결과 입력</title>
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;background:#f5f7fb;color:#0f172a}
h1{text-align:center;color:#0d47a1}
.chip{border:1px solid #ccc;border-radius:16px;padding:6px 12px;margin:4px;cursor:pointer;background:#fff}
.chip.selected{background:#dbeafe;border-color:#2563eb}
.btn{border:1px solid #ccc;padding:8px 12px;border-radius:8px;margin:4px;cursor:pointer}
.btn.ok{background:#16a34a;color:#fff}
.btn.warn{background:#ef4444;color:#fff}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:#111827;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:.25s}
.toast.show{opacity:1}
</style>
</head>
<body>
<h1 id="siteTitle">🏓 경기결과 입력</h1>
<div style="text-align:center">
  <button class="btn" onclick="location.href='admin.html'">⚙ 관리자</button>
  <button class="btn" onclick="location.href='monthly-report.html'">📊 리포트</button>
</div>
<div id="chips" style="display:flex;flex-wrap:wrap;justify-content:center;margin-top:10px"></div>
<div style="text-align:center;margin-top:8px">
  <button id="clearSel" class="btn">선택 초기화</button>
</div>
<div style="text-align:center;margin-top:12px">
  <button id="winA" class="btn ok">승자: A팀</button>
  <button id="winB" class="btn warn">승자: B팀</button>
</div>
<div id="toast" class="toast">저장됨</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
const firebaseConfig={
  apiKey:"AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain:"pingpongclub-4a5fd.firebaseapp.com",
  databaseURL:"https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId:"pingpongclub-4a5fd",
  storageBucket:"pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId:"802826774007",
  appId:"1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const $=(s)=>document.querySelector(s);
const toast=(m)=>{const t=$('#toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500);};

let players=[],hidden=[],sel=[];
onValue(ref(db,'config/title'),s=>{const t=s.val()||'PingPong League';$('#siteTitle').textContent=t;document.title=t;});
onValue(ref(db,'players'),s=>{players=Object.values(s.val()||{}).filter(p=>!p.hidden);render();});
onValue(ref(db,'hiddenPlayers'),s=>{hidden=s.val()||[];render();});

function render(){
  const box=$('#chips');box.innerHTML='';
  players.filter(p=>!hidden.includes(p.name)).forEach(p=>{
    const b=document.createElement('div');
    b.className='chip'+(sel.includes(p.name)?' selected':'');
    b.textContent=`${p.name}(${p.level})`;
    b.onclick=()=>{const i=sel.indexOf(p.name);if(i>=0)sel.splice(i,1);else if(sel.length<2)sel.push(p.name);render();};
    box.appendChild(b);
  });
}
$('#clearSel').onclick=()=>{sel=[];render();};

async function save(side){
  if(sel.length!==2){toast('2명 선택');return;}
  const now=new Date();
  const monthKey=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  const match={namesA:[sel[0]],namesB:[sel[1]],winnerSide:side,monthKey,ts:Date.now()};
  await push(ref(db,'matches'),match);
  toast('저장완료');sel=[];render();
}
$('#winA').onclick=()=>save('A');
$('#winB').onclick=()=>save('B');
</script>
</body>
</html>
