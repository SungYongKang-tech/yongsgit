<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ“ ê²½ê¸° ê²°ê³¼ ì…ë ¥</title>
<style>
:root{
  --ink:#0f172a; --muted:#64748b; --bg:#f5f7fb;
  --primary:#0d47a1; --accent:#2563eb; --ok:#16a34a; --danger:#ef4444;
}
body{margin:0;font-family:system-ui,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--ink)}
.wrap{max-width:720px;margin:0 auto;padding:20px}
h1{text-align:center;color:var(--primary)}
.section{margin-top:16px;background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.05);padding:14px}
.players{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.player{border:1px solid #d1d5db;padding:6px 10px;border-radius:8px;background:#fff;cursor:pointer;transition:.2s}
.player.selectedA{background:#bfdbfe;border-color:#2563eb;font-weight:600}
.player.selectedB{background:#fecaca;border-color:#dc2626;font-weight:600}
.btn{border:1px solid #ccc;border-radius:6px;padding:8px 12px;font-size:14px;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.ok{background:var(--ok);color:#fff;border-color:var(--ok)}
.btn.warn{background:var(--danger);color:#fff;border-color:var(--danger)}
.mode-btn{padding:6px 12px;border-radius:6px;border:1px solid #ccc;background:#fff;cursor:pointer}
.mode-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
background:#111827;color:#fff;padding:8px 12px;border-radius:10px;opacity:0;transition:.25s}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ“ ê²½ê¸° ê²°ê³¼ ì…ë ¥</h1>

  <div class="section" style="text-align:center">
    <button id="modeSingle" class="mode-btn active">ë‹¨ì‹</button>
    <button id="modeDouble" class="mode-btn">ë³µì‹</button>
  </div>

  <div class="section">
    <h3>ì„ ìˆ˜ ì„ íƒ</h3>
    <div class="players" id="playerArea">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <div class="section">
    <h3>ê²°ê³¼ ì…ë ¥</h3>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="winA" class="btn ok">AíŒ€ ìŠ¹</button>
      <button id="winB" class="btn warn">BíŒ€ ìŠ¹</button>
      <button id="reset" class="btn">ì„ íƒ ì´ˆê¸°í™”</button>
    </div>
    <small style="color:var(--muted)">ë‹¨ì‹: ì„ ìˆ˜ 2ëª… ì„ íƒ í›„ ìŠ¹ì í´ë¦­<br>ë³µì‹: ì„ ìˆ˜ 4ëª… ì„ íƒ í›„ ìŠ¹ë¦¬íŒ€ í´ë¦­</small>
  </div>
</div>

<div id="toast" class="toast">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* ===== Firebase ì„¤ì • ===== */
const firebaseConfig = {
  apiKey: "AIzaSyArRznuWhfuiOA1vFtwlArMCLsAdTz6XHo",
  authDomain: "pingpongclub-4a5fd.firebaseapp.com",
  databaseURL: "https://pingpongclub-4a5fd-default-rtdb.firebaseio.com",
  projectId: "pingpongclub-4a5fd",
  storageBucket: "pingpongclub-4a5fd.firebasestorage.app",
  messagingSenderId: "802826774007",
  appId: "1:802826774007:web:ca4d05be778eeaf1723af2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== UI / ê³µí†µ ===== */
const toast = (msg="ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤")=>{
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),1500);
};

let mode="single"; // ê¸°ë³¸ ë‹¨ì‹
document.getElementById("modeSingle").onclick=()=>setMode("single");
document.getElementById("modeDouble").onclick=()=>setMode("double");
function setMode(m){
  mode=m;
  document.getElementById("modeSingle").classList.toggle("active",m==="single");
  document.getElementById("modeDouble").classList.toggle("active",m==="double");
  resetSelection();
}

/* ===== ì„ ìˆ˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ===== */
const playerArea=document.getElementById("playerArea");
let players=[];
onValue(ref(db,"players"),(snap)=>{
  const data=snap.val()||{};
  players = Object.entries(data)
    .filter(([id,p])=>!p.hidden)
    .map(([id,p])=>({id,...p}))
    .sort((a,b)=>(a.level-b.level)||a.name.localeCompare(b.name,"ko"));
  renderPlayers();
});

let selectedA=[], selectedB=[];
function renderPlayers(){
  playerArea.innerHTML="";
  if(players.length===0){playerArea.textContent="ë“±ë¡ëœ ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.";return;}
  players.forEach(p=>{
    const div=document.createElement("div");
    div.className="player";
    div.textContent=`${p.name}(${p.level})`;
    div.onclick=()=>selectPlayer(p.id);
    playerArea.appendChild(div);
  });
  updateSelection();
}

function selectPlayer(id){
  // í´ë¦­ ìˆœì„œì— ë”°ë¼ AíŒ€/BíŒ€ ìë™ ë¶„ë°°
  if(selectedA.includes(id)) selectedA=selectedA.filter(x=>x!==id);
  else if(selectedB.includes(id)) selectedB=selectedB.filter(x=>x!==id);
  else {
    if(selectedA.length<=selectedB.length) selectedA.push(id);
    else selectedB.push(id);
  }
  updateSelection();
}

function updateSelection(){
  const divs=document.querySelectorAll(".player");
  divs.forEach((d,i)=>{
    const pid=players[i].id;
    d.classList.remove("selectedA","selectedB");
    if(selectedA.includes(pid)) d.classList.add("selectedA");
    if(selectedB.includes(pid)) d.classList.add("selectedB");
  });
}

/* ===== ì´ˆê¸°í™” ===== */
document.getElementById("reset").onclick=resetSelection;
function resetSelection(){
  selectedA=[]; selectedB=[];
  updateSelection();
}

/* ===== ê²½ê¸° ì €ì¥ ===== */
document.getElementById("winA").onclick=()=>saveMatch("A");
document.getElementById("winB").onclick=()=>saveMatch("B");

async function saveMatch(winnerSide){
  // ëª¨ë“œë³„ ìµœì†Œ ì¸ì› ì²´í¬
  if(mode==="single"){
    if(selectedA.length!==1 || selectedB.length!==1){
      toast("ë‹¨ì‹ì€ ì„ ìˆ˜ 1ëª…ì”© ì„ íƒí•˜ì„¸ìš”.");return;
    }
  }else{
    if(selectedA.length!==2 || selectedB.length!==2){
      toast("ë³µì‹ì€ ì„ ìˆ˜ 2ëª…ì”© ì„ íƒí•˜ì„¸ìš”.");return;
    }
  }

  const newRef=push(ref(db,"matches"));
  await set(newRef,{
    mode,          // single or double
    membersA:selectedA,
    membersB:selectedB,
    winnerSide,
    createdAt:Date.now()
  });

  toast(`${mode==="single"?"ë‹¨ì‹":"ë³µì‹"} ê²½ê¸° ì €ì¥ ì™„ë£Œ (${winnerSide}íŒ€ ìŠ¹)`);
  resetSelection();
}
</script>
</body>
</html>
