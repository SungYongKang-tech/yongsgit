<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>협력업체 신규 작업자 안전교육 시험</title>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #eef3f7;
      margin: 0; padding: 20px;
    }
    .quiz-container {
      max-width: 650px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.9rem;
      text-align: center;
      margin-bottom: 30px;
      color: #1a237e;
    }
    .question { font-size: 1.25rem; font-weight: bold; margin-bottom: 20px; }
    .options { list-style: none; padding: 0; }
    .options li { margin: 10px 0; }
    button {
      padding: 12px;
      width: 100%;
      font-size: 1rem;
      background: #1976d2;
      color:#fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { background:#0d47a1; }
    .feedback { margin-top: 15px; font-size:1rem; font-weight:bold; text-align:center; }
    .correct { color:#2e7d32; }
    .incorrect { color:#c62828; }
    #result { text-align:center; margin-top:40px; display:none; }
    #score-display { font-size: 2rem; font-weight:bold; color:#1a237e; }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 20px;
    }
    .nav-buttons button {
      flex: 1;
      background: #607d8b;
    }
    .nav-buttons button:hover {
      background: #455a64;
    }
  </style>
</head>
<body>

<div class="quiz-container">
  
  <div id="name-input-section">
    <h1>협력업체 신규 작업자 안전교육 시험</h1>
    <p style="text-align:center;">이름을 입력해 주세요</p>
    <center><input type="text" id="username" placeholder="이름 입력" 
      style="padding:10px; width:80%; max-width:300px; border-radius:8px; border:1px solid #ccc;"></center>
    <br>
    <button onclick="startQuiz()">시험 시작</button>
  </div>

  <div id="question-box" style="display:none;">
    <div class="question" id="question"></div>
    <ul class="options" id="options"></ul>
    <div id="feedback" class="feedback"></div>

    <div class="nav-buttons">
      <button onclick="prevQuestion()">← 이전 문제</button>
      <button onclick="nextQuestion()">다음 문제 →</button>
    </div>
  </div>

  <div id="result">
    <p id="score-display"></p>
    <p id="pass-message" style="font-size:1.3rem; margin-top:10px"></p>
    <button onclick="retryQuiz()" id="retry-btn" style="display:none;">다시 풀기</button>
  </div>

</div>

<script>
let allQuestions = [];
let quizSet = [];
let current = 0;
let score = 0;
let userName = "";
let answered = {}; // 각 문제의 정답 여부 저장

async function loadAllQuestions() {
  const files = [
    "./questions_part1.json",
    "./questions_part2.json",
    "./questions_part3.json",
    "./questions_part4.json"
  ];

  let list = [];
  for (let f of files) {
    const res = await fetch(f);
    const data = await res.json();
    list = list.concat(data);
  }
  return list;
}

function pickRandom20(list) {
  return list.sort(() => Math.random() - 0.5).slice(0, 20);
}

function startQuiz() {
  userName = document.getElementById("username").value.trim();
  if (!userName) {
    alert("이름을 입력해 주세요.");
    return;
  }

  document.getElementById("name-input-section").style.display = "none";
  document.getElementById("question-box").style.display = "block";

  loadAllQuestions().then(data => {
    allQuestions = data;
    quizSet = pickRandom20(allQuestions);
    current = 0;
    score = 0;
    answered = {};
    loadQuestion();
  });
}

function loadQuestion() {
  const q = quizSet[current];
  document.getElementById("feedback").textContent = "";
  document.getElementById("question").textContent = `${current + 1}. ${q.question}`;

  const op = document.getElementById("options");
  op.innerHTML = "";

  q.options.forEach((o, idx) => {
    const li = document.createElement("li");
    const btn = document.createElement("button");
    btn.textContent = o;
    btn.onclick = () => checkAnswer(idx, btn);
    li.appendChild(btn);
    op.appendChild(li);
  });

  // 이전에 이미 푼 문제면 피드백 표시
  if (answered[current] !== undefined) {
    const feedback = document.getElementById("feedback");
    if (answered[current]) {
      feedback.textContent = "이미 정답을 맞춘 문제입니다 ✅";
      feedback.className = "feedback correct";
    } else {
      feedback.textContent = "이전에 오답이었던 문제입니다 ❌";
      feedback.className = "feedback incorrect";
    }
  }
}

function checkAnswer(idx, btn) {
  const q = quizSet[current];
  const feedback = document.getElementById("feedback");

  if (answered[current] !== undefined) return; // 이미 선택했으면 무시

  if (idx === q.answer) {
    score += 5;
    answered[current] = true;
    feedback.textContent = "정답입니다 ✅";
    feedback.className = "feedback correct";
  } else {
    answered[current] = false;
    feedback.textContent = "오답입니다 ❌";
    feedback.className = "feedback incorrect";
  }
}

function nextQuestion() {
  if (current < quizSet.length - 1) {
    current++;
    loadQuestion();
  } else {
    showResult();
  }
}

function prevQuestion() {
  if (current > 0) {
    current--;
    loadQuestion();
  }
}

function showResult() {
  document.getElementById("question-box").style.display = "none";
  
  const result = document.getElementById("result");
  result.style.display = "block";

  document.getElementById("score-display").textContent = `${userName}님의 점수: ${score}점`;

  const passMsg = document.getElementById("pass-message");
  const retryBtn = document.getElementById("retry-btn");

  if (score >= 80) {
    passMsg.textContent = `${userName}님 합격하셨습니다 ✅`;
    retryBtn.style.display = "none";
  } else {
    passMsg.textContent = `불합격입니다. 다시 시험을 보셔야 합니다.`;
    retryBtn.style.display = "block";
  }
}

function retryQuiz() {
  document.getElementById("result").style.display = "none";
  document.getElementById("question-box").style.display = "block";

  quizSet = pickRandom20(allQuestions);
  current = 0;
  score = 0;
  answered = {};
  loadQuestion();
}
</script>

</body>
</html>
