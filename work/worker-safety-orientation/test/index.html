<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í˜‘ë ¥ì—…ì²´ ì‹ ê·œ ì‘ì—…ì ì•ˆì „êµìœ¡ ì‹œí—˜</title>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #eef3f7;
      margin: 0; padding: 20px;
    }
    .quiz-container {
      max-width: 650px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.9rem;
      text-align: center;
      margin-bottom: 30px;
      color: #1a237e;
    }
    .question { font-size: 1.25rem; font-weight: bold; margin-bottom: 20px; }
    .options { list-style: none; padding: 0; }
    .options li { margin: 10px 0; }
    button {
      padding: 12px;
      width: 100%;
      font-size: 1rem;
      background: #1976d2;
      color:#fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { background:#0d47a1; }
    .feedback { margin-top: 15px; font-size:1rem; font-weight:bold; text-align:center; }
    .correct { color:#2e7d32; }
    .incorrect { color:#c62828; }
    #result { text-align:center; margin-top:40px; display:none; }
    #score-display { font-size: 2rem; font-weight:bold; color:#1a237e; }
    #final-100 {
      font-size: 3rem;
      font-weight: 900;
      color: #2e7d32;
      text-shadow: 0 0 10px rgba(46,125,50,0.3);
      animation: pop 1s ease;
    }
    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

<div class="quiz-container">
  
  <div id="name-input-section">
    <h1>í˜‘ë ¥ì—…ì²´ ì‹ ê·œ ì‘ì—…ì ì•ˆì „êµìœ¡ ì‹œí—˜</h1>
    <p style="text-align:center;">ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”</p>
    <center><input type="text" id="username" placeholder="ì´ë¦„ ì…ë ¥" 
      style="padding:10px; width:80%; max-width:300px; border-radius:8px; border:1px solid #ccc;"></center>
    <br>
    <button onclick="startQuiz()">ì‹œí—˜ ì‹œì‘</button>
  </div>

  <div id="question-box" style="display:none;">
    <div class="question" id="question"></div>
    <ul class="options" id="options"></ul>
    <div id="feedback" class="feedback"></div>
  </div>

  <div id="result">
    <p id="score-display"></p>
    <div id="final-100" style="display:none;">ğŸ¯ ìµœì¢… 100ì  ë‹¬ì„±!</div>
    <p id="pass-message" style="font-size:1.3rem; margin-top:10px"></p>
    <button onclick="retryQuiz()" id="retry-btn" style="display:none;">ì˜¤ë‹µ ë¬¸ì œ ì¬ì‹œí—˜</button>
  </div>

</div>


<script>
let allQuestions = [];
let quizSet = [];
let current = 0;
let score = 0;
let totalScore = 0;   // âœ… ì´ì  ëˆ„ì ìš©
let userName = "";
let wrongQuestions = []; // ì˜¤ë‹µ ì €ì¥ìš©
let isRetake = false; // ì¬ì‹œí—˜ ì—¬ë¶€

// âœ… JSON ë¡œë“œ
async function loadAllQuestions() {
  const files = [
    "./questions_part1.json",
    "./questions_part2.json",
    "./questions_part3.json",
    "./questions_part4.json"
  ];

  let list = [];
  for (let f of files) {
    const res = await fetch(f);
    const data = await res.json();
    list = list.concat(data);
  }
  return list;
}

function pickRandom20(list) {
  return list.sort(() => Math.random() - 0.5).slice(0, 20);
}

function startQuiz() {
  userName = document.getElementById("username").value.trim();
  if (!userName) {
    alert("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    return;
  }

  document.getElementById("name-input-section").style.display = "none";
  document.getElementById("question-box").style.display = "block";

  loadAllQuestions().then(data => {
    allQuestions = data;
    quizSet = pickRandom20(allQuestions);
    current = 0;
    score = 0;
    totalScore = 0;
    wrongQuestions = [];
    isRetake = false;
    loadQuestion();
  });
}

function loadQuestion() {
  const q = quizSet[current];
  document.getElementById("feedback").textContent = "";
  document.getElementById("question").textContent = `${current + 1}. ${q.question}`;

  const op = document.getElementById("options");
  op.innerHTML = "";

  q.options.forEach((o, idx) => {
    const li = document.createElement("li");
    const btn = document.createElement("button");
    btn.textContent = o;
    btn.onclick = () => checkAnswer(idx);
    li.appendChild(btn);
    op.appendChild(li);
  });
}

function checkAnswer(idx) {
  const q = quizSet[current];
  const feedback = document.getElementById("feedback");

  if (idx === q.answer) {
    score += 5;
    feedback.textContent = "ì •ë‹µì…ë‹ˆë‹¤ âœ…";
    feedback.className = "feedback correct";
  } else {
    feedback.textContent = "ì˜¤ë‹µì…ë‹ˆë‹¤ âŒ";
    feedback.className = "feedback incorrect";
    wrongQuestions.push(q);
  }

  setTimeout(() => {
    current++;
    if (current < quizSet.length) loadQuestion();
    else showResult();
  }, 700);
}

function showResult() {
  document.getElementById("question-box").style.display = "none";
  const result = document.getElementById("result");
  result.style.display = "block";

  // âœ… ì¬ì‹œí—˜ì´ë©´ ì´ì „ ì ìˆ˜ì™€ í•©ì‚°
  if (isRetake) totalScore += score;
  else totalScore = score;

  const passMsg = document.getElementById("pass-message");
  const retryBtn = document.getElementById("retry-btn");
  const final100 = document.getElementById("final-100");

  document.getElementById("score-display").textContent = `${userName}ë‹˜ì˜ ì´ì : ${totalScore}ì `;

  if (wrongQuestions.length === 0 && totalScore === 100) {
    // âœ… ëª¨ë“  ë¬¸ì œ ë§ì¶˜ ê²½ìš°
    final100.style.display = "block";
    passMsg.textContent = "ëª¨ë“  ë¬¸í•­ ì •ë‹µ! í›Œë¥­í•©ë‹ˆë‹¤ âœ…";
    retryBtn.style.display = "none";
  } else if (totalScore >= 80 && wrongQuestions.length === 0) {
    passMsg.textContent = `${userName}ë‹˜ í•©ê²©í•˜ì…¨ìŠµë‹ˆë‹¤ âœ…`;
    retryBtn.style.display = "none";
    final100.style.display = "none";
  } else if (wrongQuestions.length > 0) {
    passMsg.textContent = `ë¶ˆí•©ê²©ì…ë‹ˆë‹¤. ì˜¤ë‹µ ${wrongQuestions.length}ë¬¸í•­ â†’ ì¬ì‹œí—˜ ê°€ëŠ¥`;
    retryBtn.style.display = "block";
    final100.style.display = "none";
  } else {
    passMsg.textContent = `ë¶ˆí•©ê²©ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œí—˜ì„ ë³´ì…”ì•¼ í•©ë‹ˆë‹¤.`;
    retryBtn.style.display = "block";
    final100.style.display = "none";
  }
}

function retryQuiz() {
  if (wrongQuestions.length === 0) {
    alert("ì˜¤ë‹µì´ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ ë§Œì ì…ë‹ˆë‹¤!");
    return;
  }

  quizSet = [...wrongQuestions];
  current = 0;
  score = 0;
  wrongQuestions = [];
  isRetake = true;

  document.getElementById("result").style.display = "none";
  document.getElementById("question-box").style.display = "block";
  loadQuestion();
}
</script>

</body>
</html>
