<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Energy Insights</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2e; --text:#e8eefc; --muted:#a9b6d6;
      --line:#243252; --good:#24c37a; --bad:#ff5c7a; --warn:#ffcc00;
      --btn:#1b2a4a; --btn2:#203458;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background:linear-gradient(180deg,#081026 0%, #070b14 100%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(7,11,20,.75); backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .sub{margin-top:6px;color:var(--muted);font-size:13px;line-height:1.35}
    .grid{display:grid; gap:12px}
    .kpis{grid-template-columns: repeat(5, minmax(0, 1fr)); margin-top:14px}
    .card{
      background:rgba(17,26,46,.92);
      border:1px solid rgba(255,255,255,.07);
      border-radius:16px; padding:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .k{color:var(--muted);font-size:12px}
    .v{margin-top:8px;font-size:18px;font-weight:750}
    .tiny{margin-top:6px;color:var(--muted);font-size:12px}
    .row{display:grid; grid-template-columns: 1.2fr 1.8fr; gap:12px; margin-top:12px}
    .inputs{display:grid; gap:10px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input, select{
      width:100%; padding:10px 11px; border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(10,16,30,.75);
      color:var(--text);
      outline:none;
    }
    input::placeholder{color:rgba(169,182,214,.55)}
    .btns{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    button{
      border:1px solid rgba(255,255,255,.10);
      background:var(--btn); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:650;
    }
    button:hover{background:var(--btn2)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(10,16,30,.6);
      color:var(--muted); font-size:12px;
    }
    .status{font-weight:800}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .warn{color:var(--warn)}
    .coach{
      margin-top:10px; padding:12px; border-radius:14px;
      border:1px dashed rgba(255,255,255,.14);
      background:rgba(10,16,30,.55);
      color:var(--muted); font-size:13px; line-height:1.55
    }
    table{
      width:100%; border-collapse:collapse; margin-top:10px; overflow:hidden;
      border-radius:14px; border:1px solid rgba(255,255,255,.08);
    }
    th, td{
      padding:10px 10px; text-align:right;
      border-bottom:1px solid rgba(255,255,255,.07);
      font-size:13px;
    }
    th:first-child, td:first-child{text-align:center}
    th:nth-child(2), td:nth-child(2){text-align:center}
    th{
      color:var(--muted); font-weight:750;
      background:rgba(10,16,30,.55);
      position:sticky; top:64px;
    }
    tr:hover td{background:rgba(255,255,255,.03)}
    .tag{
      display:inline-flex; gap:6px; align-items:center;
      padding:4px 8px; border-radius:999px;
      font-size:12px; border:1px solid rgba(255,255,255,.10);
      color:var(--muted); background:rgba(10,16,30,.45);
    }
    @media (max-width: 980px){
      .kpis{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .row{grid-template-columns:1fr}
      th{top:120px}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Energy Insights</h1>
    <div class="sub">
      ë³¸ì‚¬(ì „ê¸°+ì—´)ë§Œ í‰ê°€ Â· ëª©í‘œ ì ˆê°ë¥  1% ê³ ì • Â· ì—´ ì˜ˆì¸¡ì€ 2025 ë™ì¼ì›” ìë™ ì ìš©<br/>
      í™˜ì‚°ê³„ìˆ˜: ì „ê¸°(MWh)Ã—0.229 + ì—´(Gcal)Ã—0.1 = TOE
    </div>

    <div class="grid kpis">
      <div class="card">
        <div class="k">ê¸°ì¤€(20~22 í‰ê· )</div>
        <div class="v" id="kpiBaseline">-</div>
        <div class="tiny">toe</div>
      </div>
      <div class="card">
        <div class="k">ë§Œì  ëª©í‘œ(âˆ’1%)</div>
        <div class="v" id="kpiTarget">-</div>
        <div class="tiny">toe ì´í•˜</div>
      </div>
      <div class="card">
        <div class="k">2026 ì˜ˆìƒ ì—°ê°„</div>
        <div class="v" id="kpiEstToe">-</div>
        <div class="tiny">toe (ì‹¤ì +ì˜ˆìƒ)</div>
      </div>
      <div class="card">
        <div class="k">ìµœì¢… ì ˆê°ë¥ (ì—°ë§ ì˜ˆìƒ)</div>
        <div class="v" id="kpiSaving">-</div>
        <div class="tiny">%</div>
      </div>
      <div class="card">
        <div class="k">íŒì •(ë§Œì )</div>
        <div class="v status" id="kpiPass">-</div>
        <div class="tiny">â‰¥ 1.00%</div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="row">
    <div class="card">
      <div class="pill">
        <span>ì…ë ¥ ëŒ€ìƒ:</span>
        <strong>2026ë…„ ë³¸ì‚¬</strong>
        <span style="opacity:.7">Â·</span>
        <span id="nowInfo"></span>
      </div>

      <div class="inputs" style="margin-top:12px">
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px">
          <div>
            <label>ì›” ì„ íƒ</label>
            <select id="selMonth"></select>
          </div>
          <div>
            <label>ì‹¤ì /ì˜ˆìƒ</label>
            <select id="selType">
              <option value="actual">ì‹¤ì (ê³ ì§€ì„œ í™•ì •)</option>
              <option value="forecast">ì˜ˆìƒ(íŒŒì›Œí”Œë˜ë„ˆ/ì¶”ì •)</option>
            </select>
          </div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px">
          <div>
            <label>ì „ê¸° (ë³¸ì‚¬, MWh)</label>
            <input id="inpElec" type="number" step="0.001" placeholder="ì˜ˆ: 305.129" />
            <div class="tiny" id="hintElec"></div>
          </div>
          <div>
            <label>ì—´ (ë³¸ì‚¬, Gcal)</label>
            <input id="inpHeat" type="number" step="0.1" placeholder="ì˜ˆ: 85.1" />
            <div class="tiny" id="hintHeat"></div>
          </div>
        </div>

        <div class="btns">
          <button id="btnAutoHeat">ì—´ ì˜ˆì¸¡ê°’ ìë™(2025 ë™ì¼ì›”)</button>
          <button id="btnAutoBoth">ì „ê¸°Â·ì—´ ê¸°ë³¸ì˜ˆì¸¡ ë¶ˆëŸ¬ì˜¤ê¸°(2025 ë™ì¼ì›”)</button>
          <button id="btnSave">ì €ì¥</button>
          <button id="btnClearMonth">ì´ ë‹¬ ì…ë ¥ ì‚­ì œ</button>
        </div>

        <div class="coach" id="coachBox">
          ë‹¤ìŒ ë‹¬ ê¶Œì¥ ì‚¬ìš©ëŸ‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤â€¦
        </div>
      </div>
    </div>

    <div class="card">
      <div class="pill">
        <span>2025 ê¸°ì¤€ íŒ¨í„´(ë‚´ì¥)</span>
        <span style="opacity:.7">Â·</span>
        <span class="tag">ì „ê¸°(ë³¸ì‚¬)</span>
        <span class="tag">ì—´(ë³¸ì‚¬)</span>
      </div>

      <div class="coach" style="margin-top:12px">
        <div style="color:var(--text);font-weight:750;margin-bottom:6px">ì‘ë™ ë°©ì‹</div>
        <div>
          â‘  2026ì— ì›”ë³„ ì‹¤ì ì„ ì…ë ¥í•˜ë©´ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.<br/>
          â‘¡ ì…ë ¥í•˜ì§€ ì•Šì€ ë‹¬ì€ <b>2025 ë™ì¼ì›”</b>ì„ ê¸°ë³¸ ì˜ˆì¸¡ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.<br/>
          â‘¢ ëª©í‘œ(ì—°ë§ 1% ì ˆê°) ë‹¬ì„±ì„ ìœ„í•´ ë‚¨ì€ ë‹¬ ëª©í‘œë¥¼ 2025 íŒ¨í„´ ë¹„ìœ¨ë¡œ ì¬ë°°ë¶„í•˜ê³ ,<br/>
          &nbsp;&nbsp;&nbsp;&nbsp;ê·¸ ê²°ê³¼ë¡œ <b>ë‹¤ìŒ ë‹¬ ì „ê¸°(MWh) ê¶Œì¥ ìƒí•œ</b>ì„ ì œì‹œí•©ë‹ˆë‹¤.<br/>
        </div>
      </div>

      <div class="btns" style="margin-top:12px">
        <button id="btnResetAll">2026 ë°ì´í„° ì „ì²´ ì´ˆê¸°í™”</button>
        <button id="btnExport">2026 ë°ì´í„° ë‚´ë³´ë‚´ê¸°(JSON)</button>
      </div>
      <pre id="exportBox" style="display:none;margin-top:10px;white-space:pre-wrap;background:rgba(10,16,30,.6);border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:12px;color:var(--muted);font-size:12px"></pre>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="pill">
      <span>2026 ì›”ë³„ í˜„í™©</span>
      <span style="opacity:.7">Â·</span>
      <span class="tag">ì‹¤ì ì€ actual</span>
      <span class="tag">ì˜ˆì¸¡ì€ forecast</span>
    </div>

    <table>
      <thead>
        <tr>
          <th>ì›”</th>
          <th>êµ¬ë¶„</th>
          <th>ì „ê¸°(MWh)</th>
          <th>ì—´(Gcal)</th>
          <th>ì›” TOE</th>
          <th>ëˆ„ê³„ TOE</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</main>

<script>
/* =========================
   ê³ ì •ê°’(í™•ì •)
========================= */
const BASELINE_TOE = 1065.772;               // 20~22 í‰ê· (ì´ë¯¸ í™•ì •)
const TARGET_TOE   = BASELINE_TOE * 0.99;    // 1% ì ˆê° ëª©í‘œ
const F_ELEC = 0.229;                        // toe/MWh
const F_HEAT = 0.1;                          // toe/Gcal

/* =========================
   2025 ê¸°ì¤€(ë³¸ì‚¬) ë‚´ì¥ ë°ì´í„°
   - ì „ê¸°: 12ì›” ë¯¸ë°œí–‰ â†’ 2024.12(300.766) ëŒ€ì²´ ì ìš©
   - ì—´: 12ì›” 59.6 ê³ ì§€ì„œ(í™•ì •)
========================= */
const Y2025 = {
  elec: [305.129,301.270,300.671,279.930,297.870,331.899,399.850,399.668,383.314,316.183,298.696,300.766],
  heat: [ 85.1, 104.8,  49.8,  15.7,  41.0, 109.4, 188.2, 179.5, 158.0,  34.2,  25.3,  59.6]
};

function toeOfMonth(elecMWh, heatGcal){
  return (elecMWh||0)*F_ELEC + (heatGcal||0)*F_HEAT;
}

/* 2025 ì›” TOE(íŒ¨í„´ ê°€ì¤‘ì¹˜ ê³„ì‚°ìš©) */
const toe25 = Array.from({length:12}, (_,i)=> toeOfMonth(Y2025.elec[i], Y2025.heat[i]));

/* =========================
   2026 ë°ì´í„° ì €ì¥(ë¡œì»¬)
========================= */
const LS_KEY = "energy_insights_2026_v1";

function default2026(){
  // ê¸°ë³¸: ê°’ì€ ë¹„ì›Œë‘ë˜, ì˜ˆì¸¡ í‘œì‹œë¥¼ ìœ„í•´ ë Œë”ë§ ì‹œ 2025 ë™ì¼ì›”ì„ ì‚¬ìš©
  return Array.from({length:12}, (_,i)=>({
    m:i+1,
    type:"forecast",         // ê¸°ë³¸ì€ forecast
    elec_mwh:null,           // ì…ë ¥ ì—†ìœ¼ë©´ null
    heat_gcal:null           // ì…ë ¥ ì—†ìœ¼ë©´ null (ì—´ì€ auto ë²„íŠ¼ìœ¼ë¡œ 2025 ë™ì¼ì›” ì ìš© ê°€ëŠ¥)
  }));
}

function load2026(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) return default2026();
  try{
    const parsed = JSON.parse(raw);
    if(!Array.isArray(parsed) || parsed.length !== 12) return default2026();
    return parsed.map((x,i)=>({
      m:i+1,
      type: (x.type==="actual"||x.type==="forecast") ? x.type : "forecast",
      elec_mwh: (x.elec_mwh===null || x.elec_mwh===undefined || x.elec_mwh==="") ? null : Number(x.elec_mwh),
      heat_gcal: (x.heat_gcal===null || x.heat_gcal===undefined || x.heat_gcal==="") ? null : Number(x.heat_gcal)
    }));
  }catch(e){
    return default2026();
  }
}

function save2026(data){
  localStorage.setItem(LS_KEY, JSON.stringify(data));
}

/* =========================
   UI helpers
========================= */
function fmt(n, digits=3){
  if(n===null || n===undefined || Number.isNaN(n)) return "-";
  const x = Number(n);
  return x.toLocaleString("en-US",{minimumFractionDigits:digits, maximumFractionDigits:digits});
}
function fmtPct(n){
  if(n===null || n===undefined || Number.isNaN(n)) return "-";
  return (Number(n)).toFixed(2);
}
function monthName(m){ return `${m}ì›”`; }

const el = (id)=>document.getElementById(id);

/* =========================
   ê³„ì‚°: 2026 ì˜ˆìƒ ì—°ê°„, ì ˆê°ë¥ , ì½”ì¹˜(ë‹¤ìŒë‹¬ ê¶Œì¥)
========================= */
function computeAll(data){
  // ê° ì›”ì— ëŒ€í•´ "ì‹¤ì œ ê³„ì‚°ì— ì“°ëŠ” ê°’" ê²°ì •:
  // - ì…ë ¥ê°’ ìˆìœ¼ë©´ ê·¸ ê°’
  // - ì—†ìœ¼ë©´ 2025 ë™ì¼ì›” ê¸°ë³¸ì˜ˆì¸¡ ì‚¬ìš© (ì „ê¸°/ì—´ ëª¨ë‘)
  const used = data.map((row,i)=>{
    const elec = (row.elec_mwh!=null) ? row.elec_mwh : Y2025.elec[i];
    const heat = (row.heat_gcal!=null) ? row.heat_gcal : Y2025.heat[i];
    const toe  = toeOfMonth(elec, heat);
    return { ...row, used_elec:elec, used_heat:heat, used_toe:toe };
  });

  const annualToeEst = used.reduce((s,r)=> s + r.used_toe, 0);
  const savingPctFinal = (BASELINE_TOE - annualToeEst) / BASELINE_TOE * 100;

  // ëˆ„ê³„ TOE(í‘œìš©)
  let cum = 0;
  const withCum = used.map(r=>{
    cum += r.used_toe;
    return {...r, cum_toe:cum};
  });

  return { withCum, annualToeEst, savingPctFinal };
}

function coachNextMonth(data, selectedMonth){
  // ëª©í‘œ: TARGET_TOE ì´í•˜ê°€ ë˜ë„ë¡ ë‚¨ì€ ë‹¬(ì„ íƒì›” í¬í•¨) ì˜ˆì‚° ë°°ë¶„
  // ì‹¤ì œ: ì´ë¯¸ "actual"ë¡œ í™•ì •ëœ ë‹¬ì€ ì‹¤ì  ì‚¬ìš©, ë‚˜ë¨¸ì§€ëŠ” ì¡°ì ˆëŒ€ìƒìœ¼ë¡œ ë³¸ë‹¤.
  const calc = computeAll(data);
  const used = calc.withCum;

  // actual ë‹¬ì€ ì…ë ¥ê°’ì´ ìˆì–´ì•¼ ì‹¤ì ìœ¼ë¡œ ì˜ë¯¸ê°€ ìˆìœ¼ë‹ˆ,
  // type=actual ì´ë”ë¼ë„ ê°’ì´ nullì´ë©´ ì‹¤ì œë¡œëŠ” ì˜ˆì¸¡ ì‚¬ìš© ì¤‘ â†’ ê·¸ ê²½ìš°ë„ ì¡°ì ˆ ëŒ€ìƒì— í¬í•¨
  const isLockedActual = (r)=> (r.type==="actual" && r.elec_mwh!=null && r.heat_gcal!=null);

  const locked = used.filter(isLockedActual);
  const toeLocked = locked.reduce((s,r)=> s + r.used_toe, 0);

  // ì¡°ì ˆ ëŒ€ìƒ ì›” = locked actual ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë‹¬
  const adjustable = used.filter(r=> !isLockedActual(r));

  const budgetRemain = TARGET_TOE - toeLocked;

  // ì´ë¯¸ lockedê°€ ëª©í‘œë¥¼ ì´ˆê³¼í•˜ë©´ ê²½ê³ 
  if(budgetRemain < 0){
    return {
      msg: `âš ï¸ ì´ë¯¸ í™•ì •ëœ ì‹¤ì (LOCK)ë§Œìœ¼ë¡œ ëª©í‘œ(ì—° 1% ì ˆê°)ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.\n` +
           `- í™•ì • ì‹¤ì  í•©ê³„: ${fmt(toeLocked,2)} toe\n` +
           `- ëª©í‘œ: ${fmt(TARGET_TOE,2)} toe\n` +
           `â†’ ë‚¨ì€ ë‹¬ì„ 0ìœ¼ë¡œ ì¡ì•„ë„ PASSê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ëª©í‘œ ì¬ì„¤ì • ë˜ëŠ” ìš´ì˜ì¡°ì¹˜ í•„ìš”)`
    };
  }

  // ë‚¨ì€ ë‹¬ ë°°ë¶„ ê°€ì¤‘ì¹˜: 2025 ì›” TOE ë¹„ìœ¨
  const sumW = adjustable.reduce((s,r)=> s + toe25[r.m-1], 0);
  const weights = adjustable.map(r=>({
    m:r.m,
    w: (sumW>0 ? toe25[r.m-1]/sumW : 1/adjustable.length)
  }));

  // ì„ íƒì›” "ë‹¤ìŒë‹¬" ê¶Œì¥ì¹˜ë¥¼ ë³´ì—¬ì£¼ê¸°
  const nextM = selectedMonth < 12 ? selectedMonth+1 : null;

  // nextMì´ ì¡°ì ˆëŒ€ìƒì— ì†í•˜ëŠ”ì§€ í™•ì¸
  if(nextM===null){
    return { msg:`12ì›”ì…ë‹ˆë‹¤. ì˜¬í•´ ë°ì´í„° í™•ì •/ì ê²€ë§Œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.\n(ì—°ë§ ì˜ˆìƒ ì ˆê°ë¥ ì€ ìƒë‹¨ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.)` };
  }

  // next month ëª©í‘œ TOE
  const wNext = weights.find(x=>x.m===nextM);
  // ë§Œì•½ nextMì´ locked actualì´ë©´ â€œì´ë¯¸ í™•ì •â€ ì•ˆë‚´
  const nextRow = used[nextM-1];
  if(isLockedActual(nextRow)){
    return { msg:`ë‹¤ìŒ ë‹¬(${nextM}ì›”)ì€ ì´ë¯¸ ì‹¤ì ìœ¼ë¡œ í™•ì •(LOCK)ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ë‹¬ ì…ë ¥/ì¡°ì ˆë¡œ ëª©í‘œë¥¼ ë§ì¶°ì£¼ì„¸ìš”.` };
  }

  const toeGoalNext = budgetRemain * (wNext ? wNext.w : 0);

  // ì—´ì€ 2025 ë™ì¼ì›”ì„ ê¸°ë³¸ ì˜ˆì¸¡ìœ¼ë¡œ ì‚¬ìš©(ì‚¬ìš©ìê°€ ì…ë ¥í•˜ë©´ ê·¸ ê°’)
  const heatNext = (nextRow.heat_gcal!=null) ? nextRow.heat_gcal : Y2025.heat[nextM-1];
  const heatToeNext = heatNext * F_HEAT;

  // ì „ê¸° ëª©í‘œ TOE = ì „ì²´ ëª©í‘œ TOE - ì—´ TOE
  const elecToeGoal = Math.max(0, toeGoalNext - heatToeNext);
  const elecMWhGoal = elecToeGoal / F_ELEC;

  // ì°¸ê³ : 2025 ë™ì¼ì›” ì „ê¸° ëŒ€ë¹„
  const elecRef = Y2025.elec[nextM-1];
  const deltaPct = (elecMWhGoal - elecRef) / elecRef * 100;

  const msg =
    `ğŸ“Œ ëª©í‘œ(ì—° 1% ì ˆê°) ë‹¬ì„±ì„ ìœ„í•œ â€œë‹¤ìŒ ë‹¬(${nextM}ì›”) ê¶Œì¥ ìƒí•œâ€\n` +
    `- ì—´(ê¸°ë³¸ì˜ˆì¸¡): ${fmt(heatNext,1)} Gcal â†’ ${fmt(heatToeNext,2)} toe\n` +
    `- ì „ê¸°(ê¶Œì¥): ${fmt(elecMWhGoal,3)} MWh ì´í•˜\n` +
    `- ì°¸ê³ : 2025ë…„ ${nextM}ì›” ì „ê¸° ${fmt(elecRef,3)} MWh ëŒ€ë¹„ ` +
    `${deltaPct>=0 ? "+" : ""}${deltaPct.toFixed(1)}%\n\n` +
    `â€» ê³„ì‚°ì›ë¦¬: í™•ì • ì‹¤ì (LOCK)ì„ ì œì™¸í•œ ë‚¨ì€ ë‹¬ì„ 2025 íŒ¨í„´ ë¹„ìœ¨ë¡œ ì¬ë°°ë¶„í•˜ì—¬, ì—°ê°„ ëª©í‘œ(â‰¤ ${fmt(TARGET_TOE,2)} toe)ë¥¼ ë§ì¶¥ë‹ˆë‹¤.`;

  return { msg };
}

/* =========================
   ë Œë”
========================= */
function render(){
  const data = load2026();
  const mSel = Number(el("selMonth").value || 1);

  // KPI
  el("kpiBaseline").textContent = fmt(BASELINE_TOE,3);
  el("kpiTarget").textContent   = fmt(TARGET_TOE,3);

  const calc = computeAll(data);
  const annualToeEst = calc.annualToeEst;
  const savingPct = calc.savingPctFinal;

  el("kpiEstToe").textContent = fmt(annualToeEst,2);
  el("kpiSaving").textContent = `${fmtPct(savingPct)}%`;

  const pass = savingPct >= 1.0;
  el("kpiPass").textContent = pass ? "PASS" : "FAIL";
  el("kpiPass").className = `v status ${pass ? "good" : "bad"}`;
  el("kpiSaving").className = `v ${pass ? "good" : "warn"}`;

  // now info
  const now = new Date();
  el("nowInfo").textContent = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}-${String(now.getDate()).padStart(2,"0")}`;

  // ì…ë ¥ì¹¸ ì±„ìš°ê¸°(ì„ íƒì›”)
  const row = data[mSel-1];
  el("selType").value = row.type;
  el("inpElec").value = (row.elec_mwh==null) ? "" : row.elec_mwh;
  el("inpHeat").value = (row.heat_gcal==null) ? "" : row.heat_gcal;

  el("hintElec").textContent = `ê¸°ë³¸ì˜ˆì¸¡(2025 ${mSel}ì›”): ${fmt(Y2025.elec[mSel-1],3)} MWh`;
  el("hintHeat").textContent = `ê¸°ë³¸ì˜ˆì¸¡(2025 ${mSel}ì›”): ${fmt(Y2025.heat[mSel-1],1)} Gcal`;

  // ì½”ì¹˜ ë°•ìŠ¤
  const coach = coachNextMonth(data, mSel);
  el("coachBox").textContent = coach.msg;

  // í…Œì´ë¸”
  const tbody = el("tbody");
  tbody.innerHTML = "";
  calc.withCum.forEach((r,i)=>{
    const tr = document.createElement("tr");
    const isActual = (r.type==="actual" && r.elec_mwh!=null && r.heat_gcal!=null);
    const typeLabel = isActual ? "actual" : "forecast";

    tr.innerHTML = `
      <td>${r.m}</td>
      <td><span class="tag">${typeLabel}</span></td>
      <td>${fmt(r.used_elec,3)}</td>
      <td>${fmt(r.used_heat,1)}</td>
      <td>${fmt(r.used_toe,2)}</td>
      <td>${fmt(r.cum_toe,2)}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* =========================
   ì´ë²¤íŠ¸ ë°”ì¸ë”©
========================= */
function init(){
  // month select
  const sel = el("selMonth");
  for(let m=1;m<=12;m++){
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = monthName(m);
    sel.appendChild(opt);
  }
  sel.value = String(new Date().getMonth()+1);

  sel.addEventListener("change", render);
  el("selType").addEventListener("change", render);

  el("btnAutoHeat").addEventListener("click", ()=>{
    const data = load2026();
    const m = Number(sel.value);
    data[m-1].heat_gcal = Y2025.heat[m-1];
    save2026(data);
    render();
  });

  el("btnAutoBoth").addEventListener("click", ()=>{
    const data = load2026();
    const m = Number(sel.value);
    data[m-1].elec_mwh = Y2025.elec[m-1];
    data[m-1].heat_gcal = Y2025.heat[m-1];
    save2026(data);
    render();
  });

  el("btnSave").addEventListener("click", ()=>{
    const data = load2026();
    const m = Number(sel.value);
    const elec = el("inpElec").value.trim();
    const heat = el("inpHeat").value.trim();

    data[m-1].type = el("selType").value;
    data[m-1].elec_mwh = (elec==="") ? null : Number(elec);
    data[m-1].heat_gcal = (heat==="") ? null : Number(heat);

    save2026(data);
    render();
  });

  el("btnClearMonth").addEventListener("click", ()=>{
    const data = load2026();
    const m = Number(sel.value);
    data[m-1].type = "forecast";
    data[m-1].elec_mwh = null;
    data[m-1].heat_gcal = null;
    save2026(data);
    render();
  });

  el("btnResetAll").addEventListener("click", ()=>{
    if(!confirm("2026 ì…ë ¥ ë°ì´í„°ë¥¼ ëª¨ë‘ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
    localStorage.removeItem(LS_KEY);
    render();
  });

  el("btnExport").addEventListener("click", ()=>{
    const box = el("exportBox");
    const data = load2026();
    box.style.display = (box.style.display==="none" ? "block" : "none");
    box.textContent = JSON.stringify({year:2026, data}, null, 2);
  });

  render();
}

init();
</script>
</body>
</html>
