<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>í•œêµ­ë‚¨ë™ë°œì „ ë‰´ìŠ¤ ëª¨ì•„ë³´ê¸°</title>

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --line:#e5e7eb;
      --ink:#0f172a;
      --muted:#64748b;
      --accent:#2563eb;
      --new:#f59e0b;
      --shadow:0 10px 30px rgba(0,0,0,.07);
      --chip:#f1f5f9;
      --groupbg:#ecfdf3;   /* ì˜…ì€ ì´ˆë¡ ë°°ê²½ */
      --groupline:#bbf7d0; /* ì˜…ì€ ì´ˆë¡ í…Œë‘ë¦¬ */

    }

    html, body { overflow-x: hidden; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    header{
      position:sticky;
      top:0;
      background:#fff;
      border-bottom:1px solid var(--line);
      padding:12px 14px;
      z-index:10;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    h1{
      font-size:16px;
      margin:0;
    }

    .topbar{
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:10px;
      padding:7px 10px;
      font-weight:700;
      cursor:pointer;
    }

    .btn.primary{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:12px;
      color:var(--muted);
    }

    .pill.new{
      border-color:var(--new);
      color:#b45309;
      background:#fff7ed;
    }

    main{
      max-width:980px;
      margin:0 auto;
      padding:12px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }

.card{
  background:var(--groupbg);               /* âœ… ë¬¶ìŒ ë°°ê²½(ì˜…ì€ ì´ˆë¡) */
  border:1px solid var(--groupline);       /* âœ… ë¬¶ìŒ í…Œë‘ë¦¬ */
  border-radius:18px;
  padding:14px;
}


.card.new{
  border-color:var(--new);
  box-shadow:var(--shadow);
  background:#fff7ed;   /* ìƒˆ ì´ìŠˆëŠ” ì£¼í™©í†¤ ë°°ê²½ìœ¼ë¡œ ë”°ë¡œ êµ¬ë¶„ */
}


    .title{
      font-size:16px;
      font-weight:900;
      margin:0 0 8px 0;
      line-height:1.35;
    }

    .meta{
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:6px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding:3px 8px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid #e2e8f0;
      font-size:12px;
      color:#334155;
    }

    .links{
      margin-top:10px;
      display:grid;
      gap:8px;
       background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.04);
    }

    /* í•µì‹¬: ëª¨ë°”ì¼ì—ì„œë„ ì ˆëŒ€ ì˜†ìœ¼ë¡œ ì•ˆ ë°€ë¦¬ê²Œ ì„¤ê³„ */
    .linkrow{
      display:grid;
      grid-template-columns: 72px 1fr;
      gap:6px 10px;
      align-items:start;
      padding:10px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
    }

    .src{
      font-weight:900;
      color:#334155;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .ttl{
      min-width:0;
    }

    .ttl a{
      display:block;
      word-break:break-word;
      overflow-wrap:anywhere;
      text-decoration:none;
      color:var(--accent);
    }

    .ttl a:hover{
      text-decoration:underline;
    }

    .when{
      grid-column:2 / 3;
      font-size:11px;
      color:var(--muted);
    }

    .small{
      font-size:12px;
      color:var(--muted);
    }

    /* ğŸ“± ëª¨ë°”ì¼ ì „ìš© ìµœì í™” */
    @media (max-width: 520px){
      header{padding:10px}
      main{padding:10px}
      .card{padding:12px}
      .title{font-size:15px}

      .linkrow{
        grid-template-columns:1fr; /* ì™„ì „ ì„¸ë¡œ ìŠ¤íƒ */
        gap:6px;
      }

      .src{white-space:normal}
      .when{grid-column:auto}
    }
  </style>
</head>

<body>
<header>
  <div class="row">
    <h1>í•œêµ­ë‚¨ë™ë°œì „ ë‰´ìŠ¤ (ê¸°ì‚¬ ë¬¶ìŒ)</h1>
    <div class="topbar">
      <span id="badge" class="pill new" style="display:none;"></span>
      <span id="counts" class="pill">-</span>
      <span id="updated" class="pill">ì—…ë°ì´íŠ¸: -</span>
      <button class="btn" id="reset">ì´ˆê¸°í™”</button>
      <button class="btn primary" id="refresh">ìƒˆë¡œê³ ì¹¨</button>
    </div>
  </div>
  <div class="small" style="margin-top:6px;">
    ê°™ì€ ë‚´ìš© ê¸°ì‚¬ëŠ” í•œ ì¹´ë“œë¡œ ë¬¶ê³ , ë§¤ì²´ë³„ ë§í¬ë¥¼ ëª¨ì•„ ë³´ì—¬ì¤ë‹ˆë‹¤.
  </div>
</header>

<main>
  <div id="status" class="small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
  <div id="list" class="grid" style="margin-top:10px;"></div>
</main>

<script>
const SEEN_KEY = "koen_news_seen_groups_v1";

const $status = document.getElementById("status");
const $list = document.getElementById("list");
const $badge = document.getElementById("badge");
const $updated = document.getElementById("updated");
const $counts = document.getElementById("counts");

const loadSeen = () => new Set(JSON.parse(localStorage.getItem(SEEN_KEY) || "[]"));
const saveSeen = (s) => localStorage.setItem(SEEN_KEY, JSON.stringify([...s]));

const fmt = (dateStr) => {
  try {
    const d = new Date(dateStr);
    if (isNaN(d)) return dateStr;

    const y = d.getFullYear();
    const m = d.getMonth() + 1;
    const day = d.getDate();
    const h = d.getHours();

    const week = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "][d.getDay()];

    return `${y}ë…„ ${m}ì›” ${day}ì¼(${week}) ${h}ì‹œ`;
  } catch {
    return dateStr;
  }
};


async function fetchNews(){
  $status.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
  $list.innerHTML = "";
  $badge.style.display = "none";

  const seen = loadSeen();
  const res = await fetch("/.netlify/functions/news",{cache:"no-store"});
  const data = await res.json();

  if(!data.groups){
    $status.textContent = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
    return;
  }

  $updated.textContent = "ì—…ë°ì´íŠ¸: " + fmt(data.fetchedAt);
  $counts.textContent = `ì›ë¬¸ ${data.rawCount}ê±´ Â· ë¬¶ìŒ ${data.groupCount}ê±´`;

  let newCount = 0;

  data.groups.forEach(g=>{
    const isNew = !seen.has(g.id);
    if(isNew) newCount++;

    const card = document.createElement("div");
    card.className = "card" + (isNew ? " new":"");

    const links = g.articles.map(a=>`
      <div class="linkrow">
        <div class="src">${a.source || "ë§í¬"}</div>
        <div class="ttl"><a href="${a.link}" target="_blank">${a.title}</a></div>
        <div class="when">${fmt(a.pubDate)}</div>
      </div>
    `).join("");

    card.innerHTML = `
      <div class="title">${g.title}</div>
      <div class="meta">
        ${isNew ? '<span class="pill new">ìƒˆ ì´ìŠˆ</span>' : ''}
        <span class="pill">${g.articles.length}ê°œ ê¸°ì‚¬</span>
      </div>
      <div class="links">${links}</div>
    `;

    $list.appendChild(card);
  });

  if(newCount>0){
    $badge.style.display="inline-flex";
    $badge.textContent = `ìƒˆ ì´ìŠˆ ${newCount}ê±´`;
  }

  data.groups.forEach(g=>seen.add(g.id));
  saveSeen(seen);

  $status.textContent = `ë¬¶ìŒ ${data.groupCount}ê±´ í‘œì‹œ`;
}

document.getElementById("refresh").onclick = fetchNews;
document.getElementById("reset").onclick = ()=>{
  localStorage.removeItem(SEEN_KEY);
  alert("ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
};

fetchNews();
</script>
</body>
</html>
