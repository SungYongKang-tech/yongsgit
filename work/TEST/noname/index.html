<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìƒìƒê²½ì˜ì²˜ ìµëª…ê²Œì‹œíŒ</title>
  <meta name="description" content="ìƒìƒê²½ì˜ì²˜ ìµëª… ì˜ê²¬/ì œì•ˆ ê²Œì‹œíŒ" />
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --accent:#2563eb;
      --danger:#ef4444;
      --ok:#16a34a;
      --shadow:0 10px 28px rgba(2,6,23,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(246,247,251,.9);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px;}
    .top{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:12px 0;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
    }
    .logo{
      width:40px; height:40px; border-radius:12px;
      background:linear-gradient(135deg, #1d4ed8, #60a5fa);
      box-shadow: var(--shadow);
    }
    h1{font-size:18px; margin:0; line-height:1.2}
    .sub{font-size:12px; color:var(--muted); margin-top:2px}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:var(--card);
      color:var(--muted);
      display:flex; gap:6px; align-items:center;
      white-space:nowrap;
    }
    main{padding:10px 0 28px}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px;}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr;} }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:15px;
    }
    .help{
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
      margin-top:8px;
    }

    textarea, input[type="text"]{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    textarea:focus, input[type="text"]:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(59,130,246,.15);
    }
    textarea{min-height:120px; resize:vertical}
    .row{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .count{font-size:12px; color:var(--muted)}
    .btns{display:flex; gap:8px; flex-wrap:wrap}
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      font-size:13px;
      cursor:pointer;
      font-weight:650;
    }
    .primary{background:var(--accent); color:white}
    .ghost{background:#f1f5f9; color:var(--ink)}
    .danger{background:#fee2e2; color:#991b1b}
    .primary:active, .ghost:active, .danger:active{transform:translateY(1px)}
    .toolbar{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .toolbar .spacer{flex:1}
    select{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      background:#fff;
      font-size:13px;
    }
    .list{display:flex; flex-direction:column; gap:10px;}
    .item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
    }
    .item.pinned{
      border-color:#93c5fd;
      background:linear-gradient(0deg, rgba(59,130,246,.06), rgba(59,130,246,.06)), #fff;
    }
    .meta{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:12px;
      margin-bottom:8px;
    }
    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      display:inline-flex; gap:6px; align-items:center;
    }
    .content{
      font-size:14px;
      line-height:1.55;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .actions{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .leftActions, .rightActions{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .mini{
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      background:#f1f5f9;
      color:var(--ink);
    }
    .mini.danger{background:#fee2e2; color:#991b1b}
    .mini.ok{background:#dcfce7; color:#166534}
    .mini.pin{background:#e0f2fe; color:#075985}
    .empty{
      text-align:center;
      color:var(--muted);
      padding:22px 10px;
      border:1px dashed var(--line);
      border-radius:14px;
      background:#fff;
    }
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:#0b1220; color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      opacity:0; pointer-events:none;
      transition:opacity .2s ease;
      box-shadow: var(--shadow);
    }
    .toast.show{opacity:1}
    .footerNote{
      font-size:12px; color:var(--muted);
      margin-top:10px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:11px;
      padding:2px 6px;
      border:1px solid var(--line);
      border-bottom-width:2px;
      border-radius:8px;
      background:#fff;
      color:var(--muted);
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ìƒìƒê²½ì˜ì²˜ ìµëª…ê²Œì‹œíŒ</h1>
          <div class="sub">ìµëª… ì˜ê²¬Â·ì œì•ˆÂ·ë¶ˆí¸ì‚¬í•­ì„ ë‚¨ê²¨ ì£¼ì„¸ìš”. (í˜„ì¬ ë²„ì „: ë‚´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥)</div>
        </div>
      </div>
      <div class="pill" title="í˜„ì¬ ì €ì¥ ë°©ì‹">
        ğŸ”’ LocalStorage ì €ì¥
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">
      <!-- ì‘ì„± ì¹´ë“œ -->
      <section class="card">
        <h2>ê¸€ ì‘ì„±</h2>

        <textarea id="inputText" maxlength="500" placeholder="ìµëª…ìœ¼ë¡œ ë‚¨ê¸¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. (ìµœëŒ€ 500ì)&#10;ì˜ˆ) ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ê°œì„  ì œì•ˆ, ë¶ˆí¸ì‚¬í•­, ì•„ì´ë””ì–´ ë“±"></textarea>

        <div class="row">
          <div class="count"><span id="count">0</span> / 500</div>
          <div class="btns">
            <button class="ghost" id="btnSample" type="button">ì˜ˆì‹œ ë„£ê¸°</button>
            <button class="ghost" id="btnClear" type="button">ì‘ì„± ì§€ìš°ê¸°</button>
            <button class="primary" id="btnPost" type="button">ë“±ë¡</button>
          </div>
        </div>

        <div class="help">
          âœ” íŒ: <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> ë¡œë„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
          âœ” ì§€ê¸ˆì€ â€œê°œì¸ ë¸Œë¼ìš°ì €â€ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ Firebaseë¥¼ ë¶™ì´ë©´ â€œëª¨ë‘ê°€ ê³µìœ í•˜ëŠ” ê²Œì‹œíŒâ€ì´ ë©ë‹ˆë‹¤.
        </div>
      </section>

      <!-- ì•ˆë‚´/ê´€ë¦¬ ì¹´ë“œ -->
      <aside class="card">
        <h2>ì•ˆë‚´</h2>
        <div class="help">
          - ë³¸ ê²Œì‹œíŒì€ ìµëª… ì˜ê²¬ ìˆ˜ë ´ì„ ìœ„í•œ êµìœ¡ìš© ì˜ˆì œì…ë‹ˆë‹¤.<br/>
          - ì‹¤ëª…/ê°œì¸ì •ë³´/ë¹„ë°©Â·ìš•ì„¤ì€ ì‚¼ê°€ì£¼ì„¸ìš”.<br/>
          - â€œì‹ ê³ â€ëŠ” í‘œì‹œë§Œ ì¦ê°€í•˜ë©°(êµìœ¡ìš©), ì‹¤ì œ ì°¨ë‹¨ ê¸°ëŠ¥ì€ Firebase ë‹¨ê³„ì—ì„œ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>

        <hr style="border:none;border-top:1px solid var(--line); margin:12px 0">

        <h2 style="margin-top:0">ë„êµ¬</h2>
        <div class="toolbar">
          <input id="search" type="text" placeholder="ê²€ìƒ‰ (í‚¤ì›Œë“œ)" />
          <div class="spacer"></div>
          <select id="sort">
            <option value="new">ìµœì‹ ìˆœ</option>
            <option value="popular">ê³µê°ìˆœ</option>
            <option value="reported">ì‹ ê³ ìˆœ</option>
            <option value="pinned">ê³ ì • ìš°ì„ </option>
          </select>
        </div>

        <div class="btns">
          <button class="ghost" id="btnExport" type="button">ë‚´ë³´ë‚´ê¸°(JSON)</button>
          <button class="ghost" id="btnImport" type="button">ê°€ì ¸ì˜¤ê¸°(JSON)</button>
          <button class="danger" id="btnWipe" type="button">ì „ì²´ ì‚­ì œ(ë‚´ ë¸Œë¼ìš°ì €)</button>
        </div>

        <div class="footerNote">
          â€» â€œê³ ì •/ì‚­ì œ/ì „ì²´ì‚­ì œâ€ëŠ” í˜„ì¬ ê¸°ê¸°(ë¸Œë¼ìš°ì €)ì—ì„œë§Œ ì ìš©ë©ë‹ˆë‹¤.
        </div>
      </aside>

      <!-- ëª©ë¡ ì¹´ë“œ -->
      <section class="card" style="grid-column: 1 / -1;">
        <h2 style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
          <span>ê²Œì‹œê¸€</span>
          <span class="pill" id="stats">0ê±´</span>
        </h2>

        <div id="list" class="list"></div>
      </section>
    </div>
  </div>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
  (function(){
    const KEY = "sangsaeng_board_v1";
    const input = document.getElementById("inputText");
    const count = document.getElementById("count");
    const listEl = document.getElementById("list");
    const searchEl = document.getElementById("search");
    const sortEl = document.getElementById("sort");
    const statsEl = document.getElementById("stats");
    const toastEl = document.getElementById("toast");

    const btnPost = document.getElementById("btnPost");
    const btnClear = document.getElementById("btnClear");
    const btnSample = document.getElementById("btnSample");
    const btnWipe = document.getElementById("btnWipe");
    const btnExport = document.getElementById("btnExport");
    const btnImport = document.getElementById("btnImport");

    function nowISO(){
      return new Date().toISOString();
    }
    function fmtKST(iso){
      const d = new Date(iso);
      // ì‚¬ìš©ìì˜ ë¡œì»¬ ì‹œê°„(í•œêµ­ì´ë©´ KST)
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const hh = String(d.getHours()).padStart(2,"0");
      const mi = String(d.getMinutes()).padStart(2,"0");
      return `${yyyy}.${mm}.${dd} ${hh}:${mi}`;
    }
    function uid(){
      // êµìœ¡ìš©: ì¶©ëŒ ê°€ëŠ¥ì„± ë‚®ì€ ê°„ë‹¨ ID
      return "p_" + Math.random().toString(36).slice(2,10) + Date.now().toString(36);
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      }catch(e){
        return [];
      }
    }
    function save(items){
      localStorage.setItem(KEY, JSON.stringify(items));
    }

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>toastEl.classList.remove("show"), 1600);
    }

    function sanitize(text){
      // ì•„ì£¼ ê¸°ë³¸ì ì¸ ì •ë¦¬(ê³µë°±/ì¤„ë°”ê¿ˆ)
      return (text || "").replace(/\r\n/g,"\n").trim();
    }

    function getFilteredSorted(items){
      const q = sanitize(searchEl.value).toLowerCase();
      let out = items;

      if(q){
        out = out.filter(p => (p.text || "").toLowerCase().includes(q));
      }

      const mode = sortEl.value;
      const copy = [...out];

      const pinFirst = (a,b) => (b.pinned?1:0) - (a.pinned?1:0);

      if(mode === "new"){
        copy.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
      } else if(mode === "popular"){
        copy.sort((a,b)=> (b.likes||0) - (a.likes||0) || (new Date(b.createdAt)-new Date(a.createdAt)));
      } else if(mode === "reported"){
        copy.sort((a,b)=> (b.reports||0) - (a.reports||0) || (new Date(b.createdAt)-new Date(a.createdAt)));
      } else if(mode === "pinned"){
        copy.sort((a,b)=> pinFirst(a,b) || (new Date(b.createdAt)-new Date(a.createdAt)));
      }

      // pinned ìš°ì„  ì˜µì…˜ì´ ì•„ë‹ˆì–´ë„, í•€ì€ ì‚´ì§ ìœ„ë¡œ ì˜¬ë ¤ì£¼ë©´ UXê°€ ì¢‹ìŒ
      copy.sort((a,b)=> pinFirst(a,b) || 0);

      return copy;
    }

    function render(){
      const items = load();
      const view = getFilteredSorted(items);

      statsEl.textContent = `${items.length}ê±´`;

      if(view.length === 0){
        listEl.innerHTML = `<div class="empty">í‘œì‹œí•  ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ìµëª…ìœ¼ë¡œ ê¸€ì„ ë“±ë¡í•´ë³´ì„¸ìš”.</div>`;
        return;
      }

      listEl.innerHTML = view.map(p => {
        const pinnedClass = p.pinned ? "pinned" : "";
        const pinTag = p.pinned ? `<span class="tag">ğŸ“Œ ê³ ì •</span>` : "";
        return `
          <article class="item ${pinnedClass}" data-id="${p.id}">
            <div class="meta">
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <span class="tag">ğŸ•’ ${fmtKST(p.createdAt)}</span>
                ${pinTag}
              </div>
              <div class="tag" title="êµìœ¡ìš© ìµëª… ID">ìµëª…#${String(p.id).slice(-4)}</div>
            </div>

            <div class="content">${escapeHtml(p.text)}</div>

            <div class="actions">
              <div class="leftActions">
                <button class="mini ok" data-act="like">ğŸ‘ ê³µê° <b>${p.likes||0}</b></button>
                <button class="mini danger" data-act="report">âš‘ ì‹ ê³  <b>${p.reports||0}</b></button>
                <button class="mini pin" data-act="pin">${p.pinned ? "ğŸ“Œ ê³ ì •í•´ì œ" : "ğŸ“Œ ê³ ì •"}</button>
              </div>
              <div class="rightActions">
                <button class="mini" data-act="copy">ğŸ“‹ ë³µì‚¬</button>
                <button class="mini danger" data-act="delete">ğŸ—‘ ì‚­ì œ</button>
              </div>
            </div>
          </article>
        `;
      }).join("");
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;")
        .replaceAll("\n","<br/>");
    }

    function updateCount(){
      count.textContent = input.value.length;
    }

    // ë“±ë¡
    btnPost.addEventListener("click", ()=>{
      const text = sanitize(input.value);
      if(!text){
        toast("ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        input.focus();
        return;
      }
      const items = load();
      const post = {
        id: uid(),
        text,
        createdAt: nowISO(),
        likes: 0,
        reports: 0,
        pinned: false
      };
      items.unshift(post);
      save(items);
      input.value = "";
      updateCount();
      render();
      toast("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // Ctrl+Enter ë“±ë¡
    input.addEventListener("keydown", (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
        e.preventDefault();
        btnPost.click();
      }
    });

    // ì‘ì„± ì§€ìš°ê¸°
    btnClear.addEventListener("click", ()=>{
      input.value = "";
      updateCount();
      toast("ì‘ì„± ë‚´ìš©ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.");
      input.focus();
    });

    // ì˜ˆì‹œ
    btnSample.addEventListener("click", ()=>{
      const samples = [
`ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ê°œì„  ì œì•ˆì…ë‹ˆë‹¤.
- í˜‘ë ¥ì‚¬ ì‘ì—… ìš”ì²­ì„œ ì–‘ì‹ì„ ê°„ì†Œí™”í•˜ê³ , í•„ìˆ˜ í•­ëª©ë§Œ ë‚¨ê¸°ë©´ ì‘ì„± ì‹œê°„ì´ ì¤„ì–´ë“¤ ê²ƒ ê°™ìŠµë‹ˆë‹¤.`,
`ì‚¬ë‚´ ì‹œìŠ¤í…œ ê´€ë ¨ ë¶ˆí¸ì‚¬í•­ì…ë‹ˆë‹¤.
- ê²°ì¬ í™”ë©´ì—ì„œ ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œê°€ ì¢…ì¢… ì‹¤íŒ¨í•©ë‹ˆë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ëª…í™•í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.`,
`ì•„ì´ë””ì–´ ì œì•ˆì…ë‹ˆë‹¤.
- ìƒìƒê²½ì˜ì²˜ì—ì„œ ì›” 1íšŒ 'í•œì¤„ ì•„ì´ë””ì–´'ë¥¼ ëª¨ì•„ ì‘ì€ ê°œì„ ë¶€í„° ì‹¤í–‰í•˜ë©´ ë¶„ìœ„ê¸°ê°€ ì¢‹ì•„ì§ˆ ê²ƒ ê°™ìŠµë‹ˆë‹¤.`
      ];
      input.value = samples[Math.floor(Math.random()*samples.length)];
      updateCount();
      input.focus();
      toast("ì˜ˆì‹œê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ì „ì²´ ì‚­ì œ
    btnWipe.addEventListener("click", ()=>{
      const ok = confirm("ë‚´ ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ê²Œì‹œê¸€ì„ ì „ë¶€ ì‚­ì œí• ê¹Œìš”?\n(ë‹¤ë¥¸ ì‚¬ëŒì—ê²ŒëŠ” ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤)");
      if(!ok) return;
      save([]);
      render();
      toast("ì „ì²´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    // ê²€ìƒ‰/ì •ë ¬
    searchEl.addEventListener("input", render);
    sortEl.addEventListener("change", render);

    // ëª©ë¡ ì•¡ì…˜(ê³µê°/ì‹ ê³ /í•€/ë³µì‚¬/ì‚­ì œ)
    listEl.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-act]");
      if(!btn) return;

      const act = btn.getAttribute("data-act");
      const itemEl = e.target.closest(".item");
      const id = itemEl?.getAttribute("data-id");
      if(!id) return;

      const items = load();
      const idx = items.findIndex(p => p.id === id);
      if(idx < 0) return;

      if(act === "like"){
        items[idx].likes = (items[idx].likes || 0) + 1;
        save(items);
        render();
        toast("ê³µê° +1");
      }
      if(act === "report"){
        items[idx].reports = (items[idx].reports || 0) + 1;
        save(items);
        render();
        toast("ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤(êµìœ¡ìš©).");
      }
      if(act === "pin"){
        items[idx].pinned = !items[idx].pinned;
        save(items);
        render();
        toast(items[idx].pinned ? "ê³ ì •í–ˆìŠµë‹ˆë‹¤." : "ê³ ì • í•´ì œí–ˆìŠµë‹ˆë‹¤.");
      }
      if(act === "copy"){
        const text = items[idx].text || "";
        navigator.clipboard?.writeText(text).then(()=>{
          toast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }).catch(()=>{
          toast("ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸).");
        });
      }
      if(act === "delete"){
        const ok = confirm("ì´ ê¸€ì„ ì‚­ì œí• ê¹Œìš”?\n(ë‚´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‚­ì œë©ë‹ˆë‹¤)");
        if(!ok) return;
        items.splice(idx,1);
        save(items);
        render();
        toast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    });

    // JSON ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° (êµìœ¡ìš© ë°ì´í„° ì´ë™)
    btnExport.addEventListener("click", ()=>{
      const items = load();
      const blob = new Blob([JSON.stringify(items, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "sangsaeng_board_export.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast("ë‚´ë³´ë‚´ê¸° ì™„ë£Œ");
    });

    btnImport.addEventListener("click", ()=>{
      const inp = document.createElement("input");
      inp.type = "file";
      inp.accept = "application/json";
      inp.onchange = () => {
        const file = inp.files?.[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const data = JSON.parse(String(reader.result || "[]"));
            if(!Array.isArray(data)) throw new Error("í˜•ì‹ ì˜¤ë¥˜");
            // ìµœì†Œ ê²€ì¦
            const cleaned = data
              .filter(p => p && typeof p.text === "string")
              .map(p => ({
                id: p.id || uid(),
                text: sanitize(p.text).slice(0,500),
                createdAt: p.createdAt || nowISO(),
                likes: Number(p.likes||0),
                reports: Number(p.reports||0),
                pinned: Boolean(p.pinned)
              }));
            save(cleaned);
            render();
            toast("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ");
          }catch(err){
            alert("ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: JSON í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");
          }
        };
        reader.readAsText(file, "utf-8");
      };
      inp.click();
    });

    // ê¸€ììˆ˜ ì¹´ìš´íŠ¸
    input.addEventListener("input", updateCount);

    // ìµœì´ˆ ë Œë”
    updateCount();
    render();
  })();
</script>
</body>
</html>
