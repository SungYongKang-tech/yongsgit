<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ¾ í…Œë‹ˆìŠ¤ ë ˆìŠ¨ ì‹œê°„í‘œ</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --bd:#e6e8ef;
      --txt:#0f172a; --mut:#64748b; --accent:#2563eb;
      --ok:#16a34a; --danger:#ef4444; --shadow:0 10px 28px rgba(15,23,42,.08);
      --r:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background: radial-gradient(1000px 520px at 12% 10%, #e8f0ff 0%, transparent 60%),
                  radial-gradient(820px 460px at 92% 18%, #fff1ea 0%, transparent 55%),
                  var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(246,247,251,.78);
      border-bottom:1px solid var(--bd);
    }
    .topbar .wrap{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:12px;
      display:grid;place-items:center;
      background: rgba(37,99,235,.08);
      border:1px solid rgba(37,99,235,.20);
      box-shadow: 0 10px 18px rgba(37,99,235,.10);
      font-size:18px;
    }
    .brand .t1{font-weight:900;font-size:14px}
    .brand .t2{font-weight:700;font-size:12px;color:var(--mut)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .tab{
      border:1px solid rgba(37,99,235,.20);
      background:#fff;
      padding:10px 12px;border-radius:12px;
      font-weight:850; cursor:pointer;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    .tab.active{background: rgba(37,99,235,.10)}
    .card{
      background: rgba(255,255,255,.92);
      border:1px solid var(--bd);
      border-radius: calc(var(--r) + 2px);
      box-shadow: var(--shadow);
      padding:14px;
      margin-top:12px;
    }
    h2{margin:0 0 10px;font-size:16px;letter-spacing:-.2px}
    .mut{color:var(--mut);font-weight:700}

    /* Form */
    .grid{
      display:grid; gap:10px;
      grid-template-columns: 1fr;
    }
    @media(min-width:860px){
      .grid{grid-template-columns: 1.2fr .8fr}
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{flex:1; min-width:140px}
    label{display:block;font-size:12px;color:var(--mut);font-weight:850;margin:6px 0}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border:1px solid rgba(15,23,42,.14);
      border-radius:14px;
      background: rgba(255,255,255,.95);
      outline:none;
      font-weight:750;
    }
    textarea{min-height:90px; resize:none; line-height:1.55; font-weight:650}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:1px solid rgba(37,99,235,.22);
      background:#fff;
      padding:11px 12px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    .btn.primary{background: linear-gradient(180deg, rgba(37,99,235,.95), rgba(37,99,235,.82)); color:#fff}
    .btn.danger{border-color: rgba(239,68,68,.25); background: rgba(239,68,68,.08); color:#7f1d1d}
    .btn.ok{border-color: rgba(22,163,74,.25); background: rgba(22,163,74,.08); color:#064e3b}

    /* Table (mobile-first) */
    .tableWrap{
      overflow:auto;
      border:1px solid var(--bd);
      border-radius: 16px;
      background:#fff;
    }
    table{width:100%; border-collapse:separate; border-spacing:0; min-width:720px}
    th,td{
      padding:12px 10px;
      border-bottom:1px solid var(--bd);
      text-align:left;
      font-size:14px;
      vertical-align:top;
      white-space:nowrap;
    }
    th{
      position:sticky; top:0;
      background: rgba(15,23,42,.03);
      font-weight:950;
      z-index:1;
    }
    tr:last-child td{border-bottom:none}
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      font-size:12px; font-weight:950;
      border:1px solid var(--bd); background:#fff;
    }
    .b1{border-color:rgba(37,99,235,.22); background:rgba(37,99,235,.06); color:#1e3a8a}
    .b2{border-color:rgba(22,163,74,.25); background:rgba(22,163,74,.06); color:#065f46}
    .b3{border-color:rgba(245,158,11,.28); background:rgba(245,158,11,.08); color:#7c2d12}

    /* Mobile card list */
    .cards{display:grid; gap:10px}
    .slot{
      background:#fff;
      border:1px solid var(--bd);
      border-radius: 16px;
      padding:12px;
      box-shadow: 0 10px 20px rgba(15,23,42,.06);
    }
    .slotTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .slotTitle{font-weight:950; font-size:15px; letter-spacing:-.2px}
    .slotTime{color:var(--mut); font-weight:850; margin-top:2px; font-size:13px}
    .slotMeta{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .slotNote{margin-top:10px; color:var(--mut); font-weight:700; line-height:1.55; font-size:13px}

    .toolsLine{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .search{
      flex:1; min-width:220px;
      display:flex; gap:8px; align-items:center;
      background:#fff;border:1px solid var(--bd);border-radius:14px;padding:10px 12px;
      box-shadow: 0 8px 18px rgba(15,23,42,.05);
    }
    .search input{border:none; padding:0; border-radius:0; background:transparent; box-shadow:none; font-weight:800}
    .mini{font-size:12px;color:var(--mut);font-weight:750}
    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <div class="logo">ğŸ¾</div>
        <div>
          <div class="t1">í…Œë‹ˆìŠ¤ ë ˆìŠ¨ ì‹œê°„í‘œ</div>
          <div class="t2">ê´€ë¦¬ì ì…ë ¥ â†’ í‘œ/ì¹´ë“œ ìë™ ì¶œë ¥</div>
        </div>
      </div>
      <div class="tabs">
        <button class="tab active" id="tabView">ì‹œê°„í‘œ ë³´ê¸°</button>
        <button class="tab" id="tabAdmin">ê´€ë¦¬ì</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- VIEW -->
    <section class="card" id="viewPane">
      <h2>ğŸ“… ë ˆìŠ¨ ì‹œê°„í‘œ</h2>

      <div class="toolsLine">
        <div class="search" title="ìš”ì¼/ì‹œê°„/ëŒ€ìƒ/ì¥ì†Œ/ë¹„ê³  ê²€ìƒ‰">
          ğŸ” <input id="q" placeholder="ì˜ˆ: í™”, 19:00, ì´ˆê¸‰, Aì½”íŠ¸, ê·¸ë£¹ë ˆìŠ¨" />
        </div>
        <div class="mini" id="countInfo"></div>
      </div>

      <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
        <span class="badge b1">ëª¨ë°”ì¼: ì¹´ë“œí˜•</span>
        <span class="badge b2">ê°€ë¡œ ìŠ¤í¬ë¡¤: í‘œ</span>
        <span class="badge b3">ë°ì´í„°: ê´€ë¦¬ìì—ì„œ ìˆ˜ì •</span>
      </div>

      <!-- Mobile cards -->
      <div style="margin-top:12px;">
        <div class="cards" id="cards"></div>
      </div>

      <!-- Table -->
      <div style="margin-top:14px;">
        <div class="tableWrap">
          <table aria-label="ë ˆìŠ¨ ì‹œê°„í‘œ í‘œ">
            <thead>
              <tr>
                <th style="width:110px;">ìš”ì¼</th>
                <th style="width:160px;">ì‹œê°„</th>
                <th style="width:140px;">ë ˆë²¨/ëŒ€ìƒ</th>
                <th style="width:160px;">í˜•íƒœ</th>
                <th style="width:160px;">ì¥ì†Œ</th>
                <th>ë¹„ê³ </th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
        <div class="mini" style="margin-top:8px;">
          â€» í‘œëŠ” íœ´ëŒ€í°ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ë¡œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì¹´ë“œí˜•ì´ ê¸°ë³¸)
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section class="card hidden" id="adminPane">
      <h2>ğŸ› ï¸ ê´€ë¦¬ì: ì‹œê°„í‘œ ì…ë ¥/ìˆ˜ì •</h2>
      <div class="grid">
        <div>
          <div class="row">
            <div class="field">
              <label>ìš”ì¼</label>
              <select id="fDay">
                <option value="ì›”">ì›”</option><option value="í™”">í™”</option><option value="ìˆ˜">ìˆ˜</option>
                <option value="ëª©">ëª©</option><option value="ê¸ˆ">ê¸ˆ</option><option value="í† ">í† </option><option value="ì¼">ì¼</option>
              </select>
            </div>
            <div class="field">
              <label>ì‹œì‘</label>
              <input id="fStart" type="time" value="19:00" />
            </div>
            <div class="field">
              <label>ì¢…ë£Œ</label>
              <input id="fEnd" type="time" value="21:00" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>ë ˆë²¨/ëŒ€ìƒ</label>
              <input id="fLevel" placeholder="ì˜ˆ: ì…ë¬¸/ì´ˆê¸‰/ì¤‘ê¸‰, ì‹ ê·œíšŒì›" />
            </div>
            <div class="field">
              <label>í˜•íƒœ</label>
              <select id="fType">
                <option value="ê·¸ë£¹ë ˆìŠ¨">ê·¸ë£¹ë ˆìŠ¨</option>
                <option value="ê°œì¸ë ˆìŠ¨">ê°œì¸ë ˆìŠ¨</option>
                <option value="ê²Œì„/ì‘ìš©">ê²Œì„/ì‘ìš©</option>
                <option value="ê¸°ë³¸ê¸°">ê¸°ë³¸ê¸°</option>
              </select>
            </div>
            <div class="field">
              <label>ì¥ì†Œ</label>
              <input id="fPlace" placeholder="ì˜ˆ: ë³¸ì‚¬ ì½”íŠ¸ A, ì™¸ë¶€ 2ë²ˆì½”íŠ¸" />
            </div>
          </div>

          <div class="field">
            <label>ë¹„ê³ </label>
            <textarea id="fNote" placeholder="ì˜ˆ: ë¼ì¼“/í…Œë‹ˆìŠ¤í™” í•„ìˆ˜, 10ë¶„ ì „ ì§‘í•©, ìš°ì²œ ì‹œ ì·¨ì†Œ ë“±"></textarea>
          </div>

          <div class="btns">
            <button class="btn primary" id="saveBtn">ì €ì¥(ì¶”ê°€/ìˆ˜ì •)</button>
            <button class="btn" id="resetBtn">ì…ë ¥ ì´ˆê¸°í™”</button>
            <button class="btn danger" id="wipeBtn">ì „ì²´ ì‚­ì œ</button>
          </div>

          <div class="note" style="margin-top:10px; padding:12px; border-radius:14px; border:1px dashed rgba(37,99,235,.35); background:rgba(37,99,235,.06); color:#1e3a8a; font-weight:750; line-height:1.55;">
            âœ… íŒ: ëª©ë¡ì—ì„œ í•­ëª©ì„ í´ë¦­í•˜ë©´ â€œìˆ˜ì • ëª¨ë“œâ€ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. ì €ì¥ì„ ëˆ„ë¥´ë©´ ê°™ì€ í•­ëª©ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
          </div>
        </div>

        <div>
          <h2 style="margin-top:0;">ğŸ“Œ í˜„ì¬ ë“±ë¡ëœ ì‹œê°„í‘œ</h2>
          <div class="cards" id="adminList"></div>
          <div class="btns">
            <button class="btn ok" id="exportBtn">JSON ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn" id="importBtn">JSON ê°€ì ¸ì˜¤ê¸°</button>
          </div>
          <textarea id="jsonBox" class="hidden" style="margin-top:10px;"></textarea>
          <div class="mini" style="margin-top:8px;">
            â€» ë‚´ë³´ë‚´ê¸°ëŠ” ë°±ì—…ìš©ì…ë‹ˆë‹¤. (Firebase ì—°ë™ ì „ê¹Œì§€ ì•ˆì „ì¥ì¹˜ë¡œ ì‚¬ìš© ê°€ëŠ¥)
          </div>
        </div>
      </div>
    </section>

    <div class="mini" style="text-align:center; margin:12px 0 6px;">
      Â© ì‹œê°„í‘œ í…œí”Œë¦¿(ë¡œì»¬ì €ì¥) Â· í•„ìš” ì‹œ Firebaseë¡œ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </div>
  </div>

  <script>
    // ---------- Storage
    const LS_KEY = "tennis_lesson_schedule_v1";
    const dayOrder = { "ì›”":1,"í™”":2,"ìˆ˜":3,"ëª©":4,"ê¸ˆ":5,"í† ":6,"ì¼":7 };

    /** @typedef {{id:string, day:string, start:string, end:string, level:string, type:string, place:string, note:string, updatedAt:number}} Slot */

    const $ = (id)=>document.getElementById(id);
    const tabView = $("tabView"), tabAdmin = $("tabAdmin");
    const viewPane = $("viewPane"), adminPane = $("adminPane");

    const q = $("q"), countInfo = $("countInfo");
    const cards = $("cards"), tbody = $("tbody");

    // Admin fields
    const fDay=$("fDay"), fStart=$("fStart"), fEnd=$("fEnd"),
          fLevel=$("fLevel"), fType=$("fType"), fPlace=$("fPlace"), fNote=$("fNote");
    const saveBtn=$("saveBtn"), resetBtn=$("resetBtn"), wipeBtn=$("wipeBtn");
    const adminList=$("adminList"), exportBtn=$("exportBtn"), importBtn=$("importBtn"), jsonBox=$("jsonBox");

    let editingId = null;

    function loadSlots(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        const data = raw ? JSON.parse(raw) : [];
        return Array.isArray(data) ? data : [];
      }catch(e){ return []; }
    }
    function saveSlots(slots){
      localStorage.setItem(LS_KEY, JSON.stringify(slots));
    }
    function uid(){
      return Math.random().toString(16).slice(2) + Date.now().toString(16);
    }
    function timeRange(s,e){
      if(!s && !e) return "";
      if(s && e) return `${s} ~ ${e}`;
      return s || e;
    }
    function norm(str){ return (str||"").toLowerCase().trim(); }

    // ---------- Render
    function getFiltered(){
      const slots = loadSlots().slice().sort((a,b)=>{
        const da = dayOrder[a.day]||99, db = dayOrder[b.day]||99;
        if(da!==db) return da-db;
        if((a.start||"")!== (b.start||"")) return (a.start||"").localeCompare(b.start||"");
        return (b.updatedAt||0) - (a.updatedAt||0);
      });

      const qq = norm(q.value);
      if(!qq) return slots;

      return slots.filter(s=>{
        const hay = [
          s.day, s.start, s.end, s.level, s.type, s.place, s.note
        ].join(" ").toLowerCase();
        return hay.includes(qq);
      });
    }

    function badgeClass(type){
      if(type.includes("ê·¸ë£¹")) return "b1";
      if(type.includes("ê°œì¸")) return "b2";
      return "b3";
    }

    function renderView(){
      const list = getFiltered();
      countInfo.textContent = `ì´ ${list.length.toLocaleString()}ê±´`;

      // Cards (mobile)
      cards.innerHTML = list.map(s=>`
        <div class="slot">
          <div class="slotTop">
            <div>
              <div class="slotTitle">${s.day} Â· ${escapeHtml(s.level || "ë ˆìŠ¨")}</div>
              <div class="slotTime">${timeRange(s.start, s.end)} Â· ${escapeHtml(s.place || "ì¥ì†Œ ë¯¸ì •")}</div>
            </div>
            <span class="badge ${badgeClass(s.type||"")}">${escapeHtml(s.type || "í˜•íƒœ")}</span>
          </div>
          <div class="slotMeta">
            ${s.level ? `<span class="badge b1">ëŒ€ìƒ: ${escapeHtml(s.level)}</span>` : ``}
            ${s.place ? `<span class="badge b2">ì¥ì†Œ: ${escapeHtml(s.place)}</span>` : ``}
          </div>
          ${s.note ? `<div class="slotNote">${escapeHtml(s.note)}</div>` : ``}
        </div>
      `).join("") || `<div class="mut" style="padding:10px;">í‘œì‹œí•  ì‹œê°„í‘œê°€ ì—†ìŠµë‹ˆë‹¤. (ê´€ë¦¬ì íƒ­ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”)</div>`;

      // Table
      tbody.innerHTML = list.map(s=>`
        <tr>
          <td><b>${escapeHtml(s.day)}</b></td>
          <td>${escapeHtml(timeRange(s.start, s.end))}</td>
          <td>${escapeHtml(s.level||"")}</td>
          <td><span class="badge ${badgeClass(s.type||"")}">${escapeHtml(s.type||"")}</span></td>
          <td>${escapeHtml(s.place||"")}</td>
          <td style="white-space:normal; min-width:260px">${escapeHtml(s.note||"")}</td>
        </tr>
      `).join("") || `<tr><td colspan="6" class="mut">ì‹œê°„í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    }

    function renderAdmin(){
      const slots = loadSlots().slice().sort((a,b)=>{
        const da = dayOrder[a.day]||99, db = dayOrder[b.day]||99;
        if(da!==db) return da-db;
        return (a.start||"").localeCompare(b.start||"");
      });

      adminList.innerHTML = slots.map(s=>`
        <div class="slot" data-id="${s.id}" style="cursor:pointer">
          <div class="slotTop">
            <div>
              <div class="slotTitle">${s.day} Â· ${escapeHtml(s.level || "ë ˆìŠ¨")}</div>
              <div class="slotTime">${timeRange(s.start, s.end)} Â· ${escapeHtml(s.place || "ì¥ì†Œ ë¯¸ì •")}</div>
            </div>
            <span class="badge ${badgeClass(s.type||"")}">${escapeHtml(s.type||"")}</span>
          </div>
          ${s.note ? `<div class="slotNote">${escapeHtml(s.note)}</div>` : ``}
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" type="button" onclick="event.stopPropagation(); editSlot('${s.id}')">ìˆ˜ì •</button>
            <button class="btn danger" type="button" onclick="event.stopPropagation(); delSlot('${s.id}')">ì‚­ì œ</button>
          </div>
        </div>
      `).join("") || `<div class="mut">ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    // ---------- Admin actions
    function resetForm(){
      editingId = null;
      fDay.value = "í™”";
      fStart.value = "19:00";
      fEnd.value = "21:00";
      fLevel.value = "";
      fType.value = "ê·¸ë£¹ë ˆìŠ¨";
      fPlace.value = "";
      fNote.value = "";
      saveBtn.textContent = "ì €ì¥(ì¶”ê°€/ìˆ˜ì •)";
    }

    window.editSlot = function(id){
      const slots = loadSlots();
      const s = slots.find(x=>x.id===id);
      if(!s) return;

      editingId = id;
      fDay.value = s.day || "í™”";
      fStart.value = s.start || "";
      fEnd.value = s.end || "";
      fLevel.value = s.level || "";
      fType.value = s.type || "ê·¸ë£¹ë ˆìŠ¨";
      fPlace.value = s.place || "";
      fNote.value = s.note || "";
      saveBtn.textContent = "ìˆ˜ì • ì €ì¥";
      // ê´€ë¦¬ì íƒ­ì—ì„œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      window.scrollTo({top:0, behavior:"smooth"});
    }

    window.delSlot = function(id){
      if(!confirm("ì´ í•­ëª©ì„ ì‚­ì œí• ê¹Œìš”?")) return;
      let slots = loadSlots();
      slots = slots.filter(x=>x.id!==id);
      saveSlots(slots);
      if(editingId===id) resetForm();
      renderAll();
    }

    function validate(){
      if(!fDay.value) return "ìš”ì¼ì„ ì„ íƒí•˜ì„¸ìš”.";
      if(!fStart.value || !fEnd.value) return "ì‹œì‘/ì¢…ë£Œ ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”.";
      if(fStart.value >= fEnd.value) return "ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.";
      return "";
    }

    saveBtn.addEventListener("click", ()=>{
      const msg = validate();
      if(msg){ alert(msg); return; }

      const slots = loadSlots();
      const payload = {
        id: editingId || uid(),
        day: fDay.value,
        start: fStart.value,
        end: fEnd.value,
        level: (fLevel.value||"").trim(),
        type: fType.value,
        place: (fPlace.value||"").trim(),
        note: (fNote.value||"").trim(),
        updatedAt: Date.now()
      };

      if(editingId){
        const idx = slots.findIndex(x=>x.id===editingId);
        if(idx>=0) slots[idx] = payload;
      }else{
        slots.push(payload);
      }

      saveSlots(slots);
      resetForm();
      renderAll();
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });

    resetBtn.addEventListener("click", resetForm);

    wipeBtn.addEventListener("click", ()=>{
      if(!confirm("ì „ì²´ ì‹œê°„í‘œë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
      localStorage.removeItem(LS_KEY);
      resetForm();
      renderAll();
    });

    exportBtn.addEventListener("click", ()=>{
      const data = loadSlots();
      jsonBox.classList.remove("hidden");
      jsonBox.value = JSON.stringify(data, null, 2);
      jsonBox.focus();
      jsonBox.select();
      alert("JSONì´ ì•„ë˜ ë°•ìŠ¤ì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë³µì‚¬í•´ì„œ ë°±ì—…í•˜ì„¸ìš”.");
    });

    importBtn.addEventListener("click", ()=>{
      jsonBox.classList.remove("hidden");
      const raw = prompt("ê°€ì ¸ì˜¬ JSONì„ ë¶™ì—¬ ë„£ìœ¼ì„¸ìš” (ë°°ì—´ í˜•íƒœ).");
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        if(!Array.isArray(data)) throw new Error("ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.");
        // ìµœì†Œ í•„ë“œ ë³´ì •
        const fixed = data.map(s=>({
          id: s.id || uid(),
          day: s.day || "í™”",
          start: s.start || "19:00",
          end: s.end || "21:00",
          level: s.level || "",
          type: s.type || "ê·¸ë£¹ë ˆìŠ¨",
          place: s.place || "",
          note: s.note || "",
          updatedAt: s.updatedAt || Date.now()
        }));
        saveSlots(fixed);
        resetForm();
        renderAll();
        alert("ê°€ì ¸ì˜¤ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }catch(e){
        alert("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    });

    // ---------- Tabs
    function setTab(which){
      const isView = which === "view";
      tabView.classList.toggle("active", isView);
      tabAdmin.classList.toggle("active", !isView);
      viewPane.classList.toggle("hidden", !isView);
      adminPane.classList.toggle("hidden", isView);
      if(!isView) renderAdmin();
    }

    tabView.addEventListener("click", ()=>setTab("view"));
    tabAdmin.addEventListener("click", ()=>setTab("admin"));

    q.addEventListener("input", renderView);

    function renderAll(){
      renderView();
      renderAdmin();
    }

    // ---------- helpers
    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // init
    (function init(){
      // ì´ˆê¸° ì˜ˆì‹œ ë°ì´í„°(ì²˜ìŒ 1íšŒë§Œ)
      const has = localStorage.getItem(LS_KEY);
      if(!has){
        saveSlots([
          {id:uid(), day:"í™”", start:"19:00", end:"21:00", level:"ì…ë¬¸/ì´ˆê¸‰", type:"ê·¸ë£¹ë ˆìŠ¨", place:"ë³¸ì‚¬ ì½”íŠ¸ A", note:"í…Œë‹ˆìŠ¤í™” í•„ìˆ˜ Â· 10ë¶„ ì „ ì§‘í•©", updatedAt:Date.now()},
          {id:uid(), day:"ëª©", start:"19:00", end:"21:00", level:"ì´ˆì¤‘ê¸‰", type:"ê·¸ë£¹ë ˆìŠ¨", place:"ë³¸ì‚¬ ì½”íŠ¸ A", note:"ê¸°ë³¸ê¸°+íŒ¨í„´ Â· ë§ˆì§€ë§‰ 20ë¶„ ê²Œì„", updatedAt:Date.now()},
          {id:uid(), day:"í† ", start:"10:00", end:"12:00", level:"ì „ì²´", type:"ê²Œì„/ì‘ìš©", place:"ë³¸ì‚¬ ì½”íŠ¸ B", note:"ìš°ì²œ ì‹œ ë‹¨ì²´ë°© ê³µì§€", updatedAt:Date.now()}
        ]);
      }
      resetForm();
      renderAll();
    })();
  </script>
</body>
</html>