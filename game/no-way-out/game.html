<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>No Way Out - Game</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
      padding: 20px;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    #turnInfo {
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }
    .board {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      background: #fff;
      border: 2px solid #555;
      border-radius: 50%;
    }
    .point {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid #333;
      position: absolute;
      top: 0;
      left: 0;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      background-color: #f0f0f0;
      cursor: pointer;
      z-index: 2;
    }
    .point.selected {
      background-color: #c8e6c9;
    }
    .point.available {
      background-color: #fff59d;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <h1>No Way Out</h1>
  <div id="turnInfo">게임 로딩 중...</div>
  <div class="board" id="board">
    <svg id="lines"></svg>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getDatabase, ref, set, onValue, get
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCoHcYm0_fdpCcJbyh6PO60fjOZZKoR8xg",
      authDomain: "number-baseball-aee52.firebaseapp.com",
      databaseURL: "https://number-baseball-aee52-default-rtdb.firebaseio.com",
      projectId: "number-baseball-aee52",
      storageBucket: "number-baseball-aee52.appspot.com",
      messagingSenderId: "998537150772",
      appId: "1:998537150772:web:f8e3fcb77f6ddef091a561"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const roomId = localStorage.getItem("roomId");
    const playerNum = localStorage.getItem("player");
    const symbol = playerNum === "1" ? "⬛" : "⚪";
    const boardEl = document.getElementById("board");
    const linesEl = document.getElementById("lines");
    const turnInfo = document.getElementById("turnInfo");

   const positions = [
  { top: 20, left: 60 },   // 0
  { top: 20, left: 150 },  // 1
  { top: 20, left: 240 },  // 2
  { top: 85, left: 60 },   // 3 (좌측 중간)
  { top: 85, left: 150 },  // 4 (중앙)
  { top: 85, left: 240 },  // 5 (우측 중간)
  { top: 150, left: 60 },  // 6 (좌하단)
  { top: 150, left: 150 }, // 7 (중하단)
  { top: 150, left: 240 }, // 8 (우하단)
  { top: 215, left: 60 },  // 9
  { top: 215, left: 150 }, // 10
  { top: 215, left: 240 }  // 11
];


    const adjacency = {
      0: [1],
      1: [0, 2, 4],
      2: [1],
      4: [1, 3, 5, 7, 6],   // ← 4번에서 6번(아래 왼쪽 대각선) 추가
      5: [2, 4, 8],         // ← 기존 그대로
      6: [3, 4, 7, 9],      // ← 6번에서 4번 연결 확인
      7: [4, 6, 8, 10],     // ← 7번에서 4번/8번 확인
      8: [5, 7, 11],        // ← 8번에서 7번 연결 확인
      9: [10],
      10: [9, 11, 8],
      11: [10]
    };

    const state = ["⚪", "⚪", "⚪", "", "⬛", "⬛", "⬛", "", "", "", "", ""];
    let selected = null;

   function drawLines() {
      linesEl.innerHTML = "";
      const drawn = new Set();
      for (const [from, toList] of Object.entries(adjacency)) {
        const p1 = positions[from];
        for (const to of toList) {
          const key = [Math.min(from, to), Math.max(from, to)].join("-");
          if (drawn.has(key)) continue;
          drawn.add(key);

          const p2 = positions[to];
          const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
          line.setAttribute("x1", p1.left + 15);
          line.setAttribute("y1", p1.top + 15);
          line.setAttribute("x2", p2.left + 15);
          line.setAttribute("y2", p2.top + 15);
          line.setAttribute("stroke", "#444");
          line.setAttribute("stroke-width", "2");
          linesEl.appendChild(line);
        }
      }
    }

    function renderBoard() {
      boardEl.querySelectorAll(".point").forEach(p => p.remove());
      positions.forEach((pos, idx) => {
        const div = document.createElement("div");
        div.className = "point";
        div.style.top = pos.top + "px";
        div.style.left = pos.left + "px";
        div.textContent = state[idx];

        if (idx === selected) div.classList.add("selected");
        if (selected !== null && state[selected] === symbol && state[idx] === "" && adjacency[selected]?.includes(idx)) {
          div.classList.add("available");
        }

        div.onclick = () => handleClick(idx);
        boardEl.appendChild(div);
      });
    }

    function handleClick(idx) {
      if (selected === null && state[idx] === symbol) {
        selected = idx;
      } else if (selected !== null && state[idx] === "" && adjacency[selected]?.includes(idx)) {
        state[idx] = symbol;
        state[selected] = "";
        selected = null;
      } else {
        selected = null;
      }
      renderBoard();
    }

    drawLines();
    renderBoard();
  </script>
</body>
</html>
