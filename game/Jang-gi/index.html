<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>장기 (SVG 말 로딩 예제)</title>
  <style>
    :root {
      --board-w: min(92vmin, 860px);
    }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; background:#f6f7fb; color:#222; display:flex; justify-content:center; }
    .wrap { width: var(--board-w); padding: 14px 10px 24px; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    h1 { font-size: clamp(18px, 2.8vw, 24px); margin:0; }
    .toolbar { display:flex; gap:8px; }
    button { padding:8px 12px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; cursor:pointer; }
    .board-box { position: relative; width:100%; aspect-ratio: 9/10; background:#fdfcf7; border: 2px solid #222; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    .hint { pointer-events:none; }
    .hint circle { fill: rgba(0,0,0,.15); }
    .last-move line { stroke:#3b82f6; stroke-width:6; stroke-linecap:round; opacity:.5 }
    .note { color:#475569; font-size: 12px; margin-top:8px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>장기 (SVG 말 사용)</h1>
      <div class="toolbar">
        <button id="resetBtn">초기배치</button>
        <button id="flipBtn">상하 뒤집기</button>
      </div>
    </header>
    <div class="board-box">
      <svg id="board" viewBox="0 0 900 1000" width="100%" height="100%">
        <g id="grid" stroke="#111" stroke-width="2">
          <g id="vlines"></g>
          <g id="hlines"></g>
        </g>
        <g id="palace" stroke="#111" stroke-width="2">
          <line x1="300" y1="0" x2="600" y2="300" />
          <line x1="600" y1="0" x2="300" y2="300" />
          <line x1="300" y1="700" x2="600" y2="1000" />
          <line x1="600" y1="700" x2="300" y2="1000" />
        </g>
        <g class="last-move" id="lastMove"></g>
        <g class="hint" id="hints"></g>
        <g id="pieces"></g>
      </svg>
    </div>
    <div class="note">※ 같은 폴더의 han_*.svg, cho_*.svg 파일을 불러옵니다.</div>
  </div>

<script>
const FILES = 9;
const RANKS = 10;
const CELL = 100;
const svg = document.getElementById('board');
const vLayer = document.getElementById('vlines');
const hLayer = document.getElementById('hlines');
const pLayer = document.getElementById('pieces');
const hintLayer = document.getElementById('hints');
const lastMoveLayer = document.getElementById('lastMove');

for (let x = 0; x < FILES; x++) {
  const line = document.createElementNS('http://www.w3.org/2000/svg','line');
  line.setAttribute('x1', x*CELL);
  line.setAttribute('y1', 0);
  line.setAttribute('x2', x*CELL);
  line.setAttribute('y2', 9*CELL);
  vLayer.appendChild(line);
}
for (let y = 0; y < RANKS; y++) {
  const line = document.createElementNS('http://www.w3.org/2000/svg','line');
  line.setAttribute('x1', 0);
  line.setAttribute('y1', y*CELL);
  line.setAttribute('x2', 8*CELL);
  line.setAttribute('y2', y*CELL);
  hLayer.appendChild(line);
}

const PIECE_SOURCES = {
  han: {
    cha:  'han_cha.svg',
    ma:   'han_ma.svg',
    sang: 'han_sang.svg',
    sa:   'han_sa.svg',
    jang: 'han_jang.svg',
    po:   'han_po.svg',
    byung:'han_byung.svg',
  },
  cho: {
    cha:  'cho_cha.svg',
    ma:   'cho_ma.svg',
    sang: 'cho_sang.svg',
    sa:   'cho_sa.svg',
    jang: 'cho_jang.svg',
    po:   'cho_po.svg',
    jol:  'cho_jol.svg',
  }
};

function initialPosition() {
  const pos = [];
  const H = 'han';
  pos.push(
    {side:H, type:'cha',  x:0, y:0},
    {side:H, type:'ma',   x:1, y:0},
    {side:H, type:'sang', x:2, y:0},
    {side:H, type:'sa',   x:3, y:0},
    {side:H, type:'jang', x:4, y:1},
    {side:H, type:'sa',   x:5, y:0},
    {side:H, type:'sang', x:6, y:0},
    {side:H, type:'ma',   x:7, y:0},
    {side:H, type:'cha',  x:8, y:0},
    {side:H, type:'po',   x:1, y:2},
    {side:H, type:'po',   x:7, y:2},
    {side:H, type:'byung',x:0, y:3},
    {side:H, type:'byung',x:2, y:3},
    {side:H, type:'byung',x:4, y:3},
    {side:H, type:'byung',x:6, y:3},
    {side:H, type:'byung',x:8, y:3},
  );
  const C = 'cho';
  pos.push(
    {side:C, type:'cha',  x:0, y:9},
    {side:C, type:'ma',   x:1, y:9},
    {side:C, type:'sang', x:2, y:9},
    {side:C, type:'sa',   x:3, y:9},
    {side:C, type:'jang', x:4, y:8},
    {side:C, type:'sa',   x:5, y:9},
    {side:C, type:'sang', x:6, y:9},
    {side:C, type:'ma',   x:7, y:9},
    {side:C, type:'cha',  x:8, y:9},
    {side:C, type:'po',   x:1, y:7},
    {side:C, type:'po',   x:7, y:7},
    {side:C, type:'jol',  x:0, y:6},
    {side:C, type:'jol',  x:2, y:6},
    {side:C, type:'jol',  x:4, y:6},
    {side:C, type:'jol',  x:6, y:6},
    {side:C, type:'jol',  x:8, y:6},
  );
  return pos;
}

let pieces = initialPosition();
let turn = 'cho';
let selectedId = null;
let flipped = false;
let moveHistory = [];

function toXY(x, y) {
  const py = y * CELL;
  const px = x * CELL;
  return { cx: px, cy: py };
}

function drawPieces() {
  pLayer.innerHTML = '';
  pieces.forEach((p, id) => {
    const {cx, cy} = toXY(p.x, p.y);
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('data-id', id);
    g.style.cursor = 'pointer';

    const img = document.createElementNS('http://www.w3.org/2000/svg', 'image');
    const href = PIECE_SOURCES[p.side][p.type];
    img.setAttributeNS('http://www.w3.org/1999/xlink', 'href', href);
    img.setAttribute('x', cx - 38);
    img.setAttribute('y', cy - 38);
    img.setAttribute('width', 76);
    img.setAttribute('height', 76);
    img.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    g.appendChild(img);

    if (Number(selectedId) === id) {
      const ring = document.createElementNS('http://www.w3.org/2000/svg','circle');
      ring.setAttribute('cx', cx);
      ring.setAttribute('cy', cy);
      ring.setAttribute('r', 40);
      ring.setAttribute('fill','none');
      ring.setAttribute('stroke', '#0ea5e9');
      ring.setAttribute('stroke-width', '4');
      g.appendChild(ring);
    }

    g.addEventListener('click', () => onPieceClick(id));
    pLayer.appendChild(g);
  });
}

function reset() {
  pieces = initialPosition();
  turn = 'cho';
  selectedId = null;
  moveHistory = [];
  drawPieces();
  lastMoveLayer.innerHTML = '';
}
function flip(){
  flipped = !flipped;
  svg.setAttribute('viewBox', flipped ? '0 1000 900 -1000' : '0 0 900 1000');
}

document.getElementById('resetBtn').addEventListener('click', reset);
document.getElementById('flipBtn').addEventListener('click', flip);

reset();
</script>
</body>
</html>
