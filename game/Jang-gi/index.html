<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML 장기 게임 (최종 수정판)</title>
    <style>
        :root {
            --cell-size: 56px;
            --board-width: calc(var(--cell-size) * 8);
            --board-height: calc(var(--cell-size) * 9);
            --border-color: #3a2a1a;
            --board-bg: #e4c59a;
        }

        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #f0e6d2;
            padding: 20px;
        }

        h1 {
            color: #333;
        }

        #janggi-board-container {
            position: relative;
            width: calc(var(--board-width) + var(--cell-size));
            height: calc(var(--board-height) + var(--cell-size));
            background-color: var(--board-bg);
            border: 2px solid var(--border-color);
            padding: calc(var(--cell-size) / 2);
            box-sizing: border-box;
        }

        #janggi-board {
            position: relative;
            width: var(--board-width);
            height: var(--board-height);
            background-image:
                repeating-linear-gradient(to right, transparent, transparent calc(var(--cell-size) - 1px), var(--border-color) calc(var(--cell-size) - 1px), var(--border-color) var(--cell-size)),
                repeating-linear-gradient(to bottom, transparent, transparent calc(var(--cell-size) - 1px), var(--border-color) calc(var(--cell-size) - 1px), var(--border-color) var(--cell-size));
            background-size: var(--cell-size) var(--cell-size);
            
            /* --- 수정된 부분: 맨 위/왼쪽 선 추가 --- */
            border-top: 1px solid var(--border-color);
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .palace {
            position: absolute;
            width: calc(var(--cell-size) * 2);
            height: calc(var(--cell-size) * 2);
            left: calc(var(--cell-size) * 3);
        }
        #cho-palace { top: 0; }
        #han-palace { bottom: 0; }

        .palace-line {
            position: absolute;
            background-color: var(--border-color);
        }
        /* 궁성 대각선 */
        .diag1 { top: 0; left: 0; width: 1px; height: calc(var(--cell-size) * 2.828); transform: rotate(45deg); transform-origin: top left; }
        .diag2 { top: 0; right: 0; width: 1px; height: calc(var(--cell-size) * 2.828); transform: rotate(-45deg); transform-origin: top right; }
        /* 궁성 세로선 */
        .vert { top: 0; left: var(--cell-size); width: 1px; height: calc(var(--cell-size) * 2); }


        .piece {
            position: absolute;
            width: calc(var(--cell-size) * 0.9);
            height: calc(var(--cell-size) * 0.9);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
        }
        
        .piece.selected {
            box-shadow: 0 0 15px 5px rgba(255, 0, 0, 0.7);
        }
    </style>
</head>
<body>

    <h1>HTML 장기 게임 (최종 수정판)</h1>
    <div id="janggi-board-container">
        <div id="janggi-board">
            <div id="cho-palace" class="palace">
                <div class="palace-line vert"></div>
                <div class="palace-line diag1"></div>
                <div class="palace-line diag2"></div>
            </div>
            <div id="han-palace" class="palace">
                <div class="palace-line vert"></div>
                <div class="palace-line diag1"></div>
                <div class="palace-line diag2"></div>
            </div>
        </div>
    </div>

    <script>
        const boardElement = document.getElementById('janggi-board');
        const CELL_SIZE = 56;

        const initialSetup = {
            '0,0': { team: 'cho', piece: 'cha' }, '0,1': { team: 'cho', piece: 'sang' },
            '0,2': { team: 'cho', piece: 'ma' },  '0,3': { team: 'cho', piece: 'sa' },
            '0,5': { team: 'cho', piece: 'sa' },  '0,6': { team: 'cho', piece: 'ma' },
            '0,7': { team: 'cho', piece: 'sang' },'0,8': { team: 'cho', piece: 'cha' },
            '1,4': { team: 'cho', piece: 'jang' },
            '2,1': { team: 'cho', piece: 'po' },  '2,7': { team: 'cho', piece: 'po' },
            '3,0': { team: 'cho', piece: 'jol' }, '3,2': { team: 'cho', piece: 'jol' },
            '3,4': { team: 'cho', piece: 'jol' }, '3,6': { team: 'cho', piece: 'jol' },
            '3,8': { team: 'cho', piece: 'jol' },

            '9,0': { team: 'han', piece: 'cha' }, '9,1': { team: 'han', piece: 'sang' },
            '9,2': { team: 'han', piece: 'ma' },  '9,3': { team: 'han', piece: 'sa' },
            '9,5': { team: 'han', piece: 'sa' },  '9,6': { team: 'han', piece: 'ma' },
            '9,7': { team: 'han', piece: 'sang' },'9,8': { team: 'han', piece: 'cha' },
            '8,4': { team: 'han', piece: 'jang' },
            '7,1': { team: 'han', piece: 'po' },  '7,7': { team: 'han', piece: 'po' },
            '6,0': { team: 'han', piece: 'byung' }, '6,2': { team: 'han', piece: 'byung' },
            '6,4': { team: 'han', piece: 'byung' }, '6,6': { team: 'han', piece: 'byung' },
            '6,8': { team: 'han', piece: 'byung' }
        };

        function placePieces() {
            Object.entries(initialSetup).forEach(([pos, pieceInfo]) => {
                const [row, col] = pos.split(',').map(Number);
                const pieceElement = document.createElement('div');
                pieceElement.classList.add('piece');
                
                const pieceName = pieceInfo.team === 'han' && pieceInfo.piece === 'byung' ? 'byung' :
                                  pieceInfo.team === 'cho' && pieceInfo.piece === 'jol' ? 'jol' : pieceInfo.piece;

                pieceElement.style.backgroundImage = `url('${pieceInfo.team}_${pieceName}.svg')`;
                pieceElement.dataset.team = pieceInfo.team;
                pieceElement.dataset.piece = pieceInfo.piece;
                pieceElement.dataset.row = row;
                pieceElement.dataset.col = col;

                pieceElement.style.top = `${row * CELL_SIZE}px`;
                pieceElement.style.left = `${col * CELL_SIZE}px`;

                boardElement.appendChild(pieceElement);
            });
        }
        
        placePieces();

        let selectedPiece = null;

        boardElement.addEventListener('click', (e) => {
            const target = e.target;

            if (target.classList.contains('piece')) {
                if (selectedPiece) {
                    selectedPiece.classList.remove('selected');
                }
                if (selectedPiece === target) {
                    selectedPiece = null;
                    return;
                }
                selectedPiece = target;
                selectedPiece.classList.add('selected');
            }
            else if (selectedPiece) {
                const boardRect = boardElement.getBoundingClientRect();
                const x = e.clientX - boardRect.left;
                const y = e.clientY - boardRect.top;

                const col = Math.round(x / CELL_SIZE);
                const row = Math.round(y / CELL_SIZE);

                // TODO: 여기에 실제 장기 규칙에 따른 이동 가능 여부 검사 로직이 필요합니다.

                const targetPiece = document.querySelector(`.piece[data-row='${row}'][data-col='${col}']`);
                
                if (targetPiece) { 
                    if (targetPiece.dataset.team !== selectedPiece.dataset.team) {
                        targetPiece.remove();
                    } else {
                        selectedPiece.classList.remove('selected');
                        selectedPiece = null;
                        return;
                    }
                }
                
                selectedPiece.style.left = `${col * CELL_SIZE}px`;
                selectedPiece.style.top = `${row * CELL_SIZE}px`;
                selectedPiece.dataset.row = row;
                selectedPiece.dataset.col = col;
                
                selectedPiece.classList.remove('selected');
                selectedPiece = null;
            }
        });
    </script>
</body>
</html>