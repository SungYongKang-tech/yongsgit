<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>8방향 이동</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
      background-color: #f0f0f0;
      touch-action: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    let x = 100, y = 100;
    const size = 30;
    const speed = 3;
    let dx = 1, dy = 0; // 기본 오른쪽 이동

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "blue";
      ctx.fillRect(x, y, size, size);
    }

    function move() {
      x += dx * speed;
      y += dy * speed;

      if (x > canvas.width) x = -size;
      if (x < -size) x = canvas.width;
      if (y > canvas.height) y = -size;
      if (y < -size) y = canvas.height;
    }

    function gameLoop() {
      move();
      draw();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // 모바일 스와이프 감지
    let startX = null;
    let startY = null;

    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      startX = touch.clientX;
      startY = touch.clientY;
    });

    canvas.addEventListener("touchend", (e) => {
      const touch = e.changedTouches[0];
      const dxTouch = touch.clientX - startX;
      const dyTouch = touch.clientY - startY;

      const length = Math.sqrt(dxTouch**2 + dyTouch**2);
      if (length < 20) return; // 너무 짧은 터치 무시

      // 방향 벡터 정규화
      dx = dxTouch / length;
      dy = dyTouch / length;
    });

    // 키보드 (방향키 여러 개 동시에 눌러 대각선 이동 가능)
    let keys = {};

    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
      updateDirection();
    });

    document.addEventListener("keyup", (e) => {
      keys[e.key] = false;
      updateDirection();
    });

    function updateDirection() {
      dx = 0;
      dy = 0;
      if (keys["ArrowUp"]) dy = -1;
      if (keys["ArrowDown"]) dy = 1;
      if (keys["ArrowLeft"]) dx = -1;
      if (keys["ArrowRight"]) dx = 1;

      // 대각선 정규화
      const length = Math.sqrt(dx**2 + dy**2);
      if (length > 0) {
        dx /= length;
        dy /= length;
      }
    }
  </script>
</body>
</html>
