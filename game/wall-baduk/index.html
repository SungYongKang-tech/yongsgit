<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Wall-baduk (벽바둑)</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      text-align: center;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }
    h1 {
      margin: 10px;
    }
    #controls {
      margin-bottom: 10px;
    }
    #turn {
      font-weight: bold;
      margin: 10px;
    }
    #board {
      display: grid;
      background: #fff;
      border: 2px solid #333;
    }
    .cell {
      box-sizing: border-box;
      border: 1px solid #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .point { width: 40px; height: 40px; background-color: white; position: relative; }
    .piece { width: 80%; height: 80%; border-radius: 50%; pointer-events: none; }
    .h-wall { width: 40px; height: 15px; background-color: white; cursor: pointer; }
    .v-wall { width: 15px; height: 40px; background-color: white; cursor: pointer; }
    .blank { width: 15px; height: 15px; background-color: navy; }
    .movable { outline: 3px dashed gray; }
  </style>
</head>
<body>
  <h1>Wall-baduk (벽바둑)</h1>
  <div id="controls">
    <label>난이도:
      <select id="levelSelect">
        <option value="7">초급 (7x7)</option>
        <option value="9">중급 (9x9)</option>
        <option value="11">고급 (11x11)</option>
      </select>
    </label>
    <label>인원:
      <select id="playerCountSelect">
        <option value="2">2명</option>
        <option value="3">3명</option>
        <option value="4">4명</option>
      </select>
    </label>
    <button onclick="startGame()">게임 시작</button>
  </div>
  <div id="turn" style="display:none;">현재 턴: <span id="turnColor"></span></div>
  <div id="board"></div>

  <script>
    const board = document.getElementById("board");
    const turnDisplay = document.getElementById("turn");
    const turnColorText = document.getElementById("turnColor");
    const playerColors = ['#e74c3c', '#3498db', '#2ecc71', '#8e44ad'];
    let playerCount = 2;
    let gridSize = 13;
    let boardMap = [];
    let currentPlayer = 0;
    let selectedPiece = null;

    function startGame() {
      const level = parseInt(document.getElementById("levelSelect").value);
      playerCount = parseInt(document.getElementById("playerCountSelect").value);
      gridSize = level * 2 - 1;

      board.innerHTML = "";
      board.style.gridTemplateColumns = `repeat(${gridSize}, auto)`;
      board.style.gridTemplateRows = `repeat(${gridSize}, auto)`;
      boardMap = Array.from(Array(gridSize), () => Array(gridSize).fill(null));

      turnDisplay.style.display = 'block';
      updateTurnDisplay();

      createBoard();
      placeInitialPieces(level);
    }

    function updateTurnDisplay() {
      turnColorText.textContent = `Player ${currentPlayer + 1}`;
      turnColorText.style.color = playerColors[currentPlayer];
    }

    function createBoard() {
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          if (r % 2 === 0 && c % 2 === 0) {
            cell.classList.add("point");
          } else if (r % 2 === 1 && c % 2 === 0) {
            cell.classList.add("h-wall");
          } else if (r % 2 === 0 && c % 2 === 1) {
            cell.classList.add("v-wall");
          } else {
            cell.classList.add("blank");
          }
          board.appendChild(cell);
          boardMap[r][c] = cell;
        }
      }
    }

    function placeInitialPieces(level) {
      const margin = 2;
      const mid = Math.floor(gridSize / 2);
      const starts2 = [
        [[margin, margin], [margin, mid]],
        [[gridSize - 1 - margin, gridSize - 1 - margin], [gridSize - 1 - margin, mid]]
      ];
      const starts4 = [
        [margin, margin],
        [margin, gridSize - 1 - margin],
        [gridSize - 1 - margin, margin],
        [gridSize - 1 - margin, gridSize - 1 - margin]
      ];

      if (playerCount === 2) {
        for (let i = 0; i < 2; i++) {
          for (let pos of starts2[i]) {
            placePiece(pos[0], pos[1], i);
          }
        }
        // 추가 말 한 개씩 더
        placePiece(mid, margin, 0);
        placePiece(mid, gridSize - 1 - margin, 1);
      } else if (playerCount === 3) {
        alert("3인용: 각자 말 없이 시작 후 1개씩 두 번 클릭하여 배치하세요.");
        let count = 0;
        board.querySelectorAll('.point').forEach(cell => {
          cell.addEventListener('click', function handler() {
            if (!cell.querySelector('.piece')) {
              const piece = document.createElement("div");
              piece.classList.add("piece");
              piece.style.backgroundColor = playerColors[count % 3];
              piece.dataset.player = count % 3;
              cell.appendChild(piece);
              count++;
              if (count === 6) board.querySelectorAll('.point').forEach(p => p.removeEventListener('click', handler));
            }
          });
        });
      } else if (playerCount === 4) {
        for (let i = 0; i < 4; i++) {
          const [r, c] = starts4[i];
          placePiece(r, c, i);
        }
      }
    }

    function placePiece(r, c, playerIdx) {
      const cell = boardMap[r][c];
      const piece = document.createElement("div");
      piece.classList.add("piece");
      piece.style.backgroundColor = playerColors[playerIdx];
      piece.dataset.player = playerIdx;
      cell.appendChild(piece);
    }
  </script>
</body>
</html>
