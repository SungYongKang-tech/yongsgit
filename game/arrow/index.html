<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ë„ˆì•¼ë„ˆ ë£°ë ›</title>
<style>
  :root{
    --accent:#2563eb;
    --accent-2:#10b981;
    --bg:#f6f7fb;
    --ink:#111827;
    --muted:#6b7280;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,"Noto Sans KR",sans-serif;
    min-height:100dvh; display:grid; grid-template-rows:auto 1fr auto;
  }
  header{
    padding:14px 16px; background:#fff; border-bottom:1px solid #e5e7eb;
    position:sticky; top:0; z-index:5;
  }
  h1{margin:0; font-size:20px; letter-spacing:.3px}
  main{display:grid; place-items:center; padding:18px}
  .panel{
    width:min(920px,95vw); background:var(--card); border:1px solid #e5e7eb;
    border-radius:16px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.06);
  }
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:8px 0 10px}
  label{font-size:14px; color:var(--muted)}
  input,button,textarea{
    font-size:16px; padding:10px 12px; border-radius:12px; border:1px solid #d1d5db; background:#fff;
  }
  input[type=number]{width:110px}
  button{
    border:none; color:#fff; cursor:pointer; background:var(--accent);
    padding:10px 16px; font-weight:600; box-shadow:0 4px 14px rgba(37,99,235,.22);
  }
  button.secondary{ background:#6b7280; box-shadow:none }
  button.ghost{ background:#fff; color:var(--ink); border:1px solid #d1d5db; box-shadow:none }
  button:disabled{opacity:.55; cursor:not-allowed}
  .grid{
    display:grid; grid-template-columns: 1fr; gap:14px; margin-top:10px;
  }
  @media(min-width:860px){
    .grid{ grid-template-columns: 1.3fr .9fr; align-items:start; }
  }
  .canvas-wrap{
    background:conic-gradient(from 0deg, #fafafa, #ffffff);
    border-radius:18px; border:1px solid #e5e7eb; padding:14px; position:relative;
  }
  canvas{ display:block; width:100%; height:auto; border-radius:10px; background:#fff; }
  .arrow-pivot{
    position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
  }
  .arrow-ring{
    width:min(110px,20vmin); height:min(110px,20vmin);
    border-radius:50%; background:#fff; border:6px solid #11182722;
    display:grid; place-items:center; box-shadow:0 10px 30px rgba(0,0,0,.18);
  }
  .arrow{
    width:0; height:0; border-left:14px solid transparent; border-right:14px solid transparent;
    border-bottom:42px solid var(--accent); filter:drop-shadow(0 6px 10px rgba(0,0,0,.25));
    transform-origin:50% 140%;
  }
  .tools{ background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:12px }
  .tools h3{ margin:0 0 8px 0; font-size:16px }
  .muted{ color:var(--muted); font-size:13px }
  .list{
    display:grid; gap:6px; max-height:46vh; overflow:auto; padding-right:4px;
  }
  .list input{ width:100% }
  .badge{
    display:inline-flex; align-items:center; gap:6px; border-radius:999px; background:#eef2ff;
    color:#1d4ed8; padding:6px 10px; font-size:13px; font-weight:600;
  }
  .center-row{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:10px }
  .result{
    margin-top:8px; font-size:18px; text-align:center; min-height:28px;
  }
  footer{ padding:10px 14px; text-align:center; color:#9ca3af; font-size:12px }
</style>
</head>
<body>
  <header><h1>ë„ˆì•¼ë„ˆ ë£°ë › (í™”ì‚´í‘œê°€ ë„ëŠ” ë°©ì‹)</h1></header>

  <main>
    <div class="panel">
      <div class="row">
        <label>ì¸ì› ìˆ˜</label>
        <input type="number" id="count" min="2" max="20" value="6" />
        <button id="build">ì°¸ê°€ì ìƒì„±</button>
        <span class="muted">ìµœëŒ€ 20ëª… ê¶Œì¥</span>
      </div>

      <div class="grid">
        <!-- ìº”ë²„ìŠ¤ / ë£°ë › -->
        <div class="canvas-wrap">
          <canvas id="wheel" aria-label="ë£°ë ›"></canvas>
          <div class="arrow-pivot">
            <div class="arrow-ring">
              <div id="arrow" class="arrow"></div>
            </div>
          </div>
          <div class="center-row">
            <button id="spin" title="ê°€ìš´ë° í™”ì‚´í‘œê°€ 5~6ì´ˆ ëœë¤ìœ¼ë¡œ íšŒì „ í›„ ë©ˆì¶¥ë‹ˆë‹¤">ì‹œì‘(ëŒë¦¬ê¸°)</button>
            <button id="reset" class="ghost">ì´ˆê¸°í™”</button>
          </div>
          <div id="result" class="result"></div>
        </div>

        <!-- ì°¸ê°€ì ëª©ë¡ -->
        <div class="tools">
          <h3>ì°¸ê°€ì ì´ë¦„</h3>
          <div class="row">
            <span class="badge">Tip</span>
            <span class="muted">ì´ë¦„ì„ ìˆ˜ì •í•˜ë©´ ë£°ë ›ì—ë„ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</span>
          </div>
          <div id="nameList" class="list"></div>
          <div class="row" style="margin-top:10px">
            <button id="autofill" class="secondary">ì´ë¦„ ìë™ ì±„ìš°ê¸°</button>
            <button id="shuffle" class="ghost">ìˆœì„œ ì„ê¸°</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>Â© ë„ˆì•¼ë„ˆ â€¢ í™”ì‚´í‘œ íšŒì „ ë°©ì‹ â€¢ ëª¨ë°”ì¼ ëŒ€ì‘</footer>

<script>
(() => {
  // ìƒíƒœ
  let names = ["1ë²ˆ", "2ë²ˆ", "3ë²ˆ", "4ë²ˆ", "5ë²ˆ", "6ë²ˆ"];
  let spinning = false;
  let currentAngle = 0;   // í™”ì‚´í‘œ í˜„ì¬ ê°ë„(ë¼ë””ì•ˆ)
  let targetAngle = 0;    // ì´ë²ˆ ìŠ¤í•€ ëª©í‘œ ê°ë„(ë¼ë””ì•ˆ)
  let startTime = 0, duration = 0;

  // ì—˜ë¦¬ë¨¼íŠ¸
  const $count = document.getElementById('count');
  const $build = document.getElementById('build');
  const $nameList = document.getElementById('nameList');
  const $wheel = document.getElementById('wheel');
  const $spin = document.getElementById('spin');
  const $reset = document.getElementById('reset');
  const $autofill = document.getElementById('autofill');
  const $shuffle = document.getElementById('shuffle');
  const $result = document.getElementById('result');
  const $arrow = document.getElementById('arrow');

  // ìº”ë²„ìŠ¤ í¬ê¸°/ìŠ¤ì¼€ì¼ ì„¤ì • (ë ˆí‹°ë‚˜ ëŒ€ì‘)
  function resizeCanvas() {
    const maxW = Math.min(800, document.body.clientWidth - 60);
    const cssSize = Math.max(320, Math.floor(maxW));
    const dpr = Math.min(devicePixelRatio || 1, 2);
    $wheel.width = cssSize * dpr;
    $wheel.height = cssSize * dpr;
    $wheel.style.width = cssSize + "px";
    $wheel.style.height = cssSize + "px";
    drawWheel();
  }

  // ìƒ‰ íŒ”ë ˆíŠ¸(ì„¹í„° ë²ˆê°ˆì•„ê°€ë©°)
  function sectorColor(i){
    const base = [
      "#fde047","#93c5fd","#fca5a5","#a7f3d0","#c4b5fd","#fcd34d",
      "#bae6fd","#fecaca","#86efac","#ddd6fe"
    ];
    return base[i % base.length];
  }

  // ë£°ë › ê·¸ë¦¬ê¸°(ì›íŒ + ì„¹í„° + ë¼ë²¨)
  function drawWheel(){
    const ctx = $wheel.getContext('2d');
    const W = $wheel.width, H = $wheel.height;
    const r = Math.min(W,H)/2 - 12 * (devicePixelRatio || 1);
    const cx = W/2, cy = H/2;
    ctx.clearRect(0,0,W,H);

    // ì™¸ê³½ ê·¸ë¦¼ì ë§
    ctx.save();
    ctx.beginPath(); ctx.arc(cx,cy,r+6,0,Math.PI*2);
    ctx.strokeStyle = "#11182722"; ctx.lineWidth = 12; ctx.stroke();
    ctx.restore();

    const n = names.length;
    if(n === 0) return;

    const step = (Math.PI*2)/n;
    // ì„¹í„° ë³¸ì²´
    for(let i=0;i<n;i++){
      ctx.beginPath();
      const a0 = -Math.PI/2 + i*step; // 12ì‹œ ë°©í–¥ë¶€í„° ì‹œê³„ë°©í–¥
      const a1 = a0 + step;
      ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,r,a0,a1);
      ctx.closePath();
      ctx.fillStyle = sectorColor(i);
      ctx.fill();
      // ê²½ê³„ì„ 
      ctx.strokeStyle = "#ffffff";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    // ë¼ë²¨ í…ìŠ¤íŠ¸
    ctx.save();
    ctx.translate(cx,cy);
    ctx.fillStyle = "#111827";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.font = `${Math.floor(r*0.12)}px system-ui, -apple-system, Segoe UI, Roboto, Pretendard, sans-serif`;

    for(let i=0;i<n;i++){
      const aMid = -Math.PI/2 + (i+0.5)*step;
      const tx = Math.cos(aMid) * r*0.62;
      const ty = Math.sin(aMid) * r*0.62;
      // ì´ë¦„ì´ ê¸¸ë©´ ì¤„ë°”ê¿ˆ ì²˜ë¦¬(ê°„ë‹¨)
      const label = names[i].trim() || `${i+1}ë²ˆ`;
      const maxChars = Math.floor(r*0.21/8); // ëŒ€ëµì¹˜
      const lines = splitLabel(label, maxChars);
      if(lines.length === 1){
        ctx.fillText(lines[0], tx, ty);
      }else{
        const lh = r*0.12*0.95;
        lines.forEach((line,idx)=>{
          ctx.fillText(line, tx, ty + (idx-(lines.length-1)/2)*lh);
        });
      }
    }
    ctx.restore();
  }

  function splitLabel(s, max){
    if(s.length <= max) return [s];
    const words = s.split(/\s+/);
    if(words.length === 1){
      return [s.slice(0,max), s.slice(max, max*2)];
    }
    const lines = [];
    let cur = "";
    for(const w of words){
      if((cur + " " + w).trim().length > max){
        if(cur) lines.push(cur);
        cur = w;
      }else{
        cur = (cur ? cur + " " : "") + w;
      }
    }
    if(cur) lines.push(cur);
    return lines.slice(0,2);
  }

  // ì´ë¦„ UI ìƒì„±/ê°±ì‹ 
  function rebuildNameInputs(){
    $nameList.innerHTML = "";
    names.forEach((nm, idx) => {
      const row = document.createElement('div');
      row.className = 'row';
      row.style.margin = "0";
      const lab = document.createElement('label');
      lab.textContent = `${idx+1}.`;
      lab.style.minWidth = "28px";
      const inp = document.createElement('input');
      inp.value = nm;
      inp.placeholder = `${idx+1}ë²ˆ`;
      inp.addEventListener('input', () => {
        names[idx] = inp.value;
        drawWheel();
      });
      row.appendChild(lab);
      row.appendChild(inp);
      $nameList.appendChild(row);
    });
  }

  // ì°¸ê°€ì ìˆ˜ë¡œ ë°°ì—´ ì¬ìƒì„±
  function buildByCount(){
    const n = clamp(parseInt($count.value||"0",10), 2, 50);
    names = Array.from({length:n}, (_,i)=>`${i+1}ë²ˆ`);
    rebuildNameInputs();
    drawWheel();
    $result.textContent = "";
  }

  // ì…”í”Œ
  function shuffleNames(){
    for(let i=names.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [names[i], names[j]] = [names[j], names[i]];
    }
    rebuildNameInputs();
    drawWheel();
  }

  // ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ (í™”ì‚´í‘œ íšŒì „)
  function spin(){
    if(spinning || names.length < 2) return;
    spinning = true;
    $result.textContent = "ëŒì•„ê°€ëŠ” ì¤‘â€¦";

    // 5~6ì´ˆ ëœë¤ ì‹œê°„, ì‹œì‘~ë ê°ë„(Ease-out)
    duration = (5 + Math.random()) * 1000; // ms
    const extraTurns = 5 + Math.random()*2; // 5~7ë°”í€´
    targetAngle = currentAngle + extraTurns * Math.PI*2 + Math.random()*Math.PI*2;

    startTime = performance.now();
    requestAnimationFrame(step);
  }

  // ì´ì§• í•¨ìˆ˜ (easeOutCubic)
  function easeOut(t){ return 1 - Math.pow(1 - t, 3); }

  function step(now){
    const t = clamp((now - startTime) / duration, 0, 1);
    const eased = easeOut(t);
    const angle = lerp(currentAngle, targetAngle, eased);

    // í™”ì‚´í‘œ DOM íšŒì „ (deg)
    const deg = radToDeg(angle) % 360;
    $arrow.style.transform = `rotate(${deg}deg)`;

    if(t < 1){
      requestAnimationFrame(step);
    }else{
      spinning = false;
      currentAngle = angle % (Math.PI*2);
      showWinner();
    }
  }

  // ìŠ¹ì ê³„ì‚° (í™”ì‚´í‘œê°€ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥: ìœ„ìª½ì„ 0ë„ë¡œ ê°€ì •)
  function showWinner(){
    const n = names.length;
    const step = (Math.PI*2)/n;

    // í™”ì‚´í‘œ ê¼­ì§€ì ì´ ê°€ë¦¬í‚¤ëŠ” ê°ë„: í™”ë©´ ê¸°ì¤€ 12ì‹œ ë°©í–¥ì´ 0(rad)ë¼ê³  ì„¤ì •.
    // currentAngleì€ í™”ì‚´í‘œ ìì²´ì˜ íšŒì „ ê°ë„(ì‹œê³„ë°©í–¥ +).
    // í™”ì‚´í‘œê°€ ìœ„(12ì‹œ)ë¥¼ í–¥í–ˆì„ ë•Œ ìº”ë²„ìŠ¤ ì„¹í„°ëŠ” -90ë„ë¶€í„° ì¸ë±ì‹±í–ˆìœ¼ë¯€ë¡œ,
    // í™”ì‚´í‘œ ë°©í–¥ì„ 12ì‹œ(= -90ë„ ë³´ì •)ë¡œ ë§ì¶° ì¸ë±ìŠ¤ ì‚°ì¶œ.
    const arrowAngleFromTop = (currentAngle) % (Math.PI*2);
    // 12ì‹œ ê¸°ì¤€ìœ¼ë¡œ ì„¹í„°ëŠ” [-90Â°]ì—ì„œ ì‹œì‘í–ˆìœ¼ë¯€ë¡œ +90Â° ë³´ì •
    let a = (arrowAngleFromTop + Math.PI/2) % (Math.PI*2);
    if(a < 0) a += Math.PI*2;

    const index = Math.floor(a / step) % n;
    const winner = names[index]?.trim() || `${index+1}ë²ˆ`;

    $result.innerHTML = `ğŸ‘‰ <b>${winner}</b> ë‹˜ì´ ë‹¹ì²¨!`;
    flashRing();
  }

  // ì‹œê° íš¨ê³¼: ë§ ì‚´ì§ ë°˜ì§
  function flashRing(){
    const ring = document.querySelector('.arrow-ring');
    ring.animate([
      { boxShadow:'0 10px 30px rgba(0,0,0,.18)' },
      { boxShadow:'0 0 0 10px rgba(16,185,129,.35)' },
      { boxShadow:'0 10px 30px rgba(0,0,0,.18)' },
    ], { duration: 520, easing:'ease-out' });
  }

  // ë„ìš°ë¯¸
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const lerp = (a,b,t)=>a+(b-a)*t;
  const radToDeg = r=>r*180/Math.PI;

  // ì´ë²¤íŠ¸ ë°”ì¸ë”©
  window.addEventListener('resize', resizeCanvas);
  $build.addEventListener('click', buildByCount);
  $autofill.addEventListener('click', ()=>{
    names = names.map((_,i)=>`${i+1}ë²ˆ`);
    rebuildNameInputs(); drawWheel();
  });
  $shuffle.addEventListener('click', shuffleNames);
  $spin.addEventListener('click', ()=>{ if(!spinning) spin(); });
  $reset.addEventListener('click', ()=>{
    if(spinning) return;
    currentAngle = 0;
    $arrow.style.transform = `rotate(0deg)`;
    $result.textContent = "";
  });

  // ì´ˆê¸° ì„¸íŒ…
  rebuildNameInputs();
  resizeCanvas();
})();
</script>
</body>
</html>
